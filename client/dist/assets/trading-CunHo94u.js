const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web3-DuRBVa1D.js","assets/vendor-C9R_Cz-L.js","assets/react-vendor-whffYpp3.js","assets/utils-BkLtITBR.js"])))=>i.map(i=>d[i]);
import{O as se}from"./vendor-C9R_Cz-L.js";import{r as t,j as e,ab as Ne,aj as we,ae as te,ak as ye,al as ze}from"./react-vendor-whffYpp3.js";import{i as Se,u as ke,b as S,C as v,c as f,B as x,f as Ce,d as q,e as Te,g as N}from"./index-BkmNh__t.js";import{S as B,a as _,b as R,c as M,d as n}from"./select-yBojBFP4.js";import{I as k}from"./input-DXttkvsq.js";import{L as u}from"./label-D6jU-wGE.js";import{T as W,a as H,b as j}from"./tabs-bZ5-BZyw.js";import{F as Fe,v as Le,h as C,z as Pe}from"./charts-Dj0w14dn.js";import{g as ae}from"./tokenUtils-CsMV57Z5.js";import"./utils-BkLtITBR.js";import"./router-Chclg4Zx.js";import"./ui-DDPZ4K8P.js";import"./web3-DuRBVa1D.js";function Ze(){const{wallet:T,connectWallet:ie}=Se(),{toast:l}=ke(),g=t.useRef(null),[K,re]=t.useState(null),[F,ce]=t.useState(null),[L,ne]=t.useState(null),[i,le]=t.useState("XPS-XP"),[P,oe]=t.useState("1h"),[X,U]=t.useState("candlestick"),[p,de]=t.useState("market"),[o,xe]=t.useState("buy"),[b,Y]=t.useState(""),[w,J]=t.useState(""),[I,he]=t.useState("0.5"),[Ie,Oe]=t.useState(!0),[$e,Ee]=t.useState(!0),[O,me]=t.useState("1"),[$,Q]=t.useState(""),[E,G]=t.useState(""),[h,pe]=t.useState(!1),[y,ue]=t.useState("orderbook"),{data:Z,isLoading:De}=S({queryKey:["/api/trading/pairs"],queryFn:async()=>{const s=await fetch(N("/api/trading/pairs"));if(!s.ok)throw new Error("Failed to fetch trading pairs");return s.json()},refetchInterval:5e3}),{data:z,isLoading:Ae}=S({queryKey:["/api/trading/chart",i,P],queryFn:async()=>{const s=await fetch(N(`/api/trading/chart?pair=${i}&timeframe=${P}`));if(!s.ok)throw new Error("Failed to fetch chart data");return s.json()},refetchInterval:2e3}),{data:d,isLoading:Ve}=S({queryKey:["/api/trading/orderbook",i],queryFn:async()=>{const s=await fetch(N(`/api/trading/orderbook?pair=${i}`));if(!s.ok)throw new Error("Failed to fetch order book");return s.json()},refetchInterval:1e3}),{data:je,isLoading:qe}=S({queryKey:["/api/trading/trades",i],queryFn:async()=>{const s=await fetch(N(`/api/trading/trades?pair=${i}`));if(!s.ok)throw new Error("Failed to fetch recent trades");return s.json()},refetchInterval:2e3});t.useEffect(()=>{if(g.current&&!K){const s=Fe(g.current,{width:g.current.clientWidth,height:h?600:450,layout:{background:{type:Pe.Solid,color:"#0a0a0a"},textColor:"#e4e4e7",fontSize:12,fontFamily:"Inter, system-ui, sans-serif"},grid:{vertLines:{color:"#262626",style:C.Dotted,visible:!0},horzLines:{color:"#262626",style:C.Dotted,visible:!0}},crosshair:{mode:1,vertLine:{color:"#71717a",width:1,style:C.Dashed},horzLine:{color:"#71717a",width:1,style:C.Dashed}},rightPriceScale:{borderColor:"#262626",mode:Le.Normal,entireTextOnly:!1,visible:!0,borderVisible:!1,scaleMargins:{top:.1,bottom:.2}},timeScale:{borderColor:"#262626",timeVisible:!0,secondsVisible:!1,borderVisible:!1,rightOffset:5},watermark:{visible:!0,fontSize:48,horzAlign:"center",vertAlign:"center",color:"rgba(255, 255, 255, 0.03)",text:"XPSwap"}}),r=s.addCandlestickSeries({upColor:"#00d4aa",downColor:"#ff6b6b",borderDownColor:"#ff6b6b",borderUpColor:"#00d4aa",wickDownColor:"#ff6b6b",wickUpColor:"#00d4aa",priceScaleId:"right"}),a=s.addHistogramSeries({color:"#71717a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});re(s),ce(r),ne(a);const m=()=>{s.applyOptions({width:g.current?.clientWidth||800,height:h?600:450})};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)}},[K,h]),t.useEffect(()=>{if(F&&L&&z){const s=z.map(a=>({time:a.time,open:a.open,high:a.high,low:a.low,close:a.close})),r=z.map(a=>({time:a.time,value:a.volume,color:a.close>a.open?"rgba(0, 212, 170, 0.6)":"rgba(255, 107, 107, 0.6)"}));F.setData(s),L.setData(r)}},[z,F,L]);const c=Z?.find(s=>s.id===i),be=async()=>{if(!T.isConnected){l({title:"Wallet Connection Required",description:"Please connect your wallet to place trades.",variant:"destructive"});return}if(!b||p==="limit"&&!w){l({title:"Input Error",description:"Please fill in all required fields.",variant:"destructive"});return}try{l({title:"Processing Trade",description:"Your trade is being processed on the blockchain..."});const s=await fetch(N("/api/trading/execute"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pair:i,side:o,type:p,amount:parseFloat(b),price:p==="limit"?parseFloat(w):void 0,slippage:parseFloat(I),leverage:parseFloat(O),stopLoss:$?parseFloat($):void 0,takeProfit:E?parseFloat(E):void 0,userAddress:T.address})}),r=await s.json();if(s.ok){if(p==="limit")try{const{web3Service:a}=await se(async()=>{const{web3Service:D}=await import("./web3-DuRBVa1D.js").then(A=>A.e);return{web3Service:D}},__vite__mapDeps([0,1,2,3])),m=await a.placeLimitOrder(i,o,b,w);if(m.success)l({title:"Limit Order Placed",description:`Your ${o} limit order has been placed on-chain. Order ID: ${m.orderId?.slice(0,8)}...`});else throw new Error(m.error)}catch(a){console.warn("Limit order placement failed, using AMM execution:",a)}{const[a,m]=i.split("-"),D=a,A=m,ge=o==="buy"?(parseFloat(b)*r.executionPrice).toString():b;try{const{web3Service:V}=await se(async()=>{const{web3Service:ve}=await import("./web3-DuRBVa1D.js").then(fe=>fe.e);return{web3Service:ve}},__vite__mapDeps([0,1,2,3])),ee=await V.executeSwap(D,A,ge,parseFloat(I)/100);ee.success?l({title:"Trade Executed Successfully",description:`${o==="buy"?"Buy":"Sell"} order executed. TX: ${ee.transactionHash?.slice(0,10)}...`}):l({title:"Trade Failed",description:"Failed to execute trade on blockchain. Please try again.",variant:"destructive"})}catch(V){console.warn("Web3 execution failed, using API result:",V),l({title:"Trade Completed",description:`${o==="buy"?"Buy":"Sell"} order processed. Execution price: $${r.executionPrice}`})}}Y(""),J(""),Q(""),G(""),setTimeout(()=>{window.location.reload()},2e3)}else l({title:"Trade Failed",description:r.message||"An error occurred during trading.",variant:"destructive"})}catch(s){console.error("Trading error:",s),l({title:"Trade Failed",description:"An error occurred while processing your trade.",variant:"destructive"})}};return T.isConnected?e.jsxs("div",{className:"min-h-screen bg-black text-white",children:[e.jsx("div",{className:"border-b border-zinc-800 bg-zinc-900/50 backdrop-blur-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("h1",{className:"text-xl font-semibold text-white",children:"Advanced Trading"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(B,{value:i,onValueChange:le,children:[e.jsx(_,{className:"w-40 bg-zinc-800 border-zinc-700 text-white",children:e.jsx(R,{})}),e.jsx(M,{className:"bg-zinc-800 border-zinc-700",children:Z?.map(s=>e.jsx(n,{value:s.id,className:"text-white hover:bg-zinc-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:ae(s.symbol.split("-")[0]),alt:"",className:"w-4 h-4"}),s.symbol]})},s.id))})]}),c&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-xl font-mono text-white",children:["$",c.price.toFixed(6)]}),e.jsxs(Ce,{variant:c.change24h>=0?"default":"destructive",className:c.change24h>=0?"bg-emerald-600 text-white":"bg-red-600 text-white",children:[c.change24h>=0?"+":"",c.change24h.toFixed(2),"%"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>pe(!h),className:"text-zinc-400 hover:text-white hover:bg-zinc-800",children:e.jsx(we,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"text-zinc-400 hover:text-white hover:bg-zinc-800",children:e.jsx(te,{className:"w-4 h-4"})})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto p-4",children:e.jsxs("div",{className:`grid gap-4 ${h?"grid-cols-1":"grid-cols-4"}`,children:[e.jsxs("div",{className:h?"col-span-1":"col-span-3",children:[e.jsxs(v,{className:"bg-zinc-900 border-zinc-800",children:[e.jsx(q,{className:"pb-2 border-b border-zinc-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:ae(i.split("-")[0]),alt:"",className:"w-5 h-5"}),e.jsx("span",{className:"font-mono text-sm text-zinc-400",children:i})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center bg-zinc-800 rounded-md p-1",children:[e.jsx(x,{variant:X==="candlestick"?"default":"ghost",size:"sm",onClick:()=>U("candlestick"),className:"h-7 px-2",children:e.jsx(ye,{className:"w-3 h-3"})}),e.jsx(x,{variant:X==="line"?"default":"ghost",size:"sm",onClick:()=>U("line"),className:"h-7 px-2",children:e.jsx(ze,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"flex items-center bg-zinc-800 rounded-md p-1",children:["1m","5m","15m","1h","4h","1d"].map(s=>e.jsx(x,{variant:P===s?"default":"ghost",size:"sm",onClick:()=>oe(s),className:"h-7 px-2 text-xs",children:s},s))})]})]})}),e.jsx(f,{className:"p-0",children:e.jsx("div",{ref:g,className:"w-full"})})]}),c&&!h&&e.jsx(v,{className:"bg-zinc-900 border-zinc-800 mt-4",children:e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"24h High"}),e.jsxs("p",{className:"text-sm font-mono text-emerald-400",children:["$",c.high24h.toFixed(6)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"24h Low"}),e.jsxs("p",{className:"text-sm font-mono text-red-400",children:["$",c.low24h.toFixed(6)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"24h Volume"}),e.jsxs("p",{className:"text-sm font-mono text-white",children:["$",c.volume24h.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-zinc-500 mb-1",children:"Liquidity"}),e.jsxs("p",{className:"text-sm font-mono text-blue-400",children:["$",c.liquidity.toLocaleString()]})]})]})})})]}),!h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{className:"bg-zinc-900 border-zinc-800",children:[e.jsx(q,{className:"pb-3 border-b border-zinc-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Te,{className:"text-sm text-white",children:"Place Order"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(te,{className:"w-3 h-3"})})})]})}),e.jsxs(f,{className:"p-4 space-y-4",children:[e.jsx(W,{value:o,onValueChange:xe,children:e.jsxs(H,{className:"grid w-full grid-cols-2 bg-zinc-800",children:[e.jsx(j,{value:"buy",className:"text-emerald-400 data-[state=active]:bg-emerald-600 data-[state=active]:text-white",children:"Buy"}),e.jsx(j,{value:"sell",className:"text-red-400 data-[state=active]:bg-red-600 data-[state=active]:text-white",children:"Sell"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(u,{className:"text-xs text-zinc-400",children:"Order Type"})}),e.jsx(W,{value:p,onValueChange:de,children:e.jsxs(H,{className:"grid w-full grid-cols-2 bg-zinc-800",children:[e.jsx(j,{value:"market",className:"text-xs",children:"Market"}),e.jsx(j,{value:"limit",className:"text-xs",children:"Limit"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-xs text-zinc-400",children:"Leverage"}),e.jsxs("span",{className:"text-xs text-white",children:[O,"x"]})]}),e.jsxs(B,{value:O,onValueChange:me,children:[e.jsx(_,{className:"bg-zinc-800 border-zinc-700 text-white text-xs h-8",children:e.jsx(R,{})}),e.jsxs(M,{className:"bg-zinc-800 border-zinc-700",children:[e.jsx(n,{value:"1",children:"1x"}),e.jsx(n,{value:"2",children:"2x"}),e.jsx(n,{value:"5",children:"5x"}),e.jsx(n,{value:"10",children:"10x"}),e.jsx(n,{value:"20",children:"20x"})]})]})]}),p==="limit"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-xs text-zinc-400",children:"Price"}),e.jsx(k,{type:"number",value:w,onChange:s=>J(s.target.value),placeholder:"0.00",className:"bg-zinc-800 border-zinc-700 text-white text-xs h-8"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-xs text-zinc-400",children:"Size"}),e.jsx(k,{type:"number",value:b,onChange:s=>Y(s.target.value),placeholder:"0.00",className:"bg-zinc-800 border-zinc-700 text-white text-xs h-8"}),e.jsx("div",{className:"flex gap-1",children:["25%","50%","75%","Max"].map(s=>e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 h-6 text-xs bg-zinc-800 border-zinc-700 text-zinc-400 hover:bg-zinc-700",children:s},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-xs text-zinc-400",children:"Stop Loss"}),e.jsx(k,{type:"number",value:$,onChange:s=>Q(s.target.value),placeholder:"Optional",className:"bg-zinc-800 border-zinc-700 text-white text-xs h-8"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-xs text-zinc-400",children:"Take Profit"}),e.jsx(k,{type:"number",value:E,onChange:s=>G(s.target.value),placeholder:"Optional",className:"bg-zinc-800 border-zinc-700 text-white text-xs h-8"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"text-xs text-zinc-400",children:"Slippage"}),e.jsxs(B,{value:I,onValueChange:he,children:[e.jsx(_,{className:"bg-zinc-800 border-zinc-700 text-white text-xs h-8",children:e.jsx(R,{})}),e.jsxs(M,{className:"bg-zinc-800 border-zinc-700",children:[e.jsx(n,{value:"0.1",children:"0.1%"}),e.jsx(n,{value:"0.5",children:"0.5%"}),e.jsx(n,{value:"1.0",children:"1.0%"}),e.jsx(n,{value:"3.0",children:"3.0%"})]})]})]}),e.jsxs(x,{onClick:be,className:`w-full h-10 font-medium ${o==="buy"?"bg-emerald-600 hover:bg-emerald-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:[o==="buy"?"Buy":"Sell"," ",i.split("-")[0]]})]})]}),e.jsxs(v,{className:"bg-zinc-900 border-zinc-800",children:[e.jsx(q,{className:"pb-2 border-b border-zinc-800",children:e.jsx(W,{value:y,onValueChange:ue,children:e.jsxs(H,{className:"grid w-full grid-cols-3 bg-zinc-800",children:[e.jsx(j,{value:"orderbook",className:"text-xs",children:"Book"}),e.jsx(j,{value:"trades",className:"text-xs",children:"Trades"}),e.jsx(j,{value:"positions",className:"text-xs",children:"Positions"})]})})}),e.jsxs(f,{className:"p-3",children:[y==="orderbook"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-zinc-500 mb-2",children:[e.jsx("span",{children:"Price"}),e.jsx("span",{children:"Size"}),e.jsx("span",{children:"Total"})]}),e.jsx("div",{className:"space-y-1",children:d?.asks?.slice(0,8).reverse().map((s,r)=>e.jsxs("div",{className:"flex justify-between text-xs hover:bg-zinc-800 px-1 py-0.5 rounded",children:[e.jsx("span",{className:"text-red-400 font-mono",children:s.price.toFixed(6)}),e.jsx("span",{className:"text-zinc-300 font-mono",children:s.amount.toFixed(2)}),e.jsx("span",{className:"text-zinc-500 font-mono",children:s.total.toFixed(2)})]},r))}),e.jsx("div",{className:"py-2 text-center border-t border-b border-zinc-800",children:e.jsx("span",{className:"text-xs text-zinc-500 font-mono",children:d?.asks?.[0]&&d?.bids?.[0]?`${(d.asks[0].price-d.bids[0].price).toFixed(6)} (${((d.asks[0].price-d.bids[0].price)/d.bids[0].price*100).toFixed(2)}%)`:"Spread"})}),e.jsx("div",{className:"space-y-1",children:d?.bids?.slice(0,8).map((s,r)=>e.jsxs("div",{className:"flex justify-between text-xs hover:bg-zinc-800 px-1 py-0.5 rounded",children:[e.jsx("span",{className:"text-emerald-400 font-mono",children:s.price.toFixed(6)}),e.jsx("span",{className:"text-zinc-300 font-mono",children:s.amount.toFixed(2)}),e.jsx("span",{className:"text-zinc-500 font-mono",children:s.total.toFixed(2)})]},r))})]}),y==="trades"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs text-zinc-500 mb-2",children:[e.jsx("span",{children:"Price"}),e.jsx("span",{children:"Size"}),e.jsx("span",{children:"Time"})]}),je?.slice(0,20).map((s,r)=>e.jsxs("div",{className:"flex justify-between text-xs hover:bg-zinc-800 px-1 py-0.5 rounded",children:[e.jsx("span",{className:`font-mono ${s.side==="buy"?"text-emerald-400":"text-red-400"}`,children:s.price.toFixed(6)}),e.jsx("span",{className:"text-zinc-300 font-mono",children:s.amount.toFixed(2)}),e.jsx("span",{className:"text-zinc-500 text-xs",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},r))]}),y==="positions"&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-xs text-zinc-500",children:"No open positions"})})]})]})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-black p-4",children:e.jsx("div",{className:"max-w-2xl mx-auto pt-20",children:e.jsx(v,{className:"bg-zinc-900 backdrop-blur-lg border-zinc-800",children:e.jsxs(f,{className:"p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-emerald-500/20 to-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ne,{className:"w-8 h-8 text-emerald-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Wallet Connection Required"}),e.jsx("p",{className:"text-zinc-400",children:"Connect your wallet to access professional trading features"})]}),e.jsx(x,{onClick:ie,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Connect Wallet"})]})})})})}export{Ze as default};
