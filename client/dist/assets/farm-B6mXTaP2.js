import{ap as K,aq as L,F as P,r as N,j as e,a9 as T,aU as q,aP as V,aT as X,ae as z,at as Q,v as W,ad as $,aV as M,aK as _}from"./react-CnjVYTDc.js";import{e as H,u as J,l as D,f as A,D as Z,h as G,i as ee,j as se,B as k,C as g,a as p,d as f,g as ae}from"./index-DxHLzNoH.js";import{I as E}from"./input-BJWVzqi3.js";import{T as U,a as I,b as y,c as S}from"./tabs-1rBqboxz.js";import{u as O}from"./useTokenPrices-DtKVxnmy.js";import{g as R}from"./tokenUtils-CIcLq7dT.js";import"./vendor-B0r8BCsL.js";import"./utils-BkLtITBR.js";import"./ui-BQCqNqg0.js";import"./router-B_5Dh3-u.js";import"./web3-30Ii_1H8.js";const te=[{days:"30",label:"1 Month",bonus:"100%"},{days:"90",label:"3 Months",bonus:"150%"},{days:"180",label:"6 Months",bonus:"250%"},{days:"365",label:"1 Year",bonus:"400%"}],ne={30:100,90:150,180:250,365:400};function B(){const{wallet:s}=H(),{toast:c}=J(),u=K(),r=L({mutationFn:async a=>{if(!s.address)throw new Error("Wallet not connected");const t=a.action==="stake"?"/api/stake-tokens":"/api/unstake-tokens",d=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({farmId:a.farmId,amount:a.amount,lockPeriod:a.action==="stake"?a.lockPeriod:void 0,userAddress:a.userAddress})});if(!d.ok){const j=await d.json();throw new Error(j.error||`Failed to ${a.action} tokens`)}return d.json()},onSuccess:(a,t)=>{const d=t.action;c({title:`${d==="stake"?"Staking":"Unstaking"} Successful`,description:`Successfully ${d==="stake"?"staked":"unstaked"} ${t.amount} tokens`}),u.invalidateQueries({queryKey:["/api/farms"]})},onError:(a,t)=>{const d=t.action;c({title:`${d==="stake"?"Staking":"Unstaking"} Failed`,description:`Failed to ${d} tokens. Please try again.`,variant:"destructive"})}}),m=L({mutationFn:async a=>{const t=await fetch(D("/api/claim-rewards"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({farmId:a,userAddress:s.address})});if(!t.ok)throw new Error("Failed to claim rewards");return t.json()},onSuccess:(a,t)=>{c({title:"Rewards Claimed",description:`Successfully claimed ${a.rewardAmount} ${a.rewardToken}`}),u.invalidateQueries({queryKey:["/api/farms"]})},onError:a=>{c({title:"Claim Failed",description:"Failed to claim rewards. Please try again.",variant:"destructive"})}}),{data:n}=P({queryKey:["/api/farms",s.address],queryFn:async()=>{if(!s.address)return null;const a=await fetch(D("/api/farms/user-data/${wallet.address}"));return a.ok?a.json():null},enabled:!!s.address}),i=a=>n?.find(t=>t.farmId===a),x=a=>(ne[a]||100).toFixed(0);return{stakeMutation:r,claimRewardsMutation:m,userFarmData:n,getUserFarmData:i,calculateAPRBonus:x,calculateEstimatedRewards:(a,t)=>{if(!a||parseFloat(a)===0)return"0";const d=parseFloat(a),j=parseFloat(x(t))/100,w=t/365;return(d*j*w).toFixed(4)},formatCurrency:a=>{const t=parseFloat(a.replace(/,/g,""));return t>=1e6?`$${(t/1e6).toFixed(1)}M`:t>=1e3?`$${(t/1e3).toFixed(0)}K`:`$${t.toLocaleString()}`},calculateRewardsValue:(a,t)=>{const d=t?.[a.rewardToken.symbol]?.price||0;return(parseFloat(a.userRewards)*d).toFixed(2)}}}function re({farm:s,isOpen:c,onClose:u,action:r}){const{wallet:m}=A(),[n,i]=N.useState(""),[x,o]=N.useState("30"),{stakeMutation:b,calculateAPRBonus:v,calculateEstimatedRewards:a}=B(),{data:t}=O([s.stakingToken.symbol,s.rewardToken.symbol]),{data:d}=P({queryKey:[`/api/blockchain/balance/${m.address}/${s.stakingToken.symbol}`,m.address,s.stakingToken.symbol],enabled:!!m.address&&!!s.stakingToken.symbol,refetchInterval:5e3}),j=t?.[s.stakingToken.symbol]?.price||0,w=n?(parseFloat(n)*j).toFixed(2):"0.00",l=()=>{m.address&&b.mutate({action:r,farmId:s.id,amount:n,lockPeriod:r==="stake"?parseInt(x):void 0,userAddress:m.address})},F=()=>{if(r==="stake"){const h=d?.balance||"0";if(s.stakingToken.symbol==="XP"){const Y=Math.max(0,parseFloat(h)-.01).toFixed(6);i(Y)}else i(h)}else i(s.userStaked)};return e.jsx(Z,{open:c,onOpenChange:u,children:e.jsxs(G,{className:"max-w-md",children:[e.jsx(ee,{children:e.jsxs(se,{children:[r==="stake"?"Stake":"Unstake"," ",s.stakingToken.symbol]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Amount"}),e.jsxs("span",{children:["Available: ",r==="stake"?d?.balance||"0.000":s.userStaked," ",s.stakingToken.symbol]})]}),e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(E,{placeholder:"0.0",value:n,onChange:h=>i(h.target.value),className:"border-0 text-xl font-semibold p-0 h-auto",type:"number"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:F,children:"MAX"}),e.jsx("img",{src:R(s.stakingToken.symbol),alt:s.stakingToken.symbol,className:"w-6 h-6 rounded-full"}),e.jsx("span",{className:"font-semibold",children:s.stakingToken.symbol})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["$",w]})]})]}),r==="stake"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"Lock Period"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:te.map(h=>e.jsxs(k,{variant:x===h.days?"default":"outline",size:"sm",className:"h-auto p-3 flex flex-col items-center",onClick:()=>o(h.days),children:[e.jsx("div",{className:"font-medium",children:h.label}),e.jsx("div",{className:"text-xs text-green-600",children:h.bonus})]},h.days))}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Lock Period"}),e.jsxs("span",{children:[x," days"]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"APY"}),e.jsxs("span",{className:"text-green-600",children:[v(parseInt(x)),"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Estimated Rewards"}),e.jsxs("span",{className:"text-green-600",children:[a(n,parseInt(x))," ",s.rewardToken.symbol]})]})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Pool TVL"}),e.jsx("span",{children:s.tvl})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Staked"}),e.jsx("span",{children:s.totalStaked})]}),r==="stake"&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Your Staked"}),e.jsxs("span",{children:[s.userStaked," ",s.stakingToken.symbol]})]})]}),e.jsx(k,{className:"w-full",onClick:l,disabled:!n||b.isPending,variant:r==="unstake"?"destructive":"default",children:b.isPending?`${r==="stake"?"Staking":"Unstaking"}...`:`${r==="stake"?"Stake":"Unstake"} ${s.stakingToken.symbol}`})]})]})})}function C({farms:s}){const{wallet:c}=A(),[u,r]=N.useState(null),[m,n]=N.useState(!1),[i,x]=N.useState("stake"),{data:o}=O(["XP","BTC","ETH","USDT","BNB"]),{claimRewardsMutation:b,getUserFarmData:v,formatCurrency:a}=B(),t=l=>{r(l),x("stake"),n(!0)},d=l=>{r(l),x("unstake"),n(!0)},j=s.filter(l=>{const F=v(l.id);return F&&parseFloat(F.totalStaked)>0}),w=s.filter(l=>l.isActive);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{defaultValue:"active-farms",className:"space-y-6",children:[e.jsxs(I,{className:"grid w-full grid-cols-2",children:[e.jsx(y,{value:"active-farms",children:"All Farms"}),e.jsx(y,{value:"my-farms",children:"My Farms"})]}),e.jsx(S,{value:"active-farms",className:"space-y-4",children:w.map(l=>e.jsx(le,{farm:l,onStake:()=>t(l),formatCurrency:a},l.id))}),e.jsx(S,{value:"my-farms",className:"space-y-4",children:c.isConnected?j.length>0?j.map(l=>e.jsx(ie,{farm:l,getUserFarmData:v,onStake:()=>t(l),onUnstake:()=>d(l),onClaim:()=>b.mutate(l.id),isClaimPending:b.isPending},l.id)):e.jsx(de,{onStartFarming:()=>{s.length>0&&(r(s[0]),x("stake"),n(!0))}}):e.jsx(ce,{})})]}),u&&e.jsx(re,{farm:u,isOpen:m,onClose:()=>{n(!1),r(null)},action:i})]})}function le({farm:s,onStake:c,formatCurrency:u}){return e.jsx(g,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center -space-x-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-background overflow-hidden",children:e.jsx("img",{src:R(s.stakingToken.symbol),alt:s.stakingToken.symbol,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-background overflow-hidden bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 text-white"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Stake ",s.stakingToken.symbol," • Earn ",s.rewardToken.symbol]})]}),e.jsxs(f,{variant:"secondary",className:"bg-purple-100 text-purple-700",children:[s.multiplier,"x"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-8 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"APY"}),e.jsx(f,{variant:"secondary",className:"text-green-600 text-lg",children:"100%-400%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"TVL"}),e.jsx("p",{className:"font-semibold",children:u(s.tvl)})]}),e.jsx("div",{className:"space-x-2",children:e.jsxs(k,{size:"sm",className:"bg-purple-600 hover:bg-purple-700",onClick:c,children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Stake"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reward per Block"}),e.jsxs("p",{className:"font-medium",children:[s.rewardPerBlock," ",s.rewardToken.symbol]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Lock Period"}),e.jsxs("p",{className:"font-medium",children:[s.lockPeriod," days min"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pool Weight"}),e.jsxs("p",{className:"font-medium",children:[s.poolWeight,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(f,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Ended"})]})]})]})})}function ie({farm:s,getUserFarmData:c,onStake:u,onUnstake:r,onClaim:m,isClaimPending:n}){const i=c(s.id);return e.jsx(g,{className:"border-purple-200",children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center -space-x-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full border-2 border-background overflow-hidden",children:e.jsx("img",{src:R(s.stakingToken.symbol),alt:s.stakingToken.symbol,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-background overflow-hidden bg-gradient-to-r from-green-500 to-blue-500 flex items-center justify-center",children:e.jsx(q,{className:"w-4 h-4 text-white"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Staked: ",i?.totalStaked||"0.000"," ",s.stakingToken.symbol]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[i?.pendingRewards||"0.000"," XPS"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["≈ $",parseFloat(i?.pendingRewards||"0").toFixed(2)]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Staked Amount"}),e.jsxs("p",{className:"font-semibold",children:[i?.totalStaked||"0.000"," ",s.stakingToken.symbol]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Rewards"}),e.jsxs("p",{className:"font-semibold text-green-600",children:[i?.pendingRewards||"0.000"," XPS"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"APY"}),e.jsx(f,{variant:"secondary",className:"text-green-600",children:"100%-400%"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pool Share"}),e.jsx("p",{className:"font-semibold",children:"0.05%"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:u,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Stake More"]}),e.jsxs(k,{size:"sm",variant:"outline",onClick:r,children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Unstake"]}),e.jsxs(k,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:m,disabled:parseFloat(i?.pendingRewards||"0")===0||n,children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),n?"Claiming...":"Claim Rewards"]})]})]})})}function de({onStartFarming:s}){return e.jsx(g,{children:e.jsxs(p,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No active farms"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You haven't staked in any farms yet."}),e.jsx(k,{onClick:s,children:"Start Farming"})]})})}function ce(){return e.jsx(g,{children:e.jsxs(p,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Connect your wallet"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your wallet to view your farming positions."})]})})}function Ne(){const{wallet:s}=A(),[c,u]=N.useState(""),{data:r=[],isLoading:m}=P({queryKey:["farming-pools"],queryFn:async()=>{const o=await fetch(ae("api/farming/pools"));if(!o.ok)throw new Error("Failed to fetch farms");return o.json()}}),n=r.filter(o=>o.stakingToken.symbol.toLowerCase().includes(c.toLowerCase())||o.rewardToken.symbol.toLowerCase().includes(c.toLowerCase())||o.name.toLowerCase().includes(c.toLowerCase())),i=n.filter(o=>o.isActive),x=n.filter(o=>!o.isActive);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx(g,{className:"bg-gradient-to-r from-yellow-500 via-orange-500 to-red-500 text-white border-0",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx(Q,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"XPS Staking Farm Yield Maximization"}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Up to 400% APY staking + 2.5x LP farm reward boost"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(f,{variant:"secondary",className:"bg-white/20 text-white border-white/30",children:"Yield Booster"}),e.jsxs(k,{variant:"secondary",className:"bg-white text-orange-600 hover:bg-white/90",onClick:()=>window.location.href="/xpswap/documentation#xps-whitepaper",children:["Start Staking ",e.jsx(W,{className:"w-4 h-4 ml-2"})]})]})]})})})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Yield Farming"}),e.jsx("p",{className:"text-muted-foreground",children:"Stake LP tokens to earn additional rewards"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Value Staked"}),e.jsx($,{className:"w-4 h-4 text-green-500"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"$9.0M"}),e.jsx(f,{variant:"outline",className:"text-green-600 border-green-200",children:"+22.4%"})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Total Rewards"}),e.jsx(M,{className:"w-4 h-4 text-purple-500"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"125K XP"}),e.jsx(f,{variant:"outline",className:"text-purple-600 border-purple-200",children:"Daily"})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Active Farms"}),e.jsx(M,{className:"w-4 h-4 text-blue-500"})]}),e.jsx("div",{className:"text-2xl font-bold",children:i.length}),e.jsx(f,{variant:"outline",className:"text-blue-600 border-blue-200",children:"Live"})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Max APR"}),e.jsx($,{className:"w-4 h-4 text-orange-500"})]}),e.jsx("div",{className:"text-2xl font-bold",children:"125.5%"}),e.jsx(f,{variant:"outline",className:"text-orange-600 border-orange-200",children:"XP/USDT"})]})})]}),e.jsxs(U,{defaultValue:"active",className:"space-y-6",children:[e.jsxs(I,{className:"grid w-full grid-cols-3",children:[e.jsxs(y,{value:"active",children:["Active Farms (",i.length,")"]}),e.jsx(y,{value:"my-farms",children:"My Farms"}),e.jsxs(y,{value:"ended",children:["Ended Farms (",x.length,")"]})]}),e.jsxs(S,{value:"active",className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search farms by token symbol or name",value:c,onChange:o=>u(o.target.value),className:"pl-10"})]}),m?e.jsx("div",{className:"text-center py-8",children:"Loading farms..."}):e.jsx(C,{farms:n})]}),e.jsx(S,{value:"my-farms",className:"space-y-6",children:m?e.jsx("div",{className:"text-center py-8",children:"Loading farms..."}):e.jsx(C,{farms:n})}),e.jsx(S,{value:"ended",className:"space-y-6",children:m?e.jsx("div",{className:"text-center py-8",children:"Loading farms..."}):e.jsx(C,{farms:x})})]})]})}export{Ne as default};
