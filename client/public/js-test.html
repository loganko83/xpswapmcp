<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPSwap JavaScript í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #10b981;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: #60a5fa;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .test-result {
            background: #334155;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #6366f1;
        }
        
        .test-result.success {
            border-left-color: #10b981;
        }
        
        .test-result.error {
            border-left-color: #ef4444;
        }
        
        .test-result.warning {
            border-left-color: #f59e0b;
        }
        
        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .test-details {
            font-size: 14px;
            color: #94a3b8;
        }
        
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        
        button:hover {
            background: #059669;
        }
        
        .code-block {
            background: #0f172a;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .summary {
            background: #1e293b;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .summary h3 {
            color: #10b981;
            margin-top: 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-warning { background: #f59e0b; }
    </style>
</head>
<body>
    <h1>ğŸ§ª XPSwap JavaScript í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>ğŸ”§ í…ŒìŠ¤íŠ¸ ì œì–´</h2>
        <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button onclick="runBasicTests()">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ë§Œ</button>
        <button onclick="runAdvancedTests()">ê³ ê¸‰ í…ŒìŠ¤íŠ¸ë§Œ</button>
        <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
        <button onclick="exportResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
    </div>
    
    <div class="summary" id="testSummary" style="display: none;">
        <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ìš”ì•½</h3>
        <div id="summaryContent"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸŒ ë¸Œë¼ìš°ì € ê¸°ë³¸ ê¸°ëŠ¥</h2>
        <div id="browserTests"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”— API ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <div id="apiTests"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’° ì•”í˜¸í™”í ê¸°ëŠ¥</h2>
        <div id="cryptoTests"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ¨ UI ì»´í¬ë„ŒíŠ¸</h2>
        <div id="uiTests"></div>
    </div>
    
    <div class="test-section">
        <h2>âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div id="performanceTests"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” ë³´ì•ˆ ê¸°ëŠ¥</h2>
        <div id="securityTests"></div>
    </div>

    <script>
        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥
        let testResults = [];
        
        // í™˜ê²½ ê°ì§€
        const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const baseApiUrl = isLocal ? 'http://localhost:5000/xpswap/api' : '/xpswap/api';
        
        // í…ŒìŠ¤íŠ¸ ì •ì˜
        const testSuites = {
            browser: [
                {
                    name: 'JavaScript ê¸°ë³¸ ê¸°ëŠ¥',
                    test: () => {
                        const arr = [1, 2, 3];
                        const result = arr.map(x => x * 2);
                        return { success: JSON.stringify(result) === '[2,4,6]', details: `ê²°ê³¼: [${result}]` };
                    }
                },
                {
                    name: 'ES6 ì§€ì› (Arrow Functions)',
                    test: () => {
                        const fn = (x) => x + 1;
                        return { success: fn(5) === 6, details: 'Arrow function í…ŒìŠ¤íŠ¸' };
                    }
                },
                {
                    name: 'Promise ì§€ì›',
                    test: async () => {
                        return new Promise(resolve => {
                            setTimeout(() => {
                                resolve({ success: true, details: 'Promise ì •ìƒ ì‘ë™' });
                            }, 100);
                        });
                    }
                },
                {
                    name: 'Fetch API ì§€ì›',
                    test: () => {
                        return { success: typeof fetch !== 'undefined', details: `Fetch API: ${typeof fetch}` };
                    }
                },
                {
                    name: 'Local Storage',
                    test: () => {
                        try {
                            localStorage.setItem('test', 'value');
                            const value = localStorage.getItem('test');
                            localStorage.removeItem('test');
                            return { success: value === 'value', details: 'ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì½ê¸°/ì“°ê¸° ì •ìƒ' };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'Session Storage',
                    test: () => {
                        try {
                            sessionStorage.setItem('test', 'value');
                            const value = sessionStorage.getItem('test');
                            sessionStorage.removeItem('test');
                            return { success: value === 'value', details: 'ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì½ê¸°/ì“°ê¸° ì •ìƒ' };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                }
            ],
            
            api: [
                {
                    name: 'Health Check API',
                    test: async () => {
                        try {
                            const response = await fetch(`${baseApiUrl}/health`);
                            const data = await response.json();
                            return { 
                                success: response.ok, 
                                details: `ìƒíƒœ: ${response.status}, ì‘ë‹µ: ${JSON.stringify(data)}` 
                            };
                        } catch (e) {
                            return { success: false, details: `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'Crypto Ticker API',
                    test: async () => {
                        try {
                            const response = await fetch(`${baseApiUrl}/crypto-ticker`);
                            const data = await response.json();
                            return { 
                                success: response.ok && Array.isArray(data), 
                                details: `í‹°ì»¤ ê°œìˆ˜: ${Array.isArray(data) ? data.length : 'N/A'}` 
                            };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'XP Price API',
                    test: async () => {
                        try {
                            const response = await fetch(`${baseApiUrl}/xp-price`);
                            const data = await response.json();
                            return { 
                                success: response.ok && typeof data.price === 'number', 
                                details: `XP ê°€ê²©: $${data.price || 'N/A'}` 
                            };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'Market Stats API',
                    test: async () => {
                        try {
                            const response = await fetch(`${baseApiUrl}/market-stats`);
                            const data = await response.json();
                            return { 
                                success: response.ok, 
                                details: `ì‹œì¥ ë°ì´í„°: ${Object.keys(data || {}).length}ê°œ í•­ëª©` 
                            };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                }
            ],
            
            crypto: [
                {
                    name: 'Web3 ì§€ì› ê°ì§€',
                    test: () => {
                        const hasWeb3 = typeof window.ethereum !== 'undefined';
                        return { 
                            success: hasWeb3, 
                            details: hasWeb3 ? 'MetaMask ë˜ëŠ” Web3 ì§€ê°‘ ê°ì§€ë¨' : 'Web3 ì§€ê°‘ ì—†ìŒ' 
                        };
                    }
                },
                {
                    name: 'MetaMask ì—°ê²° ê°€ëŠ¥ì„±',
                    test: async () => {
                        if (typeof window.ethereum === 'undefined') {
                            return { success: false, details: 'MetaMask ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ' };
                        }
                        
                        try {
                            const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                            return { 
                                success: true, 
                                details: `ì—°ê²°ëœ ê³„ì •: ${accounts.length}ê°œ` 
                            };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'ë„¤íŠ¸ì›Œí¬ ê°ì§€',
                    test: async () => {
                        if (typeof window.ethereum === 'undefined') {
                            return { success: false, details: 'MetaMask ì—†ìŒ' };
                        }
                        
                        try {
                            const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                            return { 
                                success: true, 
                                details: `ì²´ì¸ ID: ${chainId} (${parseInt(chainId, 16)})` 
                            };
                        } catch (e) {
                            return { success: false, details: `ì˜¤ë¥˜: ${e.message}` };
                        }
                    }
                }
            ],
            
            ui: [
                {
                    name: 'DOM ì¡°ì‘',
                    test: () => {
                        const div = document.createElement('div');
                        div.textContent = 'Test';
                        document.body.appendChild(div);
                        const found = document.body.contains(div);
                        document.body.removeChild(div);
                        return { success: found, details: 'DOM ìš”ì†Œ ì¶”ê°€/ì œê±° ì •ìƒ' };
                    }
                },
                {
                    name: 'CSS ì§€ì›',
                    test: () => {
                        const div = document.createElement('div');
                        div.style.display = 'none';
                        const supported = div.style.display === 'none';
                        return { success: supported, details: 'CSS ìŠ¤íƒ€ì¼ ì ìš© ì •ìƒ' };
                    }
                },
                {
                    name: 'Event Listener',
                    test: () => {
                        let eventFired = false;
                        const div = document.createElement('div');
                        
                        const handler = () => { eventFired = true; };
                        div.addEventListener('click', handler);
                        
                        // ì´ë²¤íŠ¸ ë°œìƒ ì‹œë®¬ë ˆì´ì…˜
                        const event = new Event('click');
                        div.dispatchEvent(event);
                        
                        div.removeEventListener('click', handler);
                        
                        return { success: eventFired, details: 'ì´ë²¤íŠ¸ ì²˜ë¦¬ ì •ìƒ' };
                    }
                }
            ],
            
            performance: [
                {
                    name: 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ì •',
                    test: () => {
                        if (performance.memory) {
                            const memory = performance.memory;
                            const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                            const limitMB = Math.round(memory.jsHeapSizeLimit / 1024 / 1024);
                            return { 
                                success: true, 
                                details: `ì‚¬ìš©: ${usedMB}MB / í•œê³„: ${limitMB}MB` 
                            };
                        }
                        return { success: false, details: 'ë©”ëª¨ë¦¬ ì •ë³´ ì§€ì›ë˜ì§€ ì•ŠìŒ' };
                    }
                },
                {
                    name: 'íƒ€ì´ë° API',
                    test: () => {
                        const start = performance.now();
                        // ê°„ë‹¨í•œ ê³„ì‚°
                        let sum = 0;
                        for (let i = 0; i < 1000; i++) {
                            sum += i;
                        }
                        const duration = performance.now() - start;
                        return { 
                            success: duration >= 0, 
                            details: `ê³„ì‚° ì‹œê°„: ${duration.toFixed(2)}ms` 
                        };
                    }
                },
                {
                    name: 'ë¦¬ì†ŒìŠ¤ íƒ€ì´ë°',
                    test: () => {
                        const resources = performance.getEntriesByType('resource');
                        return { 
                            success: resources.length > 0, 
                            details: `ë¡œë“œëœ ë¦¬ì†ŒìŠ¤: ${resources.length}ê°œ` 
                        };
                    }
                }
            ],
            
            security: [
                {
                    name: 'HTTPS ì‚¬ìš©',
                    test: () => {
                        const isHTTPS = location.protocol === 'https:';
                        return { 
                            success: isHTTPS || isLocal, 
                            details: `í”„ë¡œí† ì½œ: ${location.protocol} (${isLocal ? 'ë¡œì»¬ ê°œë°œ' : isHTTPS ? 'ë³´ì•ˆ' : 'ë¹„ë³´ì•ˆ'})` 
                        };
                    }
                },
                {
                    name: 'Content Security Policy',
                    test: () => {
                        const meta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
                        return { 
                            success: meta !== null, 
                            details: meta ? 'CSP í—¤ë” ë°œê²¬' : 'CSP í—¤ë” ì—†ìŒ' 
                        };
                    }
                },
                {
                    name: 'Same-Origin Policy',
                    test: () => {
                        // ê¸°ë³¸ì ìœ¼ë¡œ ë™ì¼ ì¶œì²˜ì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ true
                        return { 
                            success: true, 
                            details: `ì¶œì²˜: ${location.origin}` 
                        };
                    }
                }
            ]
        };
        
        function runTest(testCase) {
            return new Promise(async (resolve) => {
                const startTime = performance.now();
                try {
                    const result = await testCase.test();
                    const duration = performance.now() - startTime;
                    resolve({
                        name: testCase.name,
                        success: result.success,
                        details: result.details,
                        duration: Math.round(duration * 100) / 100,
                        error: null
                    });
                } catch (error) {
                    const duration = performance.now() - startTime;
                    resolve({
                        name: testCase.name,
                        success: false,
                        details: error.message,
                        duration: Math.round(duration * 100) / 100,
                        error: error.toString()
                    });
                }
            });
        }
        
        function displayResult(result, containerId) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${result.success ? 'success' : 'error'}`;
            
            resultDiv.innerHTML = `
                <div class="test-name">
                    <span class="status-indicator status-${result.success ? 'success' : 'error'}"></span>
                    ${result.name}
                    <span style="float: right; font-size: 12px; color: #94a3b8;">${result.duration}ms</span>
                </div>
                <div class="test-details">${result.details}</div>
                ${result.error ? `<div class="code-block">${result.error}</div>` : ''}
            `;
            
            container.appendChild(resultDiv);
        }
        
        async function runTestSuite(suiteName, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '<div style="color: #6366f1;">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';
            
            const suite = testSuites[suiteName];
            const results = [];
            
            for (const testCase of suite) {
                const result = await runTest(testCase);
                results.push(result);
                displayResult(result, containerId);
                
                // ê° í…ŒìŠ¤íŠ¸ ì‚¬ì´ì— ì•½ê°„ì˜ ì§€ì—°
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            // ì²« ë²ˆì§¸ "ì‹¤í–‰ ì¤‘..." ë©”ì‹œì§€ ì œê±°
            const loadingMsg = container.querySelector('div');
            if (loadingMsg && loadingMsg.textContent.includes('í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘')) {
                container.removeChild(loadingMsg);
            }
            
            return results;
        }
        
        async function runAllTests() {
            testResults = [];
            clearResults();
            
            const suites = ['browser', 'api', 'crypto', 'ui', 'performance', 'security'];
            const containers = ['browserTests', 'apiTests', 'cryptoTests', 'uiTests', 'performanceTests', 'securityTests'];
            
            for (let i = 0; i < suites.length; i++) {
                const results = await runTestSuite(suites[i], containers[i]);
                testResults.push(...results);
            }
            
            updateSummary();
        }
        
        async function runBasicTests() {
            testResults = [];
            clearResults();
            
            const results1 = await runTestSuite('browser', 'browserTests');
            const results2 = await runTestSuite('api', 'apiTests');
            
            testResults.push(...results1, ...results2);
            updateSummary();
        }
        
        async function runAdvancedTests() {
            testResults = [];
            clearResults();
            
            const results1 = await runTestSuite('crypto', 'cryptoTests');
            const results2 = await runTestSuite('performance', 'performanceTests');
            const results3 = await runTestSuite('security', 'securityTests');
            
            testResults.push(...results1, ...results2, ...results3);
            updateSummary();
        }
        
        function clearResults() {
            const containers = ['browserTests', 'apiTests', 'cryptoTests', 'uiTests', 'performanceTests', 'securityTests'];
            containers.forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            document.getElementById('testSummary').style.display = 'none';
        }
        
        function updateSummary() {
            const totalTests = testResults.length;
            const passedTests = testResults.filter(r => r.success).length;
            const failedTests = totalTests - passedTests;
            const avgDuration = totalTests > 0 ? 
                Math.round((testResults.reduce((sum, r) => sum + r.duration, 0) / totalTests) * 100) / 100 : 0;
            
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #10b981;">${passedTests}</div>
                        <div style="color: #94a3b8;">ì„±ê³µ</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #ef4444;">${failedTests}</div>
                        <div style="color: #94a3b8;">ì‹¤íŒ¨</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #60a5fa;">${totalTests}</div>
                        <div style="color: #94a3b8;">ì „ì²´</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${avgDuration}ms</div>
                        <div style="color: #94a3b8;">í‰ê·  ì‹œê°„</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #334155; border-radius: 6px;">
                    ì„±ê³µë¥ : ${totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0}%
                </div>
            `;
            
            document.getElementById('testSummary').style.display = 'block';
        }
        
        function exportResults() {
            if (testResults.length === 0) {
                alert('ì‹¤í–‰ëœ í…ŒìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const report = {
                timestamp: new Date().toISOString(),
                environment: isLocal ? 'local' : 'production',
                userAgent: navigator.userAgent,
                url: window.location.href,
                baseApiUrl: baseApiUrl,
                testResults: testResults,
                summary: {
                    total: testResults.length,
                    passed: testResults.filter(r => r.success).length,
                    failed: testResults.filter(r => !r.success).length,
                    averageDuration: testResults.reduce((sum, r) => sum + r.duration, 0) / testResults.length
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xpswap-js-test-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('XPSwap JavaScript í…ŒìŠ¤íŠ¸ ë„êµ¬ ë¡œë“œë¨');
            console.log('í™˜ê²½:', isLocal ? 'LOCAL' : 'PRODUCTION');
            console.log('API Base URL:', baseApiUrl);
        });
    </script>
</body>
</html>
