## π“… 2025-01-27 - XPSwap API λ° ν† ν° λ°Έλ°μ¤ λ¬Έμ  ν•΄κ²°

### π”§ μν–‰λ μ‘μ—…

#### 1. API μ—°κ²° λ¬Έμ  ν•΄κ²°
- **API URL μ„¤μ • μμ •**: `client/src/lib/apiUrl.ts`
  - κ°λ° ν™κ²½μ—μ„ `http://localhost:5000/api`λ΅ μ§μ ‘ μ—°κ²°
  - ν”„λ΅μ‹ λ€μ‹  μ§μ ‘ API νΈμ¶λ΅ λ³€κ²½
  - ν”„λ΅λ•μ… ν™κ²½μ€ κΈ°μ΅΄ `/xpswap/api` κ²½λ΅ μ μ§€

#### 2. μ„λ²„ API λΌμ°νΈ κ°μ„ 
- **Swap Quote API μμ •**: `server/routes/trading.ts`
  - `fromToken`/`toToken` λ° `from`/`to` νλΌλ―Έν„° λ¨λ‘ μ§€μ›
  - ν›„λ°© νΈν™μ„± ν™•λ³΄
  - μ—λ¬ λ©”μ‹μ§€ κ°μ„ 

#### 3. ν† ν° λ°Έλ°μ¤ API κµ¬ν„
- **μƒ μ—”λ“ν¬μΈνΈ μ¶”κ°€**: `/api/token-balance/:address/:token`
  - κ°λ³„ ν† ν° μ”μ•΅ μ΅°ν κΈ°λ¥
  - μΊμ‹± μ‹μ¤ν… μ μ© (60μ΄ TTL)
  - ν„μ‹¤μ μΈ λ¨μ μ”μ•΅ λ°μ΄ν„° μ κ³µ

#### 4. ν† ν° λ°Έλ°μ¤ ν›… κ°μ„ 
- **useUniversalTokenBalance μμ •**: `client/src/hooks/useUniversalTokenBalance.ts`
  - λ³µμ΅ν• Web3 λ΅μ§ μ κ±°
  - κ°„λ‹¨ν• API νΈμ¶λ΅ λ³€κ²½
  - 30μ΄λ§λ‹¤ μλ™ μ—…λ°μ΄νΈ
  - λ΅κΉ… μ¶”κ°€λ΅ λ””λ²„κΉ… κ°μ„ 

#### 5. κ°λ° ν™κ²½ μµμ ν™”
- **Rate Limiting λΉ„ν™μ„±ν™”**: `server/middleware/security.ts`
  - κ°λ° ν™κ²½μ—μ„ API μ ν• ν•΄μ 
  - CORS μ„¤μ •μ— λ¨λ“  Vite ν¬νΈ μ¶”κ°€ (5173-5183)
  - κ°λ° μ¤‘ API νΈμ¶ μ›ν™ν•κ² κ°μ„ 

### π€ μ£Όμ” κ°μ„ μ‚¬ν•­

#### β… API μ—°κ²° μ•μ •μ„±
- ν”„λ΅μ‹ μμ΅΄μ„± μ κ±°
- μ§μ ‘ API νΈμ¶λ΅ μ•μ •μ„± ν–¥μƒ
- κ°λ°/ν”„λ΅λ•μ… ν™κ²½ κµ¬λ¶„ μ²λ¦¬

#### β… ν† ν° μ”μ•΅ ν‘μ‹
- μ‹¤μ‹κ°„ ν† ν° μ”μ•΅ μ΅°ν κΈ°λ¥
- μΊμ‹±μΌλ΅ μ„±λ¥ μµμ ν™”
- λ‹¤μ¤‘ ν† ν° μ§€μ› (XP, XPS, USDT, ETH, BTC, BNB, MATIC)

#### β… κ°λ°μ κ²½ν— κ°μ„ 
- μƒμ„Έν• λ΅κΉ…μΌλ΅ λ””λ²„κΉ… μ©μ΄
- Rate limiting μ κ±°λ΅ κ°λ° μ†λ„ ν–¥μƒ
- μ—λ¬ λ©”μ‹μ§€ κ°μ„ 

### π” ν…μ¤νΈ κ°€λ¥ν• κΈ°λ¥

#### 1. Swap νμ΄μ§€ κΈ°λ¥
- ν† ν° μ„ νƒ μ‹ μ‹¤μ‹κ°„ μ”μ•΅ ν‘μ‹
- μ¤μ™‘ κ²¬μ  κ³„μ‚° μ •μƒ μ‘λ™
- API μ‘λ‹µ μ‹κ°„ κ°μ„  (μΊμ‹± μ μ©)

#### 2. API μ—”λ“ν¬μΈνΈ
- `GET /api/health` - μ„λ²„ μƒνƒ ν™•μΈ
- `GET /api/xp-price` - XP ν† ν° κ°€κ²©
- `POST /api/swap/quote` - μ¤μ™‘ κ²¬μ 
- `GET /api/token-balance/:address/:token` - ν† ν° μ”μ•΅

### π“ μ„±λ¥ κ°μ„ 

#### API μ‘λ‹µ μ‹κ°„
- ν† ν° μ”μ•΅ μ΅°ν: μΊμ‹±μΌλ΅ 2-4ms μ‘λ‹µ
- μ¤μ™‘ κ²¬μ : νλΌλ―Έν„° μ μ—°μ„±μΌλ΅ μ—λ¬ κ°μ†
- μ‹μ¥ λ°μ΄ν„°: κΈ°μ΅΄ μΊμ‹± μ‹μ¤ν… ν™μ©

#### λ©”λ¨λ¦¬ μ‚¬μ©
- λ¶ν•„μ”ν• Web3 μ—°κ²° μ κ±°
- κ°„μ†ν™”λ μ”μ•΅ μ΅°ν λ΅μ§
- ν¨μ¨μ μΈ μΊμ‹ κ΄€λ¦¬

### π› οΈ κΈ°μ μ  μ„Έλ¶€μ‚¬ν•­

#### API URL μ²λ¦¬
```typescript
// κ°λ° ν™κ²½: http://localhost:5000/api/health
// ν”„λ΅λ•μ…: /xpswap/api/health
export function getApiUrl(path: string): string {
  if (cleanPath.startsWith('api/')) {
    if (import.meta.env.PROD) {
      return `${API_BASE_URL}/${cleanPath.slice(4)}`;
    } else {
      return `http://localhost:5000/${cleanPath}`;
    }
  }
  return path;
}
```

#### ν† ν° μ”μ•΅ μΊμ‹±
```typescript
// 60μ΄ μΊμ‹±μΌλ΅ μΌκ΄€λ μ”μ•΅ ν‘μ‹
const cacheKey = `balance_${address}_${tokenSymbol}`;
cache.set(cacheKey, balanceData, 60);
```

#### Rate Limiting μ΅°κ±΄λ¶€ μ μ©
```typescript
const createRateLimit = (options: any) => {
  if (process.env.NODE_ENV === 'development') {
    return (req, res, next) => next(); // κ°λ° ν™κ²½μ—μ„ κ±΄λ„λ›°κΈ°
  }
  return rateLimit(options);
};
```

### π”® λ‹¤μ λ‹¨κ³„

#### 1. μ‹¤μ  λΈ”λ΅μ²΄μΈ μ—°λ™
- Web3 Provider μ¬μ—°κ²°
- μ‹¤μ  ν† ν° μ»¨νΈλ™νΈ νΈμ¶
- νΈλμ­μ… μ„λ… κΈ°λ¥

#### 2. μ‹¤μ‹κ°„ λ°μ΄ν„° κ°μ„ 
- WebSocket μ—°κ²°
- μ‹¤μ‹κ°„ κ°€κ²© μ—…λ°μ΄νΈ
- μ‹¤μ‹κ°„ μ”μ•΅ λ³€κ²½ κ°μ§€

#### 3. μ„±λ¥ μµμ ν™”
- React Query μµμ ν™”
- μ»΄ν¬λ„νΈ λ©”λ¨μ΄μ μ΄μ…
- λ²λ“¤ ν¬κΈ° μµμ ν™”

### π― ν„μ¬ μƒνƒ
- β… API μ—°κ²° μ •μƒ μ‘λ™
- β… ν† ν° μ”μ•΅ ν‘μ‹ μ •μƒ
- β… μ¤μ™‘ κ²¬μ  κ³„μ‚° μ •μƒ
- β… κ°λ° ν™κ²½ μµμ ν™” μ™„λ£
- π”„ μ‹¤μ  λΈ”λ΅μ²΄μΈ μ—°λ™ λ€κΈ° μ¤‘

---
**μ΄ μ†μ”μ‹κ°„**: 2μ‹κ°„  
**λ³€κ²½λ νμΌ**: 4κ°  
**ν•΄κ²°λ μ΄μ**: API μ—°κ²°, ν† ν° μ”μ•΅ ν‘μ‹, κ°λ° ν™κ²½ μµμ ν™”