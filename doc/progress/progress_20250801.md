# XPSwap í•˜ì–€í™”ë©´ ë¬¸ì œ í•´ê²° - ì™„ë£Œ âœ…
**ë‚ ì§œ**: 2025ë…„ 8ì›” 1ì¼  
**ì‹œê°„**: 17:20  
**ìƒíƒœ**: ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ, ì„œë²„ ê´€ë¦¬ì ì‹¤í–‰ ëŒ€ê¸°

## ğŸ¯ ë¬¸ì œ ìš”ì•½
- **í˜„ìƒ**: https://trendy.storydot.kr/xpswap/ ì ‘ì† ì‹œ í•˜ì–€í™”ë©´ í‘œì‹œ
- **ì›ì¸**: Apache ì„¤ì •ì—ì„œ ì˜ëª»ëœ ë””ë ‰í„°ë¦¬ ê²½ë¡œ ì‚¬ìš©
- **í•´ê²°**: ìë™í™”ëœ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ

## ğŸ› ï¸ ìƒì„±ëœ í•´ê²° ìŠ¤í¬ë¦½íŠ¸

### 1. ì„œë²„ ì§„ë‹¨ ìŠ¤í¬ë¦½íŠ¸ (`server-diagnosis.sh`)
```bash
# 13ê°œ í•­ëª© ì¢…í•© ì§„ë‹¨
bash server-diagnosis.sh > diagnosis-report.log 2>&1
cat diagnosis-report.log
```

**ì§„ë‹¨ í•­ëª©**:
- âœ… í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸
- âœ… ë¹Œë“œ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€
- âœ… PM2 í”„ë¡œì„¸ìŠ¤ ìƒíƒœ
- âœ… Apache ì„¤ì • ê²€ì¦
- âœ… API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- âœ… í¬íŠ¸ ì‚¬ìš© í˜„í™©
- âœ… í™˜ê²½ë³€ìˆ˜ í™•ì¸
- âœ… Git ìƒíƒœ ì ê²€
- âœ… ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§

### 2. í†µí•© ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸ (`fix-apache-unified.sh`)
```bash
# ì›í´ë¦­ ìë™ ìˆ˜ì • (ê´€ë¦¬ì ê¶Œí•œ í•„ìš”)
sudo bash fix-apache-unified.sh
```

**ìë™ ìˆ˜ì • ê¸°ëŠ¥**:
1. **ë°±ì—… ìƒì„±** - ê¸°ì¡´ ì„¤ì • ì•ˆì „ ë³´ê´€
2. **í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸** - Git pull + npm install
3. **í´ë¼ì´ì–¸íŠ¸ ë¹Œë“œ** - `npm run build:client`
4. **ì„œë²„ ë¹Œë“œ** - `npm run build:server`
5. **Apache ì„¤ì • ìˆ˜ì •** - ì˜¬ë°”ë¥¸ ê²½ë¡œë¡œ êµì²´
6. **íŒŒì¼ ê¶Œí•œ ì„¤ì •** - www-data:www-data, 755 ê¶Œí•œ
7. **Apache ì¬ë¡œë“œ** - ì„¤ì • ì ìš©
8. **PM2 ì¬ì‹œì‘** - API ì„œë¹„ìŠ¤ ì¬ì‹œì‘
9. **ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸** - ì¢…í•© í…ŒìŠ¤íŠ¸
10. **ìµœì¢… ê²°ê³¼ ë³´ê³ ** - ì„±ê³µ/ì‹¤íŒ¨ ì•ˆë‚´

### 3. ë¸Œë¼ìš°ì € ë””ë²„ê¹… ìŠ¤í¬ë¦½íŠ¸ (`browser-debug.js`)
```javascript
// F12 ê°œë°œì ë„êµ¬ì—ì„œ ì‹¤í–‰
const script = document.createElement('script');
script.src = '/xpswap/browser-debug.js';
document.head.appendChild(script);
```

**ë””ë²„ê¹… ê¸°ëŠ¥**:
- React ì•± ë¡œë”© ìƒíƒœ í™•ì¸
- API ì—”ë“œí¬ì¸íŠ¸ ì‘ë‹µ í…ŒìŠ¤íŠ¸
- JavaScript ì—ëŸ¬ ê°ì§€
- DOM ìƒíƒœ ë¶„ì„
- ìë™ ìˆ˜ì • ì œì•ˆ

## ğŸ”§ í•µì‹¬ ìˆ˜ì • ë‚´ìš©

### Apache ì„¤ì • êµì²´
**âŒ ê¸°ì¡´ (ì˜ëª»ëœ ê²½ë¡œ)**:
```apache
Alias /xpswap /var/www/storage/xpswap
```

**âœ… ìˆ˜ì • (ì˜¬ë°”ë¥¸ ê²½ë¡œ)**:
```apache
Alias /xpswap /var/www/storage/xpswap/client/dist
```

### React Router SPA ì§€ì› ê°•í™”
```apache
<Directory /var/www/storage/xpswap/client/dist>
    Options FollowSymLinks
    AllowOverride None
    Require all granted
    DirectoryIndex index.html
    
    # React Router Support
    RewriteEngine On
    RewriteBase /xpswap
    
    # Skip API routes
    RewriteCond %{REQUEST_URI} !^/xpswap/api/
    
    # Serve existing files directly
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # Route everything else to index.html
    RewriteRule ^.*$ /xpswap/index.html [L]
</Directory>
```

### API í”„ë¡ì‹œ ì„¤ì • ìœ ì§€
```apache
ProxyPass /xpswap/api http://localhost:5000/xpswap/api
ProxyPassReverse /xpswap/api http://localhost:5000/xpswap/api
```

## ğŸ“‹ ì„œë²„ ê´€ë¦¬ì ì‹¤í–‰ ë‹¨ê³„

### 1ë‹¨ê³„: SSH ì ‘ì†
```bash
ssh ubuntu@trendy.storydot.kr
cd /var/www/storage/xpswap
```

### 2ë‹¨ê³„: ìµœì‹  ìŠ¤í¬ë¦½íŠ¸ ë‹¤ìš´ë¡œë“œ
```bash
git pull origin main
```

### 3ë‹¨ê³„: ì§„ë‹¨ ì‹¤í–‰ (ì„ íƒì‚¬í•­)
```bash
bash server-diagnosis.sh > diagnosis-report.log 2>&1
cat diagnosis-report.log
```

### 4ë‹¨ê³„: ìë™ ìˆ˜ì • ì‹¤í–‰ (í•µì‹¬)
```bash
sudo bash fix-apache-unified.sh
```

## ğŸ‰ ì˜ˆìƒ ê²°ê³¼

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„:
- âœ… `https://trendy.storydot.kr/xpswap/` â†’ XPSwap ë©”ì¸í˜ì´ì§€ í‘œì‹œ
- âœ… React Router ì •ìƒ ì‘ë™ (ìƒˆë¡œê³ ì¹¨í•´ë„ ì‘ë™)
- âœ… API ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ì‘ë‹µ
- âœ… ì•”í˜¸í™”í í‹°ì»¤ í‘œì‹œ
- âœ… ëª¨ë“  ë©”ë‰´ì™€ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

## ğŸ†˜ ë¬¸ì œ ì§€ì† ì‹œ ì¶”ê°€ í™•ì¸

### ë¡œê·¸ í™•ì¸
```bash
# Apache ì—ëŸ¬ ë¡œê·¸
tail -f /var/log/apache2/error.log

# PM2 í”„ë¡œì„¸ìŠ¤ ë¡œê·¸
pm2 logs xpswap-api --lines 50
```

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸
```bash
# API í…ŒìŠ¤íŠ¸
curl https://trendy.storydot.kr/xpswap/api/health

# ì •ì  íŒŒì¼ í…ŒìŠ¤íŠ¸
curl -I https://trendy.storydot.kr/xpswap/
```

### ê¶Œí•œ ì¬ì„¤ì •
```bash
sudo chown -R www-data:www-data /var/www/storage/xpswap/client/dist/
sudo chmod -R 755 /var/www/storage/xpswap/client/dist/
```

## ğŸ“Š ê¸°ìˆ ì  ë¶„ì„

### ë¬¸ì œ ì›ì¸
1. **ì˜ëª»ëœ Apache Alias ê²½ë¡œ**: í”„ë¡œì íŠ¸ ë£¨íŠ¸ ëŒ€ì‹  ë¹Œë“œëœ í´ë¼ì´ì–¸íŠ¸ ë””ë ‰í„°ë¦¬ ì‚¬ìš©
2. **React Router ì„¤ì • ëˆ„ë½**: SPA ë¼ìš°íŒ… ì§€ì› ë¶€ì¡±
3. **ë¹Œë“œ íŒŒì¼ ë¶€ì¬**: `client/dist/index.html` ë¯¸ì¡´ì¬ ê°€ëŠ¥ì„±
4. **íŒŒì¼ ê¶Œí•œ ë¬¸ì œ**: www-data ê¶Œí•œ ì„¤ì • ëˆ„ë½

### í•´ê²° ë°©ë²•
1. **ê²½ë¡œ ìˆ˜ì •**: `/var/www/storage/xpswap/client/dist` ì‚¬ìš©
2. **SPA ì§€ì›**: RewriteRuleë¡œ ëª¨ë“  ìš”ì²­ì„ index.htmlë¡œ ë¼ìš°íŒ…
3. **ìë™ ë¹Œë“œ**: npm run build:client ì‹¤í–‰
4. **ê¶Œí•œ ì„¤ì •**: chown + chmod ìë™ ì ìš©

## ğŸ”„ í–¥í›„ ìœ ì§€ë³´ìˆ˜

### ì •ê¸° ì ê²€ í•­ëª©
- [ ] ë¹Œë“œ íŒŒì¼ ì¡´ì¬ í™•ì¸
- [ ] PM2 í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- [ ] API ì‘ë‹µ ì‹œê°„ í™•ì¸
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ ì ê²€

### ìë™í™” ê°œì„ 
- **CI/CD íŒŒì´í”„ë¼ì¸**: GitHub Actions ì¶”ê°€ ê³ ë ¤
- **í—¬ìŠ¤ì²´í¬ API**: ì£¼ê¸°ì  ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
- **ëª¨ë‹ˆí„°ë§ ì•Œë¦¼**: ì„œë¹„ìŠ¤ ë‹¤ìš´ ì‹œ ìë™ ì•Œë¦¼

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ì„œë²„ ì§„ë‹¨ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
- [x] í†µí•© ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
- [x] ë¸Œë¼ìš°ì € ë””ë²„ê¹… ë„êµ¬ ìƒì„±
- [x] GitHub ì €ì¥ì†Œ ì—…ë¡œë“œ
- [x] ë¬¸ì„œí™” ì™„ë£Œ
- [ ] ì„œë²„ ê´€ë¦¬ì ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ëŒ€ê¸° ì¤‘)
- [ ] ì‹¤ì œ ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™ í™•ì¸ (ëŒ€ê¸° ì¤‘)

---

**ğŸ“ ë‹¤ìŒ ë‹¨ê³„**: ì„œë²„ ê´€ë¦¬ìê°€ `sudo bash fix-apache-unified.sh` ì‹¤í–‰
**â° ì˜ˆìƒ ì‹œê°„**: 5-10ë¶„ ë‚´ ì™„ë£Œ
**ğŸ¯ ì„±ê³µ ì§€í‘œ**: https://trendy.storydot.kr/xpswap/ ì •ìƒ ì ‘ì†
