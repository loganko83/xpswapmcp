import{r as c,F as f,j as e,ad as H,a9 as E,t as I,aw as V,aB as X,B as K}from"./react-CnjVYTDc.js";import{f as O,C as a,a as l,b as d,c as o,B as w,d as F,g as x}from"./index-DxHLzNoH.js";import{I as W}from"./input-BJWVzqi3.js";import{T as J,a as M,b as p,c as N}from"./tabs-1rBqboxz.js";import{S as P,a as A,b as q,c as U,d as h}from"./select-CKrfnZoO.js";import{T as Q}from"./textarea-1azl9xt-.js";import"./vendor-B0r8BCsL.js";import"./utils-BkLtITBR.js";import"./ui-BQCqNqg0.js";import"./router-B_5Dh3-u.js";import"./web3-30Ii_1H8.js";function Z(){const{wallet:t}=O(),[G,$]=c.useState("execute"),[i,B]=c.useState("XP"),[n,S]=c.useState(""),[m,g]=c.useState(""),[u,y]=c.useState(""),[D,R]=c.useState(0),{data:T}=f({queryKey:["/api/flashloans/pools"],queryFn:async()=>{const s=await fetch(x("/api/flashloans/pools"));if(!s.ok)throw new Error("Failed to fetch pools");return s.json()}}),{data:v}=f({queryKey:["/api/flashloans/templates"],queryFn:async()=>{const s=await fetch(x("/api/flashloans/templates"));if(!s.ok)throw new Error("Failed to fetch templates");return s.json()}}),{data:C}=f({queryKey:["/api/flashloans/history",t?.address],queryFn:async()=>{if(!t?.address)return[];const s=await fetch(x(`/api/flashloans/history?address=${t.address}`));if(!s.ok)throw new Error("Failed to fetch history");return s.json()},enabled:!!t?.address}),{data:j}=f({queryKey:["/api/flashloans/analytics"],queryFn:async()=>{const s=await fetch(x("/api/flashloans/analytics"));if(!s.ok)throw new Error("Failed to fetch analytics");return s.json()}}),r=T?.find(s=>s.symbol===i),L=()=>!r||!n?0:parseFloat(n)*r.fee,z=async()=>{if(!t?.address||!n||!m){alert("Please fill in all fields and connect your wallet");return}try{const s=await fetch(x("/api/flashloans/execute"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:t.address,token:i,amount:parseFloat(n),code:m,templateId:u})});if(!s.ok)throw new Error("Flash loan execution failed");const b=await s.json();alert(`Flash loan executed successfully! Transaction hash: ${b.txHash}`),S(""),g(""),y("")}catch(s){console.error("Flash loan error:",s),alert("Flash loan execution failed. Please check your code and try again.")}},k=s=>{y(s.id),g(s.code),R(s.estimatedGas)};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Flash Loans"}),e.jsx("p",{className:"text-muted-foreground",children:"Execute instant, uncollateralized loans for arbitrage and liquidations"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Volume (24h)"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",j?.volume24h?.toLocaleString()||0]})]}),e.jsx(H,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Loans"}),e.jsx("p",{className:"text-2xl font-bold",children:j?.totalLoans?.toLocaleString()||0})]}),e.jsx(E,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[j?.successRate?.toFixed(1)||0,"%"]})]}),e.jsx(I,{className:"w-8 h-8 text-purple-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Profit"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",j?.avgProfit?.toFixed(2)||0]})]}),e.jsx(V,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs(J,{value:G,onValueChange:$,className:"w-full",children:[e.jsxs(M,{className:"grid w-full grid-cols-4",children:[e.jsx(p,{value:"execute",children:"Execute Loan"}),e.jsx(p,{value:"templates",children:"Templates"}),e.jsx(p,{value:"pools",children:"Pools"}),e.jsx(p,{value:"history",children:"History"})]}),e.jsx(N,{value:"execute",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(a,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Configure Flash Loan"]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Token"}),e.jsxs(P,{value:i,onValueChange:B,children:[e.jsx(A,{children:e.jsx(q,{placeholder:"Select token"})}),e.jsxs(U,{children:[e.jsx(h,{value:"XP",children:"XP Token"}),e.jsx(h,{value:"XPS",children:"XPS Token"}),e.jsx(h,{value:"USDT",children:"USDT"}),e.jsx(h,{value:"ETH",children:"Ethereum"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Loan Amount"}),e.jsx(W,{type:"number",placeholder:"Enter amount",value:n,onChange:s=>S(s.target.value)}),r&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Available: ",r.available.toLocaleString()," ",r.symbol]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Loan Details"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Loan Amount:"}),e.jsxs("span",{children:[n||0," ",i]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Fee (",r?.fee?(r.fee*100).toFixed(3):0,"%):"]}),e.jsxs("span",{children:[L().toFixed(6)," ",i]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Repayment:"}),e.jsxs("span",{children:[(parseFloat(n||"0")+L()).toFixed(6)," ",i]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Estimated Gas:"}),e.jsxs("span",{children:[D.toLocaleString()," gas"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Load Template (Optional)"}),e.jsxs(P,{value:u,onValueChange:y,children:[e.jsx(A,{children:e.jsx(q,{placeholder:"Select a template"})}),e.jsx(U,{children:v?.map(s=>e.jsxs(h,{value:s.id,children:[s.name," - ",s.difficulty]},s.id))})]})]}),u&&e.jsx(w,{variant:"outline",onClick:()=>{const s=v?.find(b=>b.id===u);s&&k(s)},children:"Load Template Code"})]})]}),e.jsxs(a,{children:[e.jsx(d,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),"Smart Contract Code"]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Flash Loan Logic"}),e.jsx(Q,{placeholder:"Enter your flash loan logic here...",value:m,onChange:s=>g(s.target.value),className:"min-h-[300px] font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Write your arbitrage or liquidation logic. The flash loan will be executed atomically."})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(K,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"Ensure your code includes profit calculation and loan repayment logic"})]}),e.jsx(w,{onClick:z,className:"w-full",disabled:!t?.isConnected||!m||!n,children:t?.isConnected?"Execute Flash Loan":"Connect Wallet"})]})]})]})}),e.jsx(N,{value:"templates",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v?.map(s=>e.jsxs(a,{className:"cursor-pointer hover:shadow-md transition-shadow",children:[e.jsx(d,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(o,{className:"text-lg",children:s.name}),e.jsx(F,{variant:s.difficulty==="beginner"?"default":s.difficulty==="intermediate"?"secondary":"destructive",children:s.difficulty})]})}),e.jsxs(l,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Category: ",s.category]}),e.jsxs("span",{className:"text-muted-foreground",children:["Gas: ",s.estimatedGas.toLocaleString()]})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>k(s),className:"w-full",children:"Use Template"})]})]},s.id))})}),e.jsx(N,{value:"pools",className:"space-y-4",children:e.jsxs(a,{children:[e.jsx(d,{children:e.jsx(o,{children:"Available Flash Loan Pools"})}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Token"}),e.jsx("th",{className:"text-left p-2",children:"Available"}),e.jsx("th",{className:"text-left p-2",children:"Fee"}),e.jsx("th",{className:"text-left p-2",children:"Max Amount"}),e.jsx("th",{className:"text-left p-2",children:"Utilization"}),e.jsx("th",{className:"text-left p-2",children:"Status"})]})}),e.jsx("tbody",{children:T?.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-2 font-medium",children:s.symbol}),e.jsx("td",{className:"p-2",children:s.available.toLocaleString()}),e.jsxs("td",{className:"p-2",children:[(s.fee*100).toFixed(3),"%"]}),e.jsx("td",{className:"p-2",children:s.maxAmount.toLocaleString()}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${s.utilizationRate*100}%`}})}),e.jsxs("span",{children:[(s.utilizationRate*100).toFixed(1),"%"]})]})}),e.jsx("td",{className:"p-2",children:e.jsx(F,{variant:s.available>0?"default":"destructive",children:s.available>0?"Active":"Depleted"})})]},s.symbol))})]})})})]})}),e.jsx(N,{value:"history",className:"space-y-4",children:e.jsxs(a,{children:[e.jsx(d,{children:e.jsx(o,{children:"Flash Loan History"})}),e.jsx(l,{children:C?.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No flash loan transactions found. Start trading to see your history here."}):e.jsx("div",{className:"space-y-4",children:C?.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:[s.amount.toLocaleString()," ",s.token," Flash Loan"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx(F,{variant:s.status==="success"?"default":s.status==="failed"?"destructive":"secondary",children:s.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Fee Paid"}),e.jsxs("p",{className:"font-medium",children:[s.fee.toFixed(6)," ",s.token]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Gas Used"}),e.jsx("p",{className:"font-medium",children:s.gasUsed.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Strategy"}),e.jsx("p",{className:"font-medium",children:s.strategy})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Profit"}),e.jsxs("p",{className:`font-medium ${s.profit>=0?"text-green-600":"text-red-600"}`,children:[s.profit>=0?"+":"","$",s.profit.toFixed(2)]})]})]})]},s.id))})})]})})]})]})}function de(){return e.jsx(Z,{})}export{de as default};
