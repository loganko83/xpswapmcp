import{r as h,j as e}from"./react-B-ht5LAu.js";import{i as Y,b,C as u,c as j,d as T,e as S,B as K,f as L,g as f}from"./index-CunMlly4.js";import{I as C}from"./input-C7h7K1mu.js";import{T as z,a as W,b as O,c as P}from"./tabs-BjtZ7Jla.js";import{S as k,a as I,b as E,c as F,d as x}from"./select-DQquyDyO.js";import{p as J,u as Z,Y as G,T as ee,I as se}from"./utils-B8vuxRvf.js";import"./vendor-CEoFgRlV.js";import"./router-QSY63kmV.js";import"./ui-CRT7ecel.js";import"./web3-C8Lu7bQ_.js";const te=1e5,ae=.1,ie=3600,ne=365*24*3600;function re(a,n,c,t,p,r){const d=[],i=[];let o=0;Math.abs(a-n)/n>.5&&(i.push("Strike price is far from spot price (>50% deviation)"),o+=20),t<ie?d.push("Option expires too soon (minimum 1 hour)"):t>ne&&d.push("Option expiry too far (maximum 1 year)");const l=p*n/r;return l>ae?d.push(`Position size too large: ${(l*100).toFixed(2)}% of liquidity`):l>.05&&(i.push(`Large position size: ${(l*100).toFixed(2)}% of liquidity`),o+=15),r<te&&(i.push("Low liquidity warning"),o+=25),{isValid:d.length===0,errors:d,warnings:i,riskScore:Math.min(o,100)}}function le(a,n,c,t,p){const r=a==="call"?Math.max(0,c-n):Math.max(0,n-c),i=t*c*.2+r*t,o=1+(p-.3)*.5;return i*Math.max(1,o)}function ce(a,n){const c=n?.02:.005,t=a*(1-c),p=a*(1+c),r=Math.floor(Date.now()/1e3)+300;return{minPrice:t,maxPrice:p,deadline:r}}function oe(){const{wallet:a}=Y(),[n,c]=h.useState("trade"),[t,p]=h.useState("XP"),[r,d]=h.useState("call"),[i,o]=h.useState(""),[y,v]=h.useState(""),[l,$]=h.useState(""),[g,R]=h.useState("buy"),{data:D}=b({queryKey:["/api/options/contracts",t],queryFn:async()=>{const s=await fetch(f(`/api/options/contracts?underlying=${t}`));if(!s.ok)throw new Error("Failed to fetch option contracts");return s.json()}}),{data:q}=b({queryKey:["/api/options/positions",a?.address],queryFn:async()=>{if(!a?.address)return[];const s=await fetch(f(`/api/options/positions?address=${a.address}`));if(!s.ok)throw new Error("Failed to fetch positions");return s.json()},enabled:!!a?.address}),{data:N}=b({queryKey:["/api/options/analytics"],queryFn:async()=>{const s=await fetch(f("/api/options/analytics"));if(!s.ok)throw new Error("Failed to fetch option analytics");return s.json()}}),A=async()=>{if(!a?.address||!i||!y||!l){alert("Please fill in all fields and connect your wallet");return}try{const w=(await(await fetch(f(`/api/price/${t}`))).json()).price,_=(await(await fetch(f(`/api/options/liquidity/${t}`))).json()).totalLiquidity||1e5,U=new Date(y).getTime()/1e3,X=Date.now()/1e3,B=U-X,m=re(parseFloat(i),w,.5,B,parseFloat(l),_);if(!m.isValid){alert(`Security validation failed:
${m.errors.join(`
`)}`);return}if(m.warnings.length>0&&!confirm(`Security warnings detected:
${m.warnings.join(`
`)}

Risk Score: ${m.riskScore}/100

Do you want to proceed?`))return;const M=le(r,parseFloat(i),w,parseFloat(l),.5),H=ce(w,g==="buy"),V=await fetch(f("/api/options/trade"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:a.address,underlying:t,type:r,strikePrice:parseFloat(i),expiry:y,quantity:parseFloat(l),orderType:g,marginRequired:M,antiMEVParams:H,securityCheck:{riskScore:m.riskScore,warnings:m.warnings}})});if(!V.ok)throw new Error("Trade failed");const Q=await V.json();alert(`Option ${g} order placed successfully!
Transaction hash: ${Q.txHash}
Margin locked: $${M.toFixed(2)}`),o(""),v(""),$("")}catch(s){console.error("Trading error:",s),alert("Trading failed. Please try again.")}};return e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Options Trading"}),e.jsx("p",{className:"text-muted-foreground",children:"Trade advanced options contracts with sophisticated risk management"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(u,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Volume (24h)"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",N?.volume24h?.toLocaleString()||0]})]}),e.jsx(J,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(u,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Open Interest"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",N?.openInterest?.toLocaleString()||0]})]}),e.jsx(Z,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(u,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Contracts"}),e.jsx("p",{className:"text-2xl font-bold",children:N?.activeContracts||0})]}),e.jsx(G,{className:"w-8 h-8 text-purple-500"})]})})}),e.jsx(u,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg IV"}),e.jsxs("p",{className:"text-2xl font-bold",children:[N?.avgImpliedVolatility?.toFixed(1)||0,"%"]})]}),e.jsx(ee,{className:"w-8 h-8 text-orange-500"})]})})})]}),e.jsxs(z,{value:n,onValueChange:c,className:"w-full",children:[e.jsxs(W,{className:"grid w-full grid-cols-3",children:[e.jsx(O,{value:"trade",children:"Trade Options"}),e.jsx(O,{value:"positions",children:"My Positions"}),e.jsx(O,{value:"chain",children:"Option Chain"})]}),e.jsx(P,{value:"trade",className:"space-y-6",children:e.jsxs(u,{children:[e.jsx(T,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Create Option Order"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Underlying Asset"}),e.jsxs(k,{value:t,onValueChange:p,children:[e.jsx(I,{children:e.jsx(E,{placeholder:"Select asset"})}),e.jsxs(F,{children:[e.jsx(x,{value:"XP",children:"XP Token"}),e.jsx(x,{value:"XPS",children:"XPS Token"}),e.jsx(x,{value:"BTC",children:"Bitcoin"}),e.jsx(x,{value:"ETH",children:"Ethereum"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Option Type"}),e.jsxs(k,{value:r,onValueChange:s=>d(s),children:[e.jsx(I,{children:e.jsx(E,{placeholder:"Select type"})}),e.jsxs(F,{children:[e.jsx(x,{value:"call",children:"Call Option"}),e.jsx(x,{value:"put",children:"Put Option"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strike Price"}),e.jsx(C,{type:"number",placeholder:"Enter strike price",value:i,onChange:s=>o(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Expiry Date"}),e.jsx(C,{type:"date",value:y,onChange:s=>v(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Quantity"}),e.jsx(C,{type:"number",placeholder:"Enter quantity",value:l,onChange:s=>$(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Order Type"}),e.jsxs(k,{value:g,onValueChange:s=>R(s),children:[e.jsx(I,{children:e.jsx(E,{placeholder:"Select order type"})}),e.jsxs(F,{children:[e.jsx(x,{value:"buy",children:"Buy to Open"}),e.jsx(x,{value:"sell",children:"Sell to Open"})]})]})]})]}),e.jsx(K,{onClick:A,className:"w-full",disabled:!a?.isConnected,children:a?.isConnected?`${g} Option`:"Connect Wallet"})]})]})}),e.jsx(P,{value:"positions",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(T,{children:e.jsx(S,{children:"My Option Positions"})}),e.jsx(j,{children:q?.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No option positions found. Start trading to see your positions here."}):e.jsx("div",{className:"space-y-4",children:q?.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:[s.contract.underlying," ",s.contract.strikePrice," ",s.contract.type.toUpperCase()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Expires: ",new Date(s.contract.expiryDate).toLocaleDateString()]})]}),e.jsx(L,{variant:s.position==="long"?"default":"destructive",children:s.position.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:s.quantity})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Entry Price"}),e.jsxs("p",{className:"font-medium",children:["$",s.entryPrice.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Current Price"}),e.jsxs("p",{className:"font-medium",children:["$",s.currentPrice.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"P&L"}),e.jsxs("p",{className:`font-medium ${s.pnl>=0?"text-green-600":"text-red-600"}`,children:["$",s.pnl.toFixed(2)," (",s.pnlPercentage.toFixed(2),"%)"]})]})]})]},s.id))})})]})}),e.jsx(P,{value:"chain",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(T,{children:e.jsxs(S,{children:["Option Chain - ",t]})}),e.jsx(j,{children:D?.length===0?e.jsxs("p",{className:"text-center text-muted-foreground py-8",children:["No option contracts available for ",t,"."]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Strike"}),e.jsx("th",{className:"text-left p-2",children:"Type"}),e.jsx("th",{className:"text-left p-2",children:"Premium"}),e.jsx("th",{className:"text-left p-2",children:"Volume"}),e.jsx("th",{className:"text-left p-2",children:"OI"}),e.jsx("th",{className:"text-left p-2",children:"IV"}),e.jsx("th",{className:"text-left p-2",children:"Delta"}),e.jsx("th",{className:"text-left p-2",children:"Expiry"})]})}),e.jsx("tbody",{children:D?.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"p-2 font-medium",children:["$",s.strikePrice]}),e.jsx("td",{className:"p-2",children:e.jsx(L,{variant:s.type==="call"?"default":"destructive",children:s.type.toUpperCase()})}),e.jsxs("td",{className:"p-2",children:["$",s.premium.toFixed(4)]}),e.jsx("td",{className:"p-2",children:s.volume.toLocaleString()}),e.jsx("td",{className:"p-2",children:s.openInterest.toLocaleString()}),e.jsxs("td",{className:"p-2",children:[(s.impliedVolatility*100).toFixed(1),"%"]}),e.jsx("td",{className:"p-2",children:s.delta.toFixed(3)}),e.jsx("td",{className:"p-2",children:new Date(s.expiryDate).toLocaleDateString()})]},s.id))})]})})})]})})]})]})}function Te(){return e.jsx(oe,{})}export{Te as default};
