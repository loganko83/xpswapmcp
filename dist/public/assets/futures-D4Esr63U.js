import{r,j as e}from"./react-B-ht5LAu.js";import{p as le,i as ne,b as p,f as k,B as i,C as f,d as g,e as N,c as v,g as m}from"./index-CunMlly4.js";import{I as V}from"./input-C7h7K1mu.js";import{S as z,a as q,b as $,c as O,d as u}from"./select-DQquyDyO.js";import{H,J as ie,K as ce,M as de}from"./ui-CRT7ecel.js";import{a5 as oe,Z as xe,ax as he,ay as me,l as ue,az as je,ao as pe,R as fe}from"./utils-B8vuxRvf.js";import"./vendor-CEoFgRlV.js";import"./router-QSY63kmV.js";import"./web3-C8Lu7bQ_.js";const K=r.forwardRef(({className:t,...T},I)=>e.jsxs(H,{ref:I,className:le("relative flex w-full touch-none select-none items-center",t),...T,children:[e.jsx(ie,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(ce,{className:"absolute h-full bg-primary"})}),e.jsx(de,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));K.displayName=H.displayName;function ge(){const{wallet:t}=ne(),[T,I]=r.useState("trade"),[n,D]=r.useState("XP-PERP"),[c,C]=r.useState("buy"),[d,y]=r.useState(""),[x,A]=r.useState([10]),[b,W]=r.useState("limit"),[o,j]=r.useState(""),[R,J]=r.useState(""),[w,E]=r.useState(!1),[L,Q]=r.useState("cross"),[F,Z]=r.useState(!0),[Ne,ve]=r.useState(!0),[P,U]=r.useState(!1);r.useRef(null);const{data:M,refetch:ye}=p({queryKey:["/api/hyperliquid/contracts"],queryFn:async()=>{const s=await fetch(m("/api/hyperliquid/contracts"));if(!s.ok)throw new Error("Failed to fetch contracts");return s.json()},refetchInterval:1e3}),{data:S}=p({queryKey:["/api/hyperliquid/orderbook",n],queryFn:async()=>{const s=await fetch(m(`/api/hyperliquid/orderbook/${n}`));if(!s.ok)throw new Error("Failed to fetch order book");return s.json()},refetchInterval:500}),{data:B}=p({queryKey:["/api/hyperliquid/positions",t?.address],queryFn:async()=>{if(!t?.address)return[];const s=await fetch(m(`/api/hyperliquid/positions?address=${t.address}`));if(!s.ok)throw new Error("Failed to fetch positions");return s.json()},enabled:!!t?.address,refetchInterval:2e3}),{data:X}=p({queryKey:["/api/hyperliquid/trades",n],queryFn:async()=>{const s=await fetch(m(`/api/hyperliquid/trades/${n}`));if(!s.ok)throw new Error("Failed to fetch trades");return s.json()},refetchInterval:1e3}),{data:be}=p({queryKey:["/api/hyperliquid/chart",n],queryFn:async()=>{const s=await fetch(m(`/api/hyperliquid/chart/${n}?interval=1m&limit=100`));if(!s.ok)throw new Error("Failed to fetch chart data");return s.json()},refetchInterval:5e3}),a=M?.find(s=>s.symbol===n);r.useEffect(()=>{a&&!o&&j(c==="buy"?a.bidPrice.toString():a.askPrice.toString())},[n,c,a]);const G=()=>{if(!a||!d)return 0;const s=x[0],l=parseFloat(o)||a.markPrice,h=.005;return c==="buy"?l*(1-1/s+h):l*(1+1/s-h)},Y=()=>{if(!a||!d)return 0;const s=parseFloat(d),l=parseFloat(o)||a.markPrice;return s*l/x[0]},_=()=>{if(!a||!d)return 0;const s=parseFloat(d),l=parseFloat(o)||a.markPrice,h=b==="market"?5e-4:-25e-5;return Math.abs(s*l*h)},ee=s=>{if(!t?.balance||!a)return;const l=t.balance*x[0]*s/100,h=parseFloat(o)||a.markPrice;y((l/h).toFixed(4))},se=async()=>{if(!t?.address||!d){alert("Please fill in all fields and connect your wallet");return}try{const s=await fetch(m("/api/hyperliquid/order"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:t.address,symbol:n,side:c,size:parseFloat(d),leverage:x[0],orderType:b,limitPrice:o?parseFloat(o):void 0,stopPrice:R?parseFloat(R):void 0,reduceOnly:w,marginMode:L})});if(!s.ok)throw new Error("Order failed");const l=await s.json();alert(`Order placed successfully! Order ID: ${l.orderId}`),y(""),J("")}catch(s){console.error("Trading error:",s),alert("Order failed. Please try again.")}},ae=()=>e.jsxs(f,{className:"h-full",children:[e.jsx(g,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(N,{className:"text-sm",children:"Order Book"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>Z(!F),children:F?e.jsx(je,{className:"w-4 h-4"}):e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",children:e.jsx(fe,{className:"w-4 h-4"})})]})]})}),F&&e.jsx(v,{className:"p-0",children:e.jsxs("div",{className:"h-96 overflow-hidden",children:[e.jsx("div",{className:"h-48 overflow-y-auto",children:S?.asks?.slice(0,15).reverse().map((s,l)=>e.jsxs("div",{className:"flex justify-between px-3 py-1 text-xs hover:bg-red-500/10 cursor-pointer",onClick:()=>j(s.price.toString()),children:[e.jsx("span",{className:"text-red-500",children:s.price.toFixed(4)}),e.jsx("span",{className:"text-muted-foreground",children:s.size.toFixed(2)}),e.jsx("span",{className:"text-muted-foreground",children:s.total.toFixed(2)})]},`ask-${l}`))}),e.jsxs("div",{className:"border-y bg-muted/30 px-3 py-2 text-center",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Spread: $",((S?.asks?.[0]?.price||0)-(S?.bids?.[0]?.price||0)).toFixed(4)]}),e.jsxs("div",{className:"text-lg font-bold",children:["$",a?.markPrice.toFixed(4)]})]}),e.jsx("div",{className:"h-48 overflow-y-auto",children:S?.bids?.slice(0,15).map((s,l)=>e.jsxs("div",{className:"flex justify-between px-3 py-1 text-xs hover:bg-green-500/10 cursor-pointer",onClick:()=>j(s.price.toString()),children:[e.jsx("span",{className:"text-green-500",children:s.price.toFixed(4)}),e.jsx("span",{className:"text-muted-foreground",children:s.size.toFixed(2)}),e.jsx("span",{className:"text-muted-foreground",children:s.total.toFixed(2)})]},`bid-${l}`))})]})})]}),re=()=>e.jsxs(f,{className:"h-full",children:[e.jsx(g,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(N,{className:"text-sm",children:[n," Chart"]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>U(!P),children:P?e.jsx(he,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"})})})]})}),e.jsx(v,{className:"p-2",children:e.jsx("div",{className:`bg-black rounded-lg flex items-center justify-center text-green-400 font-mono ${P?"h-96":"h-64"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("div",{children:"Advanced TradingView Chart"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:["Price: $",a?.markPrice.toFixed(4)]}),e.jsxs("div",{className:"text-xs",children:["24h: ",e.jsxs("span",{className:a?.priceChangePercent24h&&a.priceChangePercent24h>=0?"text-green-400":"text-red-400",children:[a?.priceChangePercent24h.toFixed(2),"%"]})]})]})})})]}),te=()=>e.jsxs(f,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(N,{className:"text-sm",children:"Recent Trades"})}),e.jsx(v,{className:"p-0",children:e.jsxs("div",{className:"h-48 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between px-3 py-2 text-xs font-medium border-b",children:[e.jsx("span",{children:"Price"}),e.jsx("span",{children:"Size"}),e.jsx("span",{children:"Time"})]}),X?.slice(0,20).map((s,l)=>e.jsxs("div",{className:"flex justify-between px-3 py-1 text-xs hover:bg-muted/50",children:[e.jsx("span",{className:s.side==="buy"?"text-green-500":"text-red-500",children:s.price.toFixed(4)}),e.jsx("span",{className:"text-muted-foreground",children:s.size.toFixed(2)}),e.jsx("span",{className:"text-muted-foreground",children:new Date(s.timestamp).toLocaleTimeString()})]},s.id))]})})]});return e.jsxs("div",{className:"w-full h-screen flex flex-col bg-background",children:[e.jsxs("div",{className:"border-b p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:"HyperSwap"}),e.jsxs(z,{value:n,onValueChange:D,children:[e.jsx(q,{className:"w-40",children:e.jsx($,{})}),e.jsx(O,{children:M?.map(s=>e.jsx(u,{value:s.symbol,children:s.symbol},s.symbol))})]}),a&&e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"font-mono font-bold text-lg",children:["$",a.markPrice.toFixed(4)]}),e.jsxs(k,{variant:a.priceChangePercent24h>=0?"default":"destructive",children:[a.priceChangePercent24h>=0?"+":"",a.priceChangePercent24h.toFixed(2),"%"]}),e.jsxs("span",{className:"text-muted-foreground",children:["Vol: $",a.volume24h.toLocaleString()]}),e.jsxs("span",{className:"text-muted-foreground",children:["OI: $",a.openInterest.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",children:e.jsx(oe,{className:"w-4 h-4"})}),t?.isConnected?e.jsxs(k,{variant:"outline",className:"bg-green-50",children:[t.address?.slice(0,6),"...",t.address?.slice(-4)]}):e.jsx(i,{size:"sm",children:"Connect Wallet"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 p-4",children:e.jsx(re,{})}),e.jsxs("div",{className:"w-80 p-4 border-x space-y-4",children:[e.jsx(ae,{}),e.jsx(te,{})]}),e.jsxs("div",{className:"w-80 p-4 space-y-4",children:[e.jsxs(f,{children:[e.jsx(g,{className:"pb-2",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Place Order"]})}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1 p-1 bg-muted rounded-lg",children:[e.jsx(i,{variant:c==="buy"?"default":"ghost",size:"sm",onClick:()=>C("buy"),className:c==="buy"?"bg-green-600 hover:bg-green-700":"",children:"Buy / Long"}),e.jsx(i,{variant:c==="sell"?"default":"ghost",size:"sm",onClick:()=>C("sell"),className:c==="sell"?"bg-red-600 hover:bg-red-700":"",children:"Sell / Short"})]}),e.jsxs(z,{value:b,onValueChange:s=>W(s),children:[e.jsx(q,{className:"h-8",children:e.jsx($,{})}),e.jsxs(O,{children:[e.jsx(u,{value:"limit",children:"Limit"}),e.jsx(u,{value:"market",children:"Market"}),e.jsx(u,{value:"stop",children:"Stop"})]})]}),b!=="market"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Price"}),e.jsx(V,{type:"number",placeholder:"0.0000",value:o,onChange:s=>j(s.target.value),className:"h-8 font-mono"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Size"}),e.jsx(V,{type:"number",placeholder:"0.00",value:d,onChange:s=>y(s.target.value),className:"h-8 font-mono"}),e.jsx("div",{className:"grid grid-cols-4 gap-1",children:[25,50,75,100].map(s=>e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>ee(s),className:"h-6 text-xs",children:[s,"%"]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-xs font-medium",children:"Leverage"}),e.jsxs("span",{className:"text-xs",children:[x[0],"x"]})]}),e.jsx(K,{value:x,onValueChange:A,max:a?.maxLeverage||100,min:1,step:1,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Reduce Only"}),e.jsx(i,{variant:w?"default":"outline",size:"sm",onClick:()=>E(!w),className:"h-6 text-xs",children:w?"ON":"OFF"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Margin Mode"}),e.jsxs(z,{value:L,onValueChange:s=>Q(s),children:[e.jsx(q,{className:"h-6 w-20 text-xs",children:e.jsx($,{})}),e.jsxs(O,{children:[e.jsx(u,{value:"cross",children:"Cross"}),e.jsx(u,{value:"isolated",children:"Isolated"})]})]})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Required Margin:"}),e.jsxs("span",{className:"font-mono",children:["$",Y().toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Est. Liq. Price:"}),e.jsxs("span",{className:"font-mono text-red-500",children:["$",G().toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Est. Fee:"}),e.jsxs("span",{className:"font-mono",children:["$",_().toFixed(2)]})]})]}),e.jsx(i,{onClick:se,className:`w-full h-10 font-semibold ${c==="buy"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,disabled:!t?.isConnected||!d,children:t?.isConnected?`${c==="buy"?"Buy / Long":"Sell / Short"} ${n}`:"Connect Wallet"})]})]}),e.jsxs(f,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(N,{className:"text-sm",children:"Positions"})}),e.jsx(v,{className:"p-0",children:e.jsx("div",{className:"max-h-64 overflow-y-auto",children:B?.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8 text-xs",children:"No positions"}):B?.map(s=>e.jsxs("div",{className:"border-b p-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s.symbol}),e.jsxs(k,{variant:s.side==="long"?"default":"destructive",className:"text-xs",children:[s.side," ",s.leverage,"x"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-mono text-sm ${s.unrealizedPnl>=0?"text-green-600":"text-red-600"}`,children:[s.unrealizedPnl>=0?"+":"","$",s.unrealizedPnl.toFixed(2)]}),e.jsxs("div",{className:`font-mono text-xs ${s.unrealizedPnlPercent>=0?"text-green-600":"text-red-600"}`,children:["(",s.unrealizedPnlPercent.toFixed(2),"%)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Size: "}),e.jsxs("span",{className:"font-mono",children:["$",s.size.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Entry: "}),e.jsxs("span",{className:"font-mono",children:["$",s.entryPrice.toFixed(4)]})]})]}),e.jsx(i,{variant:"outline",size:"sm",className:"w-full h-6 text-xs",onClick:()=>{C(s.side==="long"?"sell":"buy"),y(s.size.toString()),E(!0)},children:"Close Position"})]},s.id))})})]})]})]})]})}function Oe(){return e.jsx(ge,{})}export{Oe as default};
