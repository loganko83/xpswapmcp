import{x as Zi,y as Zn,z as Yn,A as Yi,B as Qi,C as qi,D as ta,E as ea,F as Mt,G as na,H as Ye,I as ra,J as sa}from"./vendor-CEoFgRlV.js";const gs="6.15.0";function ia(r,t,e){const n=t.split("|").map(i=>i.trim());for(let i=0;i<n.length;i++)switch(t){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof r===t)return}const s=new Error(`invalid value for type ${t}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${e}`,s.value=r,s}async function Y(r){const t=Object.keys(r);return(await Promise.all(t.map(n=>Promise.resolve(r[n])))).reduce((n,s,i)=>(n[t[i]]=s,n),{})}function E(r,t,e){for(let n in t){let s=t[n];const i=e?e[n]:null;i&&ia(s,i,n),Object.defineProperty(r,n,{enumerable:!0,value:s,writable:!1})}}function ce(r,t){if(r==null)return"null";if(t==null&&(t=new Set),typeof r=="object"){if(t.has(r))return"[Circular]";t.add(r)}if(Array.isArray(r))return"[ "+r.map(e=>ce(e,t)).join(", ")+" ]";if(r instanceof Uint8Array){const e="0123456789abcdef";let n="0x";for(let s=0;s<r.length;s++)n+=e[r[s]>>4],n+=e[r[s]&15];return n}if(typeof r=="object"&&typeof r.toJSON=="function")return ce(r.toJSON(),t);switch(typeof r){case"boolean":case"number":case"symbol":return r.toString();case"bigint":return BigInt(r).toString();case"string":return JSON.stringify(r);case"object":{const e=Object.keys(r);return e.sort(),"{ "+e.map(n=>`${ce(n,t)}: ${ce(r[n],t)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function j(r,t){return r&&r.code===t}function Qn(r){return j(r,"CALL_EXCEPTION")}function F(r,t,e){let n=r;{const i=[];if(e){if("message"in e||"code"in e||"name"in e)throw new Error(`value will overwrite populated values: ${ce(e)}`);for(const a in e){if(a==="shortMessage")continue;const o=e[a];i.push(a+"="+ce(o))}}i.push(`code=${t}`),i.push(`version=${gs}`),i.length&&(r+=" ("+i.join(", ")+")")}let s;switch(t){case"INVALID_ARGUMENT":s=new TypeError(r);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(r);break;default:s=new Error(r)}return E(s,{code:t}),e&&Object.assign(s,e),s.shortMessage==null&&E(s,{shortMessage:n}),s}function p(r,t,e,n){if(!r)throw F(t,e,n)}function l(r,t,e,n){p(r,t,"INVALID_ARGUMENT",{argument:e,value:n})}function ms(r,t,e){e==null&&(e=""),e&&(e=": "+e),p(r>=t,"missing argument"+e,"MISSING_ARGUMENT",{count:r,expectedCount:t}),p(r<=t,"too many arguments"+e,"UNEXPECTED_ARGUMENT",{count:r,expectedCount:t})}const aa=["NFD","NFC","NFKD","NFKC"].reduce((r,t)=>{try{if("test".normalize(t)!=="test")throw new Error("bad");if(t==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");r.push(t)}catch{}return r},[]);function ys(r){p(aa.indexOf(r)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:r}})}function _t(r,t,e){if(e==null&&(e=""),r!==t){let n=e,s="new";e&&(n+=".",s+=" "+e),p(!1,`private constructor; use ${n}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function bs(r,t,e){if(r instanceof Uint8Array)return e?new Uint8Array(r):r;if(typeof r=="string"&&r.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const n=new Uint8Array((r.length-2)/2);let s=2;for(let i=0;i<n.length;i++)n[i]=parseInt(r.substring(s,s+2),16),s+=2;return n}l(!1,"invalid BytesLike value",t||"value",r)}function y(r,t){return bs(r,t,!1)}function Z(r,t){return bs(r,t,!0)}function U(r,t){return!(typeof r!="string"||!r.match(/^0x[0-9A-Fa-f]*$/)||typeof t=="number"&&r.length!==2+2*t||t===!0&&r.length%2!==0)}function an(r){return U(r,!0)||r instanceof Uint8Array}const lr="0123456789abcdef";function g(r){const t=y(r);let e="0x";for(let n=0;n<t.length;n++){const s=t[n];e+=lr[(s&240)>>4]+lr[s&15]}return e}function O(r){return"0x"+r.map(t=>g(t).substring(2)).join("")}function ue(r){return U(r,!0)?(r.length-2)/2:y(r).length}function L(r,t,e){const n=y(r);return e!=null&&e>n.length&&p(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:e}),g(n.slice(t??0,e??n.length))}function ws(r,t,e){const n=y(r);p(t>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:t,offset:t+1});const s=new Uint8Array(t);return s.fill(0),e?s.set(n,t-n.length):s.set(n,0),g(s)}function xt(r,t){return ws(r,t,!0)}function oa(r,t){return ws(r,t,!1)}const on=BigInt(0),pt=BigInt(1),fe=9007199254740991;function Qe(r,t){const e=cn(r,"value"),n=BigInt(N(t,"width"));if(p(e>>n===on,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:r}),e>>n-pt){const s=(pt<<n)-pt;return-((~e&s)+pt)}return e}function Es(r,t){let e=b(r,"value");const n=BigInt(N(t,"width")),s=pt<<n-pt;if(e<on){e=-e,p(e<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});const i=(pt<<n)-pt;return(~e&i)+pt}else p(e<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});return e}function Kt(r,t){const e=cn(r,"value"),n=BigInt(N(t,"bits"));return e&(pt<<n)-pt}function b(r,t){switch(typeof r){case"bigint":return r;case"number":return l(Number.isInteger(r),"underflow",t||"value",r),l(r>=-fe&&r<=fe,"overflow",t||"value",r),BigInt(r);case"string":try{if(r==="")throw new Error("empty string");return r[0]==="-"&&r[1]!=="-"?-BigInt(r.substring(1)):BigInt(r)}catch(e){l(!1,`invalid BigNumberish string: ${e.message}`,t||"value",r)}}l(!1,"invalid BigNumberish value",t||"value",r)}function cn(r,t){const e=b(r,t);return p(e>=on,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:r}),e}const ur="0123456789abcdef";function Ce(r){if(r instanceof Uint8Array){let t="0x0";for(const e of r)t+=ur[e>>4],t+=ur[e&15];return BigInt(t)}return b(r)}function N(r,t){switch(typeof r){case"bigint":return l(r>=-fe&&r<=fe,"overflow",t||"value",r),Number(r);case"number":return l(Number.isInteger(r),"underflow",t||"value",r),l(r>=-fe&&r<=fe,"overflow",t||"value",r),r;case"string":try{if(r==="")throw new Error("empty string");return N(BigInt(r),t)}catch(e){l(!1,`invalid numeric string: ${e.message}`,t||"value",r)}}l(!1,"invalid numeric value",t||"value",r)}function ca(r){return N(Ce(r))}function It(r,t){let n=cn(r,"value").toString(16);if(t==null)n.length%2&&(n="0"+n);else{const s=N(t,"width");for(p(s*2>=n.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:r});n.length<s*2;)n="0"+n}return"0x"+n}function M(r){const t=cn(r,"value");if(t===on)return new Uint8Array([]);let e=t.toString(16);e.length%2&&(e="0"+e);const n=new Uint8Array(e.length/2);for(let s=0;s<n.length;s++){const i=s*2;n[s]=parseInt(e.substring(i,i+2),16)}return n}function dt(r){let t=g(an(r)?r:M(r)).substring(2);for(;t.startsWith("0");)t=t.substring(1);return t===""&&(t="0"),"0x"+t}const qe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let Me=null;function fa(r){if(Me==null){Me={};for(let e=0;e<qe.length;e++)Me[qe[e]]=BigInt(e)}const t=Me[r];return l(t!=null,"invalid base58 value","letter",r),t}const la=BigInt(0),_n=BigInt(58);function Ps(r){const t=y(r);let e=Ce(t),n="";for(;e;)n=qe[Number(e%_n)]+n,e/=_n;for(let s=0;s<t.length&&!t[s];s++)n=qe[0]+n;return n}function ua(r){let t=la;for(let e=0;e<r.length;e++)t*=_n,t+=fa(r[e]);return t}function ha(r){r=atob(r);const t=new Uint8Array(r.length);for(let e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return y(t)}function da(r){const t=y(r);let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}class ks{filter;emitter;#t;constructor(t,e,n){this.#t=e,E(this,{emitter:t,filter:n})}async removeListener(){this.#t!=null&&await this.emitter.off(this.filter,this.#t)}}function pa(r,t,e,n,s){l(!1,`invalid codepoint at offset ${t}; ${r}`,"bytes",e)}function Ns(r,t,e,n,s){if(r==="BAD_PREFIX"||r==="UNEXPECTED_CONTINUE"){let i=0;for(let a=t+1;a<e.length&&e[a]>>6===2;a++)i++;return i}return r==="OVERRUN"?e.length-t-1:0}function ga(r,t,e,n,s){return r==="OVERLONG"?(l(typeof s=="number","invalid bad code point for replacement","badCodepoint",s),n.push(s),0):(n.push(65533),Ns(r,t,e))}const ma=Object.freeze({error:pa,ignore:Ns,replace:ga});function ya(r,t){t==null&&(t=ma.error);const e=y(r,"bytes"),n=[];let s=0;for(;s<e.length;){const i=e[s++];if(i>>7===0){n.push(i);continue}let a=null,o=null;if((i&224)===192)a=1,o=127;else if((i&240)===224)a=2,o=2047;else if((i&248)===240)a=3,o=65535;else{(i&192)===128?s+=t("UNEXPECTED_CONTINUE",s-1,e,n):s+=t("BAD_PREFIX",s-1,e,n);continue}if(s-1+a>=e.length){s+=t("OVERRUN",s-1,e,n);continue}let c=i&(1<<8-a-1)-1;for(let f=0;f<a;f++){let u=e[s];if((u&192)!=128){s+=t("MISSING_CONTINUE",s,e,n),c=null;break}c=c<<6|u&63,s++}if(c!==null){if(c>1114111){s+=t("OUT_OF_RANGE",s-1-a,e,n,c);continue}if(c>=55296&&c<=57343){s+=t("UTF16_SURROGATE",s-1-a,e,n,c);continue}if(c<=o){s+=t("OVERLONG",s-1-a,e,n,c);continue}n.push(c)}}return n}function et(r,t){l(typeof r=="string","invalid string value","str",r),t!=null&&(ys(t),r=r.normalize(t));let e=[];for(let n=0;n<r.length;n++){const s=r.charCodeAt(n);if(s<128)e.push(s);else if(s<2048)e.push(s>>6|192),e.push(s&63|128);else if((s&64512)==55296){n++;const i=r.charCodeAt(n);l(n<r.length&&(i&64512)===56320,"invalid surrogate pair","str",r);const a=65536+((s&1023)<<10)+(i&1023);e.push(a>>18|240),e.push(a>>12&63|128),e.push(a>>6&63|128),e.push(a&63|128)}else e.push(s>>12|224),e.push(s>>6&63|128),e.push(s&63|128)}return new Uint8Array(e)}function ba(r){return r.map(t=>t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10&1023)+55296,(t&1023)+56320))).join("")}function tn(r,t){return ba(ya(r,t))}function vs(r){async function t(e,n){p(n==null||!n.cancelled,"request cancelled before sending","CANCELLED");const s=e.url.split(":")[0].toLowerCase();p(s==="http"||s==="https",`unsupported protocol ${s}`,"UNSUPPORTED_OPERATION",{info:{protocol:s},operation:"request"}),p(s==="https"||!e.credentials||e.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let i=null;const a=new AbortController,o=setTimeout(()=>{i=F("request timeout","TIMEOUT"),a.abort()},e.timeout);n&&n.addListener(()=>{i=F("request cancelled","CANCELLED"),a.abort()});const c=Object.assign({},r,{method:e.method,headers:new Headers(Array.from(e)),body:e.body||void 0,signal:a.signal});let f;try{f=await fetch(e.url,c)}catch(m){throw clearTimeout(o),i||m}clearTimeout(o);const u={};f.headers.forEach((m,P)=>{u[P.toLowerCase()]=m});const h=await f.arrayBuffer(),d=h==null?null:new Uint8Array(h);return{statusCode:f.status,statusMessage:f.statusText,headers:u,body:d}}return t}const wa=12,Ea=250;let hr=vs();const Pa=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),ka=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let wn=!1;async function As(r,t){try{const e=r.match(Pa);if(!e)throw new Error("invalid data");return new Ft(200,"OK",{"content-type":e[1]||"text/plain"},e[2]?ha(e[3]):va(e[3]))}catch{return new Ft(599,"BAD REQUEST (invalid data: URI)",{},null,new Rt(r))}}function Ts(r){async function t(e,n){try{const s=e.match(ka);if(!s)throw new Error("invalid link");return new Rt(`${r}${s[2]}`)}catch{return new Ft(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Rt(e))}}return t}const Ge={data:As,ipfs:Ts("https://gateway.ipfs.io/ipfs/")},xs=new WeakMap;class Na{#t;#e;constructor(t){this.#t=[],this.#e=!1,xs.set(t,()=>{if(!this.#e){this.#e=!0;for(const e of this.#t)setTimeout(()=>{e()},0);this.#t=[]}})}addListener(t){p(!this.#e,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#t.push(t)}get cancelled(){return this.#e}checkSignal(){p(!this.cancelled,"cancelled","CANCELLED",{})}}function ze(r){if(r==null)throw new Error("missing signal; should not happen");return r.checkSignal(),r}class Rt{#t;#e;#n;#r;#s;#a;#i;#o;#u;#f;#p;#g;#c;#l;#h;get url(){return this.#a}set url(t){this.#a=String(t)}get body(){return this.#i==null?null:new Uint8Array(this.#i)}set body(t){if(t==null)this.#i=void 0,this.#o=void 0;else if(typeof t=="string")this.#i=et(t),this.#o="text/plain";else if(t instanceof Uint8Array)this.#i=t,this.#o="application/octet-stream";else if(typeof t=="object")this.#i=et(JSON.stringify(t)),this.#o="application/json";else throw new Error("invalid body")}hasBody(){return this.#i!=null}get method(){return this.#r?this.#r:this.hasBody()?"POST":"GET"}set method(t){t==null&&(t=""),this.#r=String(t).toUpperCase()}get headers(){const t=Object.assign({},this.#n);return this.#u&&(t.authorization=`Basic ${da(et(this.#u))}`),this.allowGzip&&(t["accept-encoding"]="gzip"),t["content-type"]==null&&this.#o&&(t["content-type"]=this.#o),this.body&&(t["content-length"]=String(this.body.length)),t}getHeader(t){return this.headers[t.toLowerCase()]}setHeader(t,e){this.#n[String(t).toLowerCase()]=String(e)}clearHeaders(){this.#n={}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let n=0;return{next:()=>{if(n<e.length){const s=e[n++];return{value:[s,t[s]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#u||null}setCredentials(t,e){l(!t.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#u=`${t}:${e}`}get allowGzip(){return this.#e}set allowGzip(t){this.#e=!!t}get allowInsecureAuthentication(){return!!this.#t}set allowInsecureAuthentication(t){this.#t=!!t}get timeout(){return this.#s}set timeout(t){l(t>=0,"timeout must be non-zero","timeout",t),this.#s=t}get preflightFunc(){return this.#f||null}set preflightFunc(t){this.#f=t}get processFunc(){return this.#p||null}set processFunc(t){this.#p=t}get retryFunc(){return this.#g||null}set retryFunc(t){this.#g=t}get getUrlFunc(){return this.#h||hr}set getUrlFunc(t){this.#h=t}constructor(t){this.#a=String(t),this.#t=!1,this.#e=!0,this.#n={},this.#r="",this.#s=3e5,this.#l={slotInterval:Ea,maxAttempts:wa},this.#h=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#i?g(this.#i):"null"}>`}setThrottleParams(t){t.slotInterval!=null&&(this.#l.slotInterval=t.slotInterval),t.maxAttempts!=null&&(this.#l.maxAttempts=t.maxAttempts)}async#d(t,e,n,s,i){if(t>=this.#l.maxAttempts)return i.makeServerError("exceeded maximum retry limit");p(dr()<=e,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:s}),n>0&&await Aa(n);let a=this.clone();const o=(a.url.split(":")[0]||"").toLowerCase();if(o in Ge){const u=await Ge[o](a.url,ze(s.#c));if(u instanceof Ft){let h=u;if(this.processFunc){ze(s.#c);try{h=await this.processFunc(a,h)}catch(d){(d.throttle==null||typeof d.stall!="number")&&h.makeServerError("error in post-processing function",d).assertOk()}}return h}a=u}this.preflightFunc&&(a=await this.preflightFunc(a));const c=await this.getUrlFunc(a,ze(s.#c));let f=new Ft(c.statusCode,c.statusMessage,c.headers,c.body,s);if(f.statusCode===301||f.statusCode===302){try{const u=f.headers.location||"";return a.redirect(u).#d(t+1,e,0,s,f)}catch{}return f}else if(f.statusCode===429&&(this.retryFunc==null||await this.retryFunc(a,f,t))){const u=f.headers["retry-after"];let h=this.#l.slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return typeof u=="string"&&u.match(/^[1-9][0-9]*$/)&&(h=parseInt(u)),a.clone().#d(t+1,e,h,s,f)}if(this.processFunc){ze(s.#c);try{f=await this.processFunc(a,f)}catch(u){(u.throttle==null||typeof u.stall!="number")&&f.makeServerError("error in post-processing function",u).assertOk();let h=this.#l.slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return u.stall>=0&&(h=u.stall),a.clone().#d(t+1,e,h,s,f)}}return f}send(){return p(this.#c==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#c=new Na(this),this.#d(0,dr()+this.timeout,0,this,new Ft(0,"",{},null,this))}cancel(){p(this.#c!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const t=xs.get(this);if(!t)throw new Error("missing signal; should not happen");t()}redirect(t){const e=this.url.split(":")[0].toLowerCase(),n=t.split(":")[0].toLowerCase();p(this.method==="GET"&&(e!=="https"||n!=="http")&&t.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(t)})`});const s=new Rt(t);return s.method="GET",s.allowGzip=this.allowGzip,s.timeout=this.timeout,s.#n=Object.assign({},this.#n),this.#i&&(s.#i=new Uint8Array(this.#i)),s.#o=this.#o,s}clone(){const t=new Rt(this.url);return t.#r=this.#r,this.#i&&(t.#i=this.#i),t.#o=this.#o,t.#n=Object.assign({},this.#n),t.#u=this.#u,this.allowGzip&&(t.allowGzip=!0),t.timeout=this.timeout,this.allowInsecureAuthentication&&(t.allowInsecureAuthentication=!0),t.#f=this.#f,t.#p=this.#p,t.#g=this.#g,t.#l=Object.assign({},this.#l),t.#h=this.#h,t}static lockConfig(){wn=!0}static getGateway(t){return Ge[t.toLowerCase()]||null}static registerGateway(t,e){if(t=t.toLowerCase(),t==="http"||t==="https")throw new Error(`cannot intercept ${t}; use registerGetUrl`);if(wn)throw new Error("gateways locked");Ge[t]=e}static registerGetUrl(t){if(wn)throw new Error("gateways locked");hr=t}static createGetUrlFunc(t){return vs(t)}static createDataGateway(){return As}static createIpfsGatewayFunc(t){return Ts(t)}}class Ft{#t;#e;#n;#r;#s;#a;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#r?g(this.#r):"null"}>`}get statusCode(){return this.#t}get statusMessage(){return this.#e}get headers(){return Object.assign({},this.#n)}get body(){return this.#r==null?null:new Uint8Array(this.#r)}get bodyText(){try{return this.#r==null?"":tn(this.#r)}catch{p(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{p(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let n=0;return{next:()=>{if(n<e.length){const s=e[n++];return{value:[s,t[s]],done:!1}}return{value:void 0,done:!0}}}}constructor(t,e,n,s,i){this.#t=t,this.#e=e,this.#n=Object.keys(n).reduce((a,o)=>(a[o.toLowerCase()]=String(n[o]),a),{}),this.#r=s==null?null:new Uint8Array(s),this.#s=i||null,this.#a={message:""}}makeServerError(t,e){let n;t?n=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${t})`:(t=`${this.statusCode} ${this.statusMessage}`,n=`CLIENT ESCALATED SERVER ERROR (${t})`);const s=new Ft(599,n,this.headers,this.body,this.#s||void 0);return s.#a={message:t,error:e},s}throwThrottleError(t,e){e==null?e=-1:l(Number.isInteger(e)&&e>=0,"invalid stall timeout","stall",e);const n=new Error(t||"throttling requests");throw E(n,{stall:e,throttle:!0}),n}getHeader(t){return this.headers[t.toLowerCase()]}hasBody(){return this.#r!=null}get request(){return this.#s}ok(){return this.#a.message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:t,error:e}=this.#a;t===""&&(t=`server response ${this.statusCode} ${this.statusMessage}`);let n=null;this.request&&(n=this.request.url);let s=null;try{this.#r&&(s=tn(this.#r))}catch{}p(!1,t,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:e,info:{requestUrl:n,responseBody:s,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}}function dr(){return new Date().getTime()}function va(r){return et(r.replace(/%([0-9a-f][0-9a-f])/gi,(t,e)=>String.fromCharCode(parseInt(e,16))))}function Aa(r){return new Promise(t=>setTimeout(t,r))}const Ta=BigInt(-1),ht=BigInt(0),le=BigInt(1),xa=BigInt(5),re={};let he="0000";for(;he.length<80;)he+=he;function Gt(r){let t=he;for(;t.length<r;)t+=t;return BigInt("1"+t.substring(0,r))}function Ne(r,t,e){const n=BigInt(t.width);if(t.signed){const s=le<<n-le;p(e==null||r>=-s&&r<s,"overflow","NUMERIC_FAULT",{operation:e,fault:"overflow",value:r}),r>ht?r=Qe(Kt(r,n),n):r=-Qe(Kt(-r,n),n)}else{const s=le<<n;p(e==null||r>=0&&r<s,"overflow","NUMERIC_FAULT",{operation:e,fault:"overflow",value:r}),r=(r%s+s)%s&s-le}return r}function En(r){typeof r=="number"&&(r=`fixed128x${r}`);let t=!0,e=128,n=18;if(typeof r=="string"){if(r!=="fixed")if(r==="ufixed")t=!1;else{const i=r.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);l(i,"invalid fixed format","format",r),t=i[1]!=="u",e=parseInt(i[2]),n=parseInt(i[3])}}else if(r){const i=r,a=(o,c,f)=>i[o]==null?f:(l(typeof i[o]===c,"invalid fixed format ("+o+" not "+c+")","format."+o,i[o]),i[o]);t=a("signed","boolean",t),e=a("width","number",e),n=a("decimals","number",n)}l(e%8===0,"invalid FixedNumber width (not byte aligned)","format.width",e),l(n<=80,"invalid FixedNumber decimals (too large)","format.decimals",n);const s=(t?"":"u")+"fixed"+String(e)+"x"+String(n);return{signed:t,width:e,decimals:n,name:s}}function Ia(r,t){let e="";r<ht&&(e="-",r*=Ta);let n=r.toString();if(t===0)return e+n;for(;n.length<=t;)n=he+n;const s=n.length-t;for(n=n.substring(0,s)+"."+n.substring(s);n[0]==="0"&&n[1]!==".";)n=n.substring(1);for(;n[n.length-1]==="0"&&n[n.length-2]!==".";)n=n.substring(0,n.length-1);return e+n}class Pt{format;#t;#e;#n;_value;constructor(t,e,n){_t(t,re,"FixedNumber"),this.#e=e,this.#t=n;const s=Ia(e,n.decimals);E(this,{format:n.name,_value:s}),this.#n=Gt(n.decimals)}get signed(){return this.#t.signed}get width(){return this.#t.width}get decimals(){return this.#t.decimals}get value(){return this.#e}#r(t){l(this.format===t.format,"incompatible format; use fixedNumber.toFormat","other",t)}#s(t,e){return t=Ne(t,this.#t,e),new Pt(re,t,this.#t)}#a(t,e){return this.#r(t),this.#s(this.#e+t.#e,e)}addUnsafe(t){return this.#a(t)}add(t){return this.#a(t,"add")}#i(t,e){return this.#r(t),this.#s(this.#e-t.#e,e)}subUnsafe(t){return this.#i(t)}sub(t){return this.#i(t,"sub")}#o(t,e){return this.#r(t),this.#s(this.#e*t.#e/this.#n,e)}mulUnsafe(t){return this.#o(t)}mul(t){return this.#o(t,"mul")}mulSignal(t){this.#r(t);const e=this.#e*t.#e;return p(e%this.#n===ht,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),this.#s(e/this.#n,"mulSignal")}#u(t,e){return p(t.#e!==ht,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#r(t),this.#s(this.#e*this.#n/t.#e,e)}divUnsafe(t){return this.#u(t)}div(t){return this.#u(t,"div")}divSignal(t){p(t.#e!==ht,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),this.#r(t);const e=this.#e*this.#n;return p(e%t.#e===ht,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),this.#s(e/t.#e,"divSignal")}cmp(t){let e=this.value,n=t.value;const s=this.decimals-t.decimals;return s>0?n*=Gt(s):s<0&&(e*=Gt(-s)),e<n?-1:e>n?1:0}eq(t){return this.cmp(t)===0}lt(t){return this.cmp(t)<0}lte(t){return this.cmp(t)<=0}gt(t){return this.cmp(t)>0}gte(t){return this.cmp(t)>=0}floor(){let t=this.#e;return this.#e<ht&&(t-=this.#n-le),t=this.#e/this.#n*this.#n,this.#s(t,"floor")}ceiling(){let t=this.#e;return this.#e>ht&&(t+=this.#n-le),t=this.#e/this.#n*this.#n,this.#s(t,"ceiling")}round(t){if(t==null&&(t=0),t>=this.decimals)return this;const e=this.decimals-t,n=xa*Gt(e-1);let s=this.value+n;const i=Gt(e);return s=s/i*i,Ne(s,this.#t,"round"),new Pt(re,s,this.#t)}isZero(){return this.#e===ht}isNegative(){return this.#e<ht}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return Pt.fromString(this.toString(),t)}static fromValue(t,e,n){const s=e==null?0:N(e),i=En(n);let a=b(t,"value");const o=s-i.decimals;if(o>0){const c=Gt(o);p(a%c===ht,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:t}),a/=c}else o<0&&(a*=Gt(-o));return Ne(a,i,"fromValue"),new Pt(re,a,i)}static fromString(t,e){const n=t.match(/^(-?)([0-9]*)\.?([0-9]*)$/);l(n&&n[2].length+n[3].length>0,"invalid FixedNumber string value","value",t);const s=En(e);let i=n[2]||"0",a=n[3]||"";for(;a.length<s.decimals;)a+=he;p(a.substring(s.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:t}),a=a.substring(0,s.decimals);const o=BigInt(n[1]+i+a);return Ne(o,s,"fromString"),new Pt(re,o,s)}static fromBytes(t,e){let n=Ce(y(t,"value"));const s=En(e);return s.signed&&(n=Qe(n,s.width)),Ne(n,s,"fromBytes"),new Pt(re,n,s)}}function Ra(r){let t=r.toString(16);for(;t.length<2;)t="0"+t;return"0x"+t}function pr(r,t,e){let n=0;for(let s=0;s<e;s++)n=n*256+r[t+s];return n}function gr(r,t,e,n){const s=[];for(;e<t+1+n;){const i=Is(r,e);s.push(i.result),e+=i.consumed,p(e<=t+1+n,"child data too short","BUFFER_OVERRUN",{buffer:r,length:n,offset:t})}return{consumed:1+n,result:s}}function Is(r,t){p(r.length!==0,"data too short","BUFFER_OVERRUN",{buffer:r,length:0,offset:1});const e=n=>{p(n<=r.length,"data short segment too short","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n})};if(r[t]>=248){const n=r[t]-247;e(t+1+n);const s=pr(r,t+1,n);return e(t+1+n+s),gr(r,t,t+1+n,n+s)}else if(r[t]>=192){const n=r[t]-192;return e(t+1+n),gr(r,t,t+1,n)}else if(r[t]>=184){const n=r[t]-183;e(t+1+n);const s=pr(r,t+1,n);e(t+1+n+s);const i=g(r.slice(t+1+n,t+1+n+s));return{consumed:1+n+s,result:i}}else if(r[t]>=128){const n=r[t]-128;e(t+1+n);const s=g(r.slice(t+1,t+1+n));return{consumed:1+n,result:s}}return{consumed:1,result:Ra(r[t])}}function Ue(r){const t=y(r,"data"),e=Is(t,0);return l(e.consumed===t.length,"unexpected junk after rlp payload","data",r),e.result}function mr(r){const t=[];for(;r;)t.unshift(r&255),r>>=8;return t}function Rs(r){if(Array.isArray(r)){let n=[];if(r.forEach(function(i){n=n.concat(Rs(i))}),n.length<=55)return n.unshift(192+n.length),n;const s=mr(n.length);return s.unshift(247+s.length),s.concat(n)}const t=Array.prototype.slice.call(y(r,"object"));if(t.length===1&&t[0]<=127)return t;if(t.length<=55)return t.unshift(128+t.length),t;const e=mr(t.length);return e.unshift(183+e.length),e.concat(t)}const yr="0123456789abcdef";function Ot(r){let t="0x";for(const e of Rs(r))t+=yr[e>>4],t+=yr[e&15];return t}const Oa=["wei","kwei","mwei","gwei","szabo","finney","ether"];function oe(r,t){let e=18;if(typeof t=="string"){const n=Oa.indexOf(t);l(n>=0,"invalid unit","unit",t),e=3*n}else t!=null&&(e=N(t,"unit"));return Pt.fromValue(r,e,{decimals:e,width:512}).toString()}function ot(r,t){l(typeof r=="string","value must be a string","value",r);let e=18;return e=N(t,"unit"),Pt.fromString(r,{decimals:e,width:512}).value}function br(r){return oe(r,18)}function Sa(r){return ot(r,18)}function Ca(r){const t=y(r,"randomBytes");t[6]=t[6]&15|64,t[8]=t[8]&63|128;const e=g(t);return[e.substring(2,10),e.substring(10,14),e.substring(14,18),e.substring(18,22),e.substring(22,34)].join("-")}const q=32,Dn=new Uint8Array(q),Ua=["then"],Ve={},Os=new WeakMap;function Vt(r){return Os.get(r)}function wr(r,t){Os.set(r,t)}function ve(r,t){const e=new Error(`deferred error during ABI decoding triggered accessing ${r}`);throw e.error=t,e}function $n(r,t,e){return r.indexOf(null)>=0?t.map((n,s)=>n instanceof Nt?$n(Vt(n),n,e):n):r.reduce((n,s,i)=>{let a=t.getValue(s);return s in n||(e&&a instanceof Nt&&(a=$n(Vt(a),a,e)),n[s]=a),n},{})}class Nt extends Array{#t;constructor(...t){const e=t[0];let n=t[1],s=(t[2]||[]).slice(),i=!0;e!==Ve&&(n=t,s=[],i=!1),super(n.length),n.forEach((c,f)=>{this[f]=c});const a=s.reduce((c,f)=>(typeof f=="string"&&c.set(f,(c.get(f)||0)+1),c),new Map);if(wr(this,Object.freeze(n.map((c,f)=>{const u=s[f];return u!=null&&a.get(u)===1?u:null}))),this.#t=[],this.#t==null&&this.#t,!i)return;Object.freeze(this);const o=new Proxy(this,{get:(c,f,u)=>{if(typeof f=="string"){if(f.match(/^[0-9]+$/)){const d=N(f,"%index");if(d<0||d>=this.length)throw new RangeError("out of result range");const m=c[d];return m instanceof Error&&ve(`index ${d}`,m),m}if(Ua.indexOf(f)>=0)return Reflect.get(c,f,u);const h=c[f];if(h instanceof Function)return function(...d){return h.apply(this===u?c:this,d)};if(!(f in c))return c.getValue.apply(this===u?c:this,[f])}return Reflect.get(c,f,u)}});return wr(o,Vt(this)),o}toArray(t){const e=[];return this.forEach((n,s)=>{n instanceof Error&&ve(`index ${s}`,n),t&&n instanceof Nt&&(n=n.toArray(t)),e.push(n)}),e}toObject(t){const e=Vt(this);return e.reduce((n,s,i)=>(p(s!=null,`value at index ${i} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),$n(e,this,t)),{})}slice(t,e){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),e==null&&(e=this.length),e<0&&(e+=this.length,e<0&&(e=0)),e>this.length&&(e=this.length);const n=Vt(this),s=[],i=[];for(let a=t;a<e;a++)s.push(this[a]),i.push(n[a]);return new Nt(Ve,s,i)}filter(t,e){const n=Vt(this),s=[],i=[];for(let a=0;a<this.length;a++){const o=this[a];o instanceof Error&&ve(`index ${a}`,o),t.call(e,o,a,this)&&(s.push(o),i.push(n[a]))}return new Nt(Ve,s,i)}map(t,e){const n=[];for(let s=0;s<this.length;s++){const i=this[s];i instanceof Error&&ve(`index ${s}`,i),n.push(t.call(e,i,s,this))}return n}getValue(t){const e=Vt(this).indexOf(t);if(e===-1)return;const n=this[e];return n instanceof Error&&ve(`property ${JSON.stringify(t)}`,n.error),n}static fromItems(t,e){return new Nt(Ve,t,e)}}function Er(r){let t=M(r);return p(t.length<=q,"value out-of-bounds","BUFFER_OVERRUN",{buffer:t,length:q,offset:t.length}),t.length!==q&&(t=Z(O([Dn.slice(t.length%q),t]))),t}class Ut{name;type;localName;dynamic;constructor(t,e,n,s){E(this,{name:t,type:e,localName:n,dynamic:s},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(t,e){l(!1,t,this.localName,e)}}class Mn{#t;#e;constructor(){this.#t=[],this.#e=0}get data(){return O(this.#t)}get length(){return this.#e}#n(t){return this.#t.push(t),this.#e+=t.length,t.length}appendWriter(t){return this.#n(Z(t.data))}writeBytes(t){let e=Z(t);const n=e.length%q;return n&&(e=Z(O([e,Dn.slice(n)]))),this.#n(e)}writeValue(t){return this.#n(Er(t))}writeUpdatableValue(){const t=this.#t.length;return this.#t.push(Dn),this.#e+=q,e=>{this.#t[t]=Er(e)}}}class qn{allowLoose;#t;#e;#n;#r;#s;constructor(t,e,n){E(this,{allowLoose:!!e}),this.#t=Z(t),this.#n=0,this.#r=null,this.#s=n??1024,this.#e=0}get data(){return g(this.#t)}get dataLength(){return this.#t.length}get consumed(){return this.#e}get bytes(){return new Uint8Array(this.#t)}#a(t){if(this.#r)return this.#r.#a(t);this.#n+=t,p(this.#s<1||this.#n<=this.#s*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#s} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:Z(this.#t),offset:this.#e,length:t,info:{bytesRead:this.#n,dataLength:this.dataLength}})}#i(t,e,n){let s=Math.ceil(e/q)*q;return this.#e+s>this.#t.length&&(this.allowLoose&&n&&this.#e+e<=this.#t.length?s=e:p(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Z(this.#t),length:this.#t.length,offset:this.#e+s})),this.#t.slice(this.#e,this.#e+s)}subReader(t){const e=new qn(this.#t.slice(this.#e+t),this.allowLoose,this.#s);return e.#r=this,e}readBytes(t,e){let n=this.#i(0,t,!!e);return this.#a(t),this.#e+=n.length,n.slice(0,t)}readValue(){return Ce(this.readBytes(q))}readIndex(){return ca(this.readBytes(q))}}function La(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const Pr=La(),kr=Pr.crypto||Pr.msCrypto;function Fa(r){switch(r){case"sha256":return Yn.create();case"sha512":return Zn.create()}l(!1,"invalid hashing algorithm name","algorithm",r)}function Ba(r,t){const e={sha256:Yn,sha512:Zn}[r];return l(e!=null,"invalid hmac algorithm","algorithm",r),Yi.create(e,t)}function _a(r,t,e,n,s){const i={sha256:Yn,sha512:Zn}[s];return l(i!=null,"invalid pbkdf2 algorithm","algorithm",s),Zi(i,r,t,{c:e,dkLen:n})}function Da(r){p(kr!=null,"platform does not support secure random numbers","UNSUPPORTED_OPERATION",{operation:"randomBytes"}),l(Number.isInteger(r)&&r>0&&r<=1024,"invalid length","length",r);const t=new Uint8Array(r);return kr.getRandomValues(t),t}let Ss=!1;const Cs=function(r,t,e){return Ba(r,t).update(e).digest()};let Us=Cs;function be(r,t,e){const n=y(t,"key"),s=y(e,"data");return g(Us(r,n,s))}be._=Cs;be.lock=function(){Ss=!0};be.register=function(r){if(Ss)throw new Error("computeHmac is locked");Us=r};Object.freeze(be);let Ls=!1;const Fs=function(r){return Qi(r)};let Bs=Fs;function B(r){const t=y(r,"data");return g(Bs(t))}B._=Fs;B.lock=function(){Ls=!0};B.register=function(r){if(Ls)throw new TypeError("keccak256 is locked");Bs=r};Object.freeze(B);let _s=!1;const Ds=function(r){return qi(r)};let $s=Ds;function we(r){const t=y(r,"data");return g($s(t))}we._=Ds;we.lock=function(){_s=!0};we.register=function(r){if(_s)throw new TypeError("ripemd160 is locked");$s=r};Object.freeze(we);let Ms=!1;const Gs=function(r,t,e,n,s){return _a(r,t,e,n,s)};let zs=Gs;function Dt(r,t,e,n,s){const i=y(r,"password"),a=y(t,"salt");return g(zs(i,a,e,n,s))}Dt._=Gs;Dt.lock=function(){Ms=!0};Dt.register=function(r){if(Ms)throw new Error("pbkdf2 is locked");zs=r};Object.freeze(Dt);let Vs=!1;const Hs=function(r){return new Uint8Array(Da(r))};let Ks=Hs;function At(r){return Ks(r)}At._=Hs;At.lock=function(){Vs=!0};At.register=function(r){if(Vs)throw new Error("randomBytes is locked");Ks=r};Object.freeze(At);let Xs=!1,Js=!1;const Ws=async function(r,t,e,n,s,i,a){return await ta(r,t,{N:e,r:n,p:s,dkLen:i,onProgress:a})},js=function(r,t,e,n,s,i){return ea(r,t,{N:e,r:n,p:s,dkLen:i})};let Zs=Ws,Ys=js;async function Ee(r,t,e,n,s,i,a){const o=y(r,"passwd"),c=y(t,"salt");return g(await Zs(o,c,e,n,s,i,a))}Ee._=Ws;Ee.lock=function(){Js=!0};Ee.register=function(r){if(Js)throw new Error("scrypt is locked");Zs=r};Object.freeze(Ee);function Pe(r,t,e,n,s,i){const a=y(r,"passwd"),o=y(t,"salt");return g(Ys(a,o,e,n,s,i))}Pe._=js;Pe.lock=function(){Xs=!0};Pe.register=function(r){if(Xs)throw new Error("scryptSync is locked");Ys=r};Object.freeze(Pe);const Qs=function(r){return Fa("sha256").update(r).digest()};let qs=Qs,ti=!1;function lt(r){const t=y(r,"data");return g(qs(t))}lt._=Qs;lt.lock=function(){ti=!0};lt.register=function(r){if(ti)throw new Error("sha256 is locked");qs=r};Object.freeze(lt);Object.freeze(lt);const xe="0x0000000000000000000000000000000000000000",Nr="0x0000000000000000000000000000000000000000000000000000000000000000",$a=`Ethereum Signed Message:
`,vr=BigInt(0),Ar=BigInt(1),Tr=BigInt(2),xr=BigInt(27),Ir=BigInt(28),He=BigInt(35),se={};function Rr(r){return xt(M(r),32)}class D{#t;#e;#n;#r;get r(){return this.#t}set r(t){l(ue(t)===32,"invalid r","value",t),this.#t=g(t)}get s(){return l(parseInt(this.#e.substring(0,3))<8,"non-canonical s; use ._s","s",this.#e),this.#e}set s(t){l(ue(t)===32,"invalid s","value",t),this.#e=g(t)}get _s(){return this.#e}isValid(){return parseInt(this.#e.substring(0,3))<8}get v(){return this.#n}set v(t){const e=N(t,"value");l(e===27||e===28,"invalid v","v",t),this.#n=e}get networkV(){return this.#r}get legacyChainId(){const t=this.networkV;return t==null?null:D.getChainId(t)}get yParity(){return this.v===27?0:1}get yParityAndS(){const t=y(this.s);return this.yParity&&(t[0]|=128),g(t)}get compactSerialized(){return O([this.r,this.yParityAndS])}get serialized(){return O([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(t,e,n,s){_t(t,se,"Signature"),this.#t=e,this.#e=n,this.#n=s,this.#r=null}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const t=new D(se,this.r,this._s,this.v);return this.networkV&&(t.#r=this.networkV),t}toJSON(){const t=this.networkV;return{_type:"signature",networkV:t!=null?t.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(t){const e=b(t,"v");return e==xr||e==Ir?vr:(l(e>=He,"invalid EIP-155 v","v",t),(e-He)/Tr)}static getChainIdV(t,e){return b(t)*Tr+BigInt(35+e-27)}static getNormalizedV(t){const e=b(t);return e===vr||e===xr?27:e===Ar||e===Ir?28:(l(e>=He,"invalid v","v",t),e&Ar?27:28)}static from(t){function e(f,u){l(f,u,"signature",t)}if(t==null)return new D(se,Nr,Nr,27);if(typeof t=="string"){const f=y(t,"signature");if(f.length===64){const u=g(f.slice(0,32)),h=f.slice(32,64),d=h[0]&128?28:27;return h[0]&=127,new D(se,u,g(h),d)}if(f.length===65){const u=g(f.slice(0,32)),h=g(f.slice(32,64)),d=D.getNormalizedV(f[64]);return new D(se,u,h,d)}e(!1,"invalid raw signature length")}if(t instanceof D)return t.clone();const n=t.r;e(n!=null,"missing r");const s=Rr(n),i=function(f,u){if(f!=null)return Rr(f);if(u!=null){e(U(u,32),"invalid yParityAndS");const h=y(u);return h[0]&=127,g(h)}e(!1,"missing s")}(t.s,t.yParityAndS),{networkV:a,v:o}=function(f,u,h){if(f!=null){const d=b(f);return{networkV:d>=He?d:void 0,v:D.getNormalizedV(d)}}if(u!=null)return e(U(u,32),"invalid yParityAndS"),{v:y(u)[0]&128?28:27};if(h!=null){switch(N(h,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}e(!1,"invalid yParity")}e(!1,"missing v")}(t.v,t.yParityAndS,t.yParity),c=new D(se,s,i,o);return a&&(c.#r=a),e(t.yParity==null||N(t.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),e(t.yParityAndS==null||t.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}}class rt{#t;constructor(t){l(ue(t)===32,"invalid private key","privateKey","[REDACTED]"),this.#t=g(t)}get privateKey(){return this.#t}get publicKey(){return rt.computePublicKey(this.#t)}get compressedPublicKey(){return rt.computePublicKey(this.#t,!0)}sign(t){l(ue(t)===32,"invalid digest length","digest",t);const e=Mt.sign(Z(t),Z(this.#t),{lowS:!0});return D.from({r:It(e.r,32),s:It(e.s,32),v:e.recovery?28:27})}computeSharedSecret(t){const e=rt.computePublicKey(t);return g(Mt.getSharedSecret(Z(this.#t),y(e),!1))}static computePublicKey(t,e){let n=y(t,"key");if(n.length===32){const i=Mt.getPublicKey(n,!!e);return g(i)}if(n.length===64){const i=new Uint8Array(65);i[0]=4,i.set(n,1),n=i}const s=Mt.ProjectivePoint.fromHex(n);return g(s.toRawBytes(e))}static recoverPublicKey(t,e){l(ue(t)===32,"invalid digest length","digest",t);const n=D.from(e);let s=Mt.Signature.fromCompact(Z(O([n.r,n.s])));s=s.addRecoveryBit(n.yParity);const i=s.recoverPublicKey(Z(t));return l(i!=null,"invalid signature for digest","signature",e),"0x"+i.toHex(!1)}static addPoints(t,e,n){const s=Mt.ProjectivePoint.fromHex(rt.computePublicKey(t).substring(2)),i=Mt.ProjectivePoint.fromHex(rt.computePublicKey(e).substring(2));return"0x"+s.add(i).toHex(!!n)}}const Ma=BigInt(0),Ga=BigInt(36);function Or(r){r=r.toLowerCase();const t=r.substring(2).split(""),e=new Uint8Array(40);for(let s=0;s<40;s++)e[s]=t[s].charCodeAt(0);const n=y(B(e));for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&(t[s]=t[s].toUpperCase()),(n[s>>1]&15)>=8&&(t[s+1]=t[s+1].toUpperCase());return"0x"+t.join("")}const tr={};for(let r=0;r<10;r++)tr[String(r)]=String(r);for(let r=0;r<26;r++)tr[String.fromCharCode(65+r)]=String(10+r);const Sr=15;function za(r){r=r.toUpperCase(),r=r.substring(4)+r.substring(0,2)+"00";let t=r.split("").map(n=>tr[n]).join("");for(;t.length>=Sr;){let n=t.substring(0,Sr);t=parseInt(n,10)%97+t.substring(n.length)}let e=String(98-parseInt(t,10)%97);for(;e.length<2;)e="0"+e;return e}const Va=function(){const r={};for(let t=0;t<36;t++){const e="0123456789abcdefghijklmnopqrstuvwxyz"[t];r[e]=BigInt(t)}return r}();function Ha(r){r=r.toLowerCase();let t=Ma;for(let e=0;e<r.length;e++)t=t*Ga+Va[r[e]];return t}function x(r){if(l(typeof r=="string","invalid address","address",r),r.match(/^(0x)?[0-9a-fA-F]{40}$/)){r.startsWith("0x")||(r="0x"+r);const t=Or(r);return l(!r.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||t===r,"bad address checksum","address",r),t}if(r.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){l(r.substring(2,4)===za(r),"bad icap checksum","address",r);let t=Ha(r.substring(4)).toString(16);for(;t.length<40;)t="0"+t;return Or("0x"+t)}l(!1,"invalid address","address",r)}function ei(r){const t=x(r.from);let n=b(r.nonce,"tx.nonce").toString(16);return n==="0"?n="0x":n.length%2?n="0x0"+n:n="0x"+n,x(L(B(Ot([t,n])),12))}function ni(r){return r&&typeof r.getAddress=="function"}async function Pn(r,t){const e=await t;return(e==null||e==="0x0000000000000000000000000000000000000000")&&(p(typeof r!="string","unconfigured name","UNCONFIGURED_NAME",{value:r}),l(!1,"invalid AddressLike value; did not resolve to a value address","target",r)),x(e)}function H(r,t){if(typeof r=="string")return r.match(/^0x[0-9a-f]{40}$/i)?x(r):(p(t!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),Pn(r,t.resolveName(r)));if(ni(r))return Pn(r,r.getAddress());if(r&&typeof r.then=="function")return Pn(r,r);l(!1,"unsupported addressable value","target",r)}const Et={};function w(r,t){let e=!1;return t<0&&(e=!0,t*=-1),new $(Et,`${e?"":"u"}int${t}`,r,{signed:e,width:t})}function I(r,t){return new $(Et,`bytes${t||""}`,r,{size:t})}const Cr=Symbol.for("_ethers_typed");class ${type;value;#t;_typedSymbol;constructor(t,e,n,s){s==null&&(s=null),_t(Et,t,"Typed"),E(this,{_typedSymbol:Cr,type:e,value:n}),this.#t=s,this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(t=>t.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return this.#t}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return this.#t===!0?-1:this.#t===!1?this.value.length:null}static from(t,e){return new $(Et,t,e)}static uint8(t){return w(t,8)}static uint16(t){return w(t,16)}static uint24(t){return w(t,24)}static uint32(t){return w(t,32)}static uint40(t){return w(t,40)}static uint48(t){return w(t,48)}static uint56(t){return w(t,56)}static uint64(t){return w(t,64)}static uint72(t){return w(t,72)}static uint80(t){return w(t,80)}static uint88(t){return w(t,88)}static uint96(t){return w(t,96)}static uint104(t){return w(t,104)}static uint112(t){return w(t,112)}static uint120(t){return w(t,120)}static uint128(t){return w(t,128)}static uint136(t){return w(t,136)}static uint144(t){return w(t,144)}static uint152(t){return w(t,152)}static uint160(t){return w(t,160)}static uint168(t){return w(t,168)}static uint176(t){return w(t,176)}static uint184(t){return w(t,184)}static uint192(t){return w(t,192)}static uint200(t){return w(t,200)}static uint208(t){return w(t,208)}static uint216(t){return w(t,216)}static uint224(t){return w(t,224)}static uint232(t){return w(t,232)}static uint240(t){return w(t,240)}static uint248(t){return w(t,248)}static uint256(t){return w(t,256)}static uint(t){return w(t,256)}static int8(t){return w(t,-8)}static int16(t){return w(t,-16)}static int24(t){return w(t,-24)}static int32(t){return w(t,-32)}static int40(t){return w(t,-40)}static int48(t){return w(t,-48)}static int56(t){return w(t,-56)}static int64(t){return w(t,-64)}static int72(t){return w(t,-72)}static int80(t){return w(t,-80)}static int88(t){return w(t,-88)}static int96(t){return w(t,-96)}static int104(t){return w(t,-104)}static int112(t){return w(t,-112)}static int120(t){return w(t,-120)}static int128(t){return w(t,-128)}static int136(t){return w(t,-136)}static int144(t){return w(t,-144)}static int152(t){return w(t,-152)}static int160(t){return w(t,-160)}static int168(t){return w(t,-168)}static int176(t){return w(t,-176)}static int184(t){return w(t,-184)}static int192(t){return w(t,-192)}static int200(t){return w(t,-200)}static int208(t){return w(t,-208)}static int216(t){return w(t,-216)}static int224(t){return w(t,-224)}static int232(t){return w(t,-232)}static int240(t){return w(t,-240)}static int248(t){return w(t,-248)}static int256(t){return w(t,-256)}static int(t){return w(t,-256)}static bytes1(t){return I(t,1)}static bytes2(t){return I(t,2)}static bytes3(t){return I(t,3)}static bytes4(t){return I(t,4)}static bytes5(t){return I(t,5)}static bytes6(t){return I(t,6)}static bytes7(t){return I(t,7)}static bytes8(t){return I(t,8)}static bytes9(t){return I(t,9)}static bytes10(t){return I(t,10)}static bytes11(t){return I(t,11)}static bytes12(t){return I(t,12)}static bytes13(t){return I(t,13)}static bytes14(t){return I(t,14)}static bytes15(t){return I(t,15)}static bytes16(t){return I(t,16)}static bytes17(t){return I(t,17)}static bytes18(t){return I(t,18)}static bytes19(t){return I(t,19)}static bytes20(t){return I(t,20)}static bytes21(t){return I(t,21)}static bytes22(t){return I(t,22)}static bytes23(t){return I(t,23)}static bytes24(t){return I(t,24)}static bytes25(t){return I(t,25)}static bytes26(t){return I(t,26)}static bytes27(t){return I(t,27)}static bytes28(t){return I(t,28)}static bytes29(t){return I(t,29)}static bytes30(t){return I(t,30)}static bytes31(t){return I(t,31)}static bytes32(t){return I(t,32)}static address(t){return new $(Et,"address",t)}static bool(t){return new $(Et,"bool",!!t)}static bytes(t){return new $(Et,"bytes",t)}static string(t){return new $(Et,"string",t)}static array(t,e){throw new Error("not implemented yet")}static tuple(t,e){throw new Error("not implemented yet")}static overrides(t){return new $(Et,"overrides",Object.assign({},t))}static isTyped(t){return t&&typeof t=="object"&&"_typedSymbol"in t&&t._typedSymbol===Cr}static dereference(t,e){if($.isTyped(t)){if(t.type!==e)throw new Error(`invalid type: expecetd ${e}, got ${t.type}`);return t.value}return t}}class Ka extends Ut{constructor(t){super("address","address",t,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(t,e){let n=$.dereference(e,"string");try{n=x(n)}catch(s){return this._throwError(s.message,e)}return t.writeValue(n)}decode(t){return x(It(t.readValue(),20))}}class Xa extends Ut{coder;constructor(t){super(t.name,t.type,"_",t.dynamic),this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,e){return this.coder.encode(t,e)}decode(t){return this.coder.decode(t)}}function ri(r,t,e){let n=[];if(Array.isArray(e))n=e;else if(e&&typeof e=="object"){let c={};n=t.map(f=>{const u=f.localName;return p(u,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:f},value:e}),p(!c[u],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:f},value:e}),c[u]=!0,e[u]})}else l(!1,"invalid tuple value","tuple",e);l(t.length===n.length,"types/value length mismatch","tuple",e);let s=new Mn,i=new Mn,a=[];t.forEach((c,f)=>{let u=n[f];if(c.dynamic){let h=i.length;c.encode(i,u);let d=s.writeUpdatableValue();a.push(m=>{d(m+h)})}else c.encode(s,u)}),a.forEach(c=>{c(s.length)});let o=r.appendWriter(s);return o+=r.appendWriter(i),o}function si(r,t){let e=[],n=[],s=r.subReader(0);return t.forEach(i=>{let a=null;if(i.dynamic){let o=r.readIndex(),c=s.subReader(o);try{a=i.decode(c)}catch(f){if(j(f,"BUFFER_OVERRUN"))throw f;a=f,a.baseType=i.name,a.name=i.localName,a.type=i.type}}else try{a=i.decode(r)}catch(o){if(j(o,"BUFFER_OVERRUN"))throw o;a=o,a.baseType=i.name,a.name=i.localName,a.type=i.type}if(a==null)throw new Error("investigate");e.push(a),n.push(i.localName||null)}),Nt.fromItems(e,n)}class Ja extends Ut{coder;length;constructor(t,e,n){const s=t.type+"["+(e>=0?e:"")+"]",i=e===-1||t.dynamic;super("array",s,n,i),E(this,{coder:t,length:e})}defaultValue(){const t=this.coder.defaultValue(),e=[];for(let n=0;n<this.length;n++)e.push(t);return e}encode(t,e){const n=$.dereference(e,"array");Array.isArray(n)||this._throwError("expected array value",n);let s=this.length;s===-1&&(s=n.length,t.writeValue(n.length)),ms(n.length,s,"coder array"+(this.localName?" "+this.localName:""));let i=[];for(let a=0;a<n.length;a++)i.push(this.coder);return ri(t,i,n)}decode(t){let e=this.length;e===-1&&(e=t.readIndex(),p(e*q<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:e*q,length:t.dataLength}));let n=[];for(let s=0;s<e;s++)n.push(new Xa(this.coder));return si(t,n)}}class Wa extends Ut{constructor(t){super("bool","bool",t,!1)}defaultValue(){return!1}encode(t,e){const n=$.dereference(e,"bool");return t.writeValue(n?1:0)}decode(t){return!!t.readValue()}}class ii extends Ut{constructor(t,e){super(t,t,e,!0)}defaultValue(){return"0x"}encode(t,e){e=Z(e);let n=t.writeValue(e.length);return n+=t.writeBytes(e),n}decode(t){return t.readBytes(t.readIndex(),!0)}}class ja extends ii{constructor(t){super("bytes",t)}decode(t){return g(super.decode(t))}}class Za extends Ut{size;constructor(t,e){let n="bytes"+String(t);super(n,n,e,!1),E(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,e){let n=Z($.dereference(e,this.type));return n.length!==this.size&&this._throwError("incorrect data length",e),t.writeBytes(n)}decode(t){return g(t.readBytes(this.size))}}const Ya=new Uint8Array([]);class Qa extends Ut{constructor(t){super("null","",t,!1)}defaultValue(){return null}encode(t,e){return e!=null&&this._throwError("not null",e),t.writeBytes(Ya)}decode(t){return t.readBytes(0),null}}const qa=BigInt(0),to=BigInt(1),eo=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class no extends Ut{size;signed;constructor(t,e,n){const s=(e?"int":"uint")+t*8;super(s,s,n,!1),E(this,{size:t,signed:e},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,e){let n=b($.dereference(e,this.type)),s=Kt(eo,q*8);if(this.signed){let i=Kt(s,this.size*8-1);(n>i||n<-(i+to))&&this._throwError("value out-of-bounds",e),n=Es(n,8*q)}else(n<qa||n>Kt(s,this.size*8))&&this._throwError("value out-of-bounds",e);return t.writeValue(n)}decode(t){let e=Kt(t.readValue(),this.size*8);return this.signed&&(e=Qe(e,this.size*8)),e}}class ro extends ii{constructor(t){super("string",t)}defaultValue(){return""}encode(t,e){return super.encode(t,et($.dereference(e,"string")))}decode(t){return tn(super.decode(t))}}class Ke extends Ut{coders;constructor(t,e){let n=!1;const s=[];t.forEach(a=>{a.dynamic&&(n=!0),s.push(a.type)});const i="tuple("+s.join(",")+")";super("tuple",i,e,n),E(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(n=>{t.push(n.defaultValue())});const e=this.coders.reduce((n,s)=>{const i=s.localName;return i&&(n[i]||(n[i]=0),n[i]++),n},{});return this.coders.forEach((n,s)=>{let i=n.localName;!i||e[i]!==1||(i==="length"&&(i="_length"),t[i]==null&&(t[i]=t[s]))}),Object.freeze(t)}encode(t,e){const n=$.dereference(e,"tuple");return ri(t,this.coders,n)}decode(t){return si(t,this.coders)}}function kn(r,t){return{address:x(r),storageKeys:t.map((e,n)=>(l(U(e,32),"invalid slot",`storageKeys[${n}]`,e),e.toLowerCase()))}}function te(r){if(Array.isArray(r))return r.map((e,n)=>Array.isArray(e)?(l(e.length===2,"invalid slot set",`value[${n}]`,e),kn(e[0],e[1])):(l(e!=null&&typeof e=="object","invalid address-slot set","value",r),kn(e.address,e.storageKeys)));l(r!=null&&typeof r=="object","invalid access list","value",r);const t=Object.keys(r).map(e=>{const n=r[e].reduce((s,i)=>(s[i]=!0,s),{});return kn(e,Object.keys(n).sort())});return t.sort((e,n)=>e.address.localeCompare(n.address)),t}function ai(r){return{address:x(r.address),nonce:b(r.nonce!=null?r.nonce:0),chainId:b(r.chainId!=null?r.chainId:0),signature:D.from(r.signature)}}function Le(r){let t;return typeof r=="string"?t=rt.computePublicKey(r,!1):t=r.publicKey,x(B("0x"+t.substring(4)).substring(26))}function so(r,t){return Le(rt.recoverPublicKey(r,t))}const V=BigInt(0),io=BigInt(2),ao=BigInt(27),oo=BigInt(28),co=BigInt(35),fo=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Nn=4096*32;function lo(r){return{blobToKzgCommitment:n=>{if("computeBlobProof"in r){if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return y(r.blobToKzgCommitment(g(n)))}else if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return y(r.blobToKzgCommitment(n));if("blobToKZGCommitment"in r&&typeof r.blobToKZGCommitment=="function")return y(r.blobToKZGCommitment(g(n)));l(!1,"unsupported KZG library","kzg",r)},computeBlobKzgProof:(n,s)=>{if("computeBlobProof"in r&&typeof r.computeBlobProof=="function")return y(r.computeBlobProof(g(n),g(s)));if("computeBlobKzgProof"in r&&typeof r.computeBlobKzgProof=="function")return r.computeBlobKzgProof(n,s);if("computeBlobKZGProof"in r&&typeof r.computeBlobKZGProof=="function")return y(r.computeBlobKZGProof(g(n),g(s)));l(!1,"unsupported KZG library","kzg",r)}}}function Ur(r,t){let e=r.toString(16);for(;e.length<2;)e="0"+e;return e+=lt(t).substring(4),"0x"+e}function ke(r){return r==="0x"?null:x(r)}function fn(r,t){try{return te(r)}catch(e){l(!1,e.message,t,r)}}function uo(r,t){try{if(!Array.isArray(r))throw new Error("authorizationList: invalid array");const e=[];for(let n=0;n<r.length;n++){const s=r[n];if(!Array.isArray(s))throw new Error(`authorization[${n}]: invalid array`);if(s.length!==6)throw new Error(`authorization[${n}]: wrong length`);if(!s[1])throw new Error(`authorization[${n}]: null address`);e.push({address:ke(s[1]),nonce:S(s[2],"nonce"),chainId:S(s[0],"chainId"),signature:D.from({yParity:ee(s[3],"yParity"),r:xt(s[4],32),s:xt(s[5],32)})})}return e}catch(e){l(!1,e.message,t,r)}}function ee(r,t){return r==="0x"?0:N(r,t)}function S(r,t){if(r==="0x")return V;const e=b(r,t);return l(e<=fo,"value exceeds uint size",t,e),e}function T(r,t){const e=b(r,"value"),n=M(e);return l(n.length<=32,"value too large",`tx.${t}`,e),n}function ln(r){return te(r).map(t=>[t.address,t.storageKeys])}function ho(r){return r.map(t=>[T(t.chainId,"chainId"),t.address,T(t.nonce,"nonce"),T(t.signature.yParity,"yParity"),M(t.signature.r),M(t.signature.s)])}function po(r,t){l(Array.isArray(r),`invalid ${t}`,"value",r);for(let e=0;e<r.length;e++)l(U(r[e],32),"invalid ${ param } hash",`value[${e}]`,r[e]);return r}function go(r){const t=Ue(r);l(Array.isArray(t)&&(t.length===9||t.length===6),"invalid field count for legacy transaction","data",r);const e={type:0,nonce:ee(t[0],"nonce"),gasPrice:S(t[1],"gasPrice"),gasLimit:S(t[2],"gasLimit"),to:ke(t[3]),value:S(t[4],"value"),data:g(t[5]),chainId:V};if(t.length===6)return e;const n=S(t[6],"v"),s=S(t[7],"r"),i=S(t[8],"s");if(s===V&&i===V)e.chainId=n;else{let a=(n-co)/io;a<V&&(a=V),e.chainId=a,l(a!==V||n===ao||n===oo,"non-canonical legacy v","v",t[6]),e.signature=D.from({r:xt(t[7],32),s:xt(t[8],32),v:n})}return e}function mo(r,t){const e=[T(r.nonce,"nonce"),T(r.gasPrice||0,"gasPrice"),T(r.gasLimit,"gasLimit"),r.to||"0x",T(r.value,"value"),r.data];let n=V;if(r.chainId!=V)n=b(r.chainId,"tx.chainId"),l(!t||t.networkV==null||t.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",t);else if(r.signature){const i=r.signature.legacyChainId;i!=null&&(n=i)}if(!t)return n!==V&&(e.push(M(n)),e.push("0x"),e.push("0x")),Ot(e);let s=BigInt(27+t.yParity);return n!==V?s=D.getChainIdV(n,t.v):BigInt(t.v)!==s&&l(!1,"tx.chainId/sig.v mismatch","sig",t),e.push(M(s)),e.push(M(t.r)),e.push(M(t.s)),Ot(e)}function un(r,t){let e;try{if(e=ee(t[0],"yParity"),e!==0&&e!==1)throw new Error("bad yParity")}catch{l(!1,"invalid yParity","yParity",t[0])}const n=xt(t[1],32),s=xt(t[2],32),i=D.from({r:n,s,yParity:e});r.signature=i}function yo(r){const t=Ue(y(r).slice(1));l(Array.isArray(t)&&(t.length===9||t.length===12),"invalid field count for transaction type: 2","data",g(r));const e={type:2,chainId:S(t[0],"chainId"),nonce:ee(t[1],"nonce"),maxPriorityFeePerGas:S(t[2],"maxPriorityFeePerGas"),maxFeePerGas:S(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:S(t[4],"gasLimit"),to:ke(t[5]),value:S(t[6],"value"),data:g(t[7]),accessList:fn(t[8],"accessList")};return t.length===9||un(e,t.slice(9)),e}function bo(r,t){const e=[T(r.chainId,"chainId"),T(r.nonce,"nonce"),T(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),T(r.maxFeePerGas||0,"maxFeePerGas"),T(r.gasLimit,"gasLimit"),r.to||"0x",T(r.value,"value"),r.data,ln(r.accessList||[])];return t&&(e.push(T(t.yParity,"yParity")),e.push(M(t.r)),e.push(M(t.s))),O(["0x02",Ot(e)])}function wo(r){const t=Ue(y(r).slice(1));l(Array.isArray(t)&&(t.length===8||t.length===11),"invalid field count for transaction type: 1","data",g(r));const e={type:1,chainId:S(t[0],"chainId"),nonce:ee(t[1],"nonce"),gasPrice:S(t[2],"gasPrice"),gasLimit:S(t[3],"gasLimit"),to:ke(t[4]),value:S(t[5],"value"),data:g(t[6]),accessList:fn(t[7],"accessList")};return t.length===8||un(e,t.slice(8)),e}function Eo(r,t){const e=[T(r.chainId,"chainId"),T(r.nonce,"nonce"),T(r.gasPrice||0,"gasPrice"),T(r.gasLimit,"gasLimit"),r.to||"0x",T(r.value,"value"),r.data,ln(r.accessList||[])];return t&&(e.push(T(t.yParity,"recoveryParam")),e.push(M(t.r)),e.push(M(t.s))),O(["0x01",Ot(e)])}function Po(r){let t=Ue(y(r).slice(1)),e="3",n=null;if(t.length===4&&Array.isArray(t[0])){e="3 (network format)";const i=t[1],a=t[2],o=t[3];l(Array.isArray(i),"invalid network format: blobs not an array","fields[1]",i),l(Array.isArray(a),"invalid network format: commitments not an array","fields[2]",a),l(Array.isArray(o),"invalid network format: proofs not an array","fields[3]",o),l(i.length===a.length,"invalid network format: blobs/commitments length mismatch","fields",t),l(i.length===o.length,"invalid network format: blobs/proofs length mismatch","fields",t),n=[];for(let c=0;c<t[1].length;c++)n.push({data:i[c],commitment:a[c],proof:o[c]});t=t[0]}l(Array.isArray(t)&&(t.length===11||t.length===14),`invalid field count for transaction type: ${e}`,"data",g(r));const s={type:3,chainId:S(t[0],"chainId"),nonce:ee(t[1],"nonce"),maxPriorityFeePerGas:S(t[2],"maxPriorityFeePerGas"),maxFeePerGas:S(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:S(t[4],"gasLimit"),to:ke(t[5]),value:S(t[6],"value"),data:g(t[7]),accessList:fn(t[8],"accessList"),maxFeePerBlobGas:S(t[9],"maxFeePerBlobGas"),blobVersionedHashes:t[10]};n&&(s.blobs=n),l(s.to!=null,`invalid address for transaction type: ${e}`,"data",r),l(Array.isArray(s.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",r);for(let i=0;i<s.blobVersionedHashes.length;i++)l(U(s.blobVersionedHashes[i],32),`invalid blobVersionedHash at index ${i}: must be length 32`,"data",r);return t.length===11||un(s,t.slice(11)),s}function ko(r,t,e){const n=[T(r.chainId,"chainId"),T(r.nonce,"nonce"),T(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),T(r.maxFeePerGas||0,"maxFeePerGas"),T(r.gasLimit,"gasLimit"),r.to||xe,T(r.value,"value"),r.data,ln(r.accessList||[]),T(r.maxFeePerBlobGas||0,"maxFeePerBlobGas"),po(r.blobVersionedHashes||[],"blobVersionedHashes")];return t&&(n.push(T(t.yParity,"yParity")),n.push(M(t.r)),n.push(M(t.s)),e)?O(["0x03",Ot([n,e.map(s=>s.data),e.map(s=>s.commitment),e.map(s=>s.proof)])]):O(["0x03",Ot(n)])}function No(r){const t=Ue(y(r).slice(1));l(Array.isArray(t)&&(t.length===10||t.length===13),"invalid field count for transaction type: 4","data",g(r));const e={type:4,chainId:S(t[0],"chainId"),nonce:ee(t[1],"nonce"),maxPriorityFeePerGas:S(t[2],"maxPriorityFeePerGas"),maxFeePerGas:S(t[3],"maxFeePerGas"),gasPrice:null,gasLimit:S(t[4],"gasLimit"),to:ke(t[5]),value:S(t[6],"value"),data:g(t[7]),accessList:fn(t[8],"accessList"),authorizationList:uo(t[9],"authorizationList")};return t.length===10||un(e,t.slice(10)),e}function vo(r,t){const e=[T(r.chainId,"chainId"),T(r.nonce,"nonce"),T(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),T(r.maxFeePerGas||0,"maxFeePerGas"),T(r.gasLimit,"gasLimit"),r.to||"0x",T(r.value,"value"),r.data,ln(r.accessList||[]),ho(r.authorizationList||[])];return t&&(e.push(T(t.yParity,"yParity")),e.push(M(t.r)),e.push(M(t.s))),O(["0x04",Ot(e)])}class ct{#t;#e;#n;#r;#s;#a;#i;#o;#u;#f;#p;#g;#c;#l;#h;#d;#y;get type(){return this.#t}set type(t){switch(t){case null:this.#t=null;break;case 0:case"legacy":this.#t=0;break;case 1:case"berlin":case"eip-2930":this.#t=1;break;case 2:case"london":case"eip-1559":this.#t=2;break;case 3:case"cancun":case"eip-4844":this.#t=3;break;case 4:case"pectra":case"eip-7702":this.#t=4;break;default:l(!1,"unsupported transaction type","type",t)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const t=this.#e;return t==null&&this.type===3?xe:t}set to(t){this.#e=t==null?null:x(t)}get nonce(){return this.#r}set nonce(t){this.#r=N(t,"value")}get gasLimit(){return this.#s}set gasLimit(t){this.#s=b(t)}get gasPrice(){const t=this.#a;return t==null&&(this.type===0||this.type===1)?V:t}set gasPrice(t){this.#a=t==null?null:b(t,"gasPrice")}get maxPriorityFeePerGas(){const t=this.#i;return t??(this.type===2||this.type===3?V:null)}set maxPriorityFeePerGas(t){this.#i=t==null?null:b(t,"maxPriorityFeePerGas")}get maxFeePerGas(){const t=this.#o;return t??(this.type===2||this.type===3?V:null)}set maxFeePerGas(t){this.#o=t==null?null:b(t,"maxFeePerGas")}get data(){return this.#n}set data(t){this.#n=g(t)}get value(){return this.#u}set value(t){this.#u=b(t,"value")}get chainId(){return this.#f}set chainId(t){this.#f=b(t)}get signature(){return this.#p||null}set signature(t){this.#p=t==null?null:D.from(t)}get accessList(){const t=this.#g||null;return t??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(t){this.#g=t==null?null:te(t)}get authorizationList(){const t=this.#y||null;return t==null&&this.type===4?[]:t}set authorizationList(t){this.#y=t==null?null:t.map(e=>ai(e))}get maxFeePerBlobGas(){const t=this.#c;return t==null&&this.type===3?V:t}set maxFeePerBlobGas(t){this.#c=t==null?null:b(t,"maxFeePerBlobGas")}get blobVersionedHashes(){let t=this.#l;return t==null&&this.type===3?[]:t}set blobVersionedHashes(t){if(t!=null){l(Array.isArray(t),"blobVersionedHashes must be an Array","value",t),t=t.slice();for(let e=0;e<t.length;e++)l(U(t[e],32),"invalid blobVersionedHash",`value[${e}]`,t[e])}this.#l=t}get blobs(){return this.#d==null?null:this.#d.map(t=>Object.assign({},t))}set blobs(t){if(t==null){this.#d=null;return}const e=[],n=[];for(let s=0;s<t.length;s++){const i=t[s];if(an(i)){p(this.#h,"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let a=y(i);if(l(a.length<=Nn,"blob is too large",`blobs[${s}]`,i),a.length!==Nn){const f=new Uint8Array(Nn);f.set(a),a=f}const o=this.#h.blobToKzgCommitment(a),c=g(this.#h.computeBlobKzgProof(a,o));e.push({data:g(a),commitment:g(o),proof:c}),n.push(Ur(1,o))}else{const a=g(i.commitment);e.push({data:g(i.data),commitment:a,proof:g(i.proof)}),n.push(Ur(1,a))}}this.#d=e,this.#l=n}get kzg(){return this.#h}set kzg(t){t==null?this.#h=null:this.#h=lo(t)}constructor(){this.#t=null,this.#e=null,this.#r=0,this.#s=V,this.#a=null,this.#i=null,this.#o=null,this.#n="0x",this.#u=V,this.#f=V,this.#p=null,this.#g=null,this.#c=null,this.#l=null,this.#h=null,this.#d=null,this.#y=null}get hash(){return this.signature==null?null:B(this.#m(!0,!1))}get unsignedHash(){return B(this.unsignedSerialized)}get from(){return this.signature==null?null:so(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:rt.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}#m(t,e){p(!t||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const n=t?this.signature:null;switch(this.inferType()){case 0:return mo(this,n);case 1:return Eo(this,n);case 2:return bo(this,n);case 3:return ko(this,n,e?this.blobs:null);case 4:return vo(this,n)}p(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get serialized(){return this.#m(!0,!0)}get unsignedSerialized(){return this.#m(!1,!1)}inferType(){const t=this.inferTypes();return t.indexOf(2)>=0?2:t.pop()}inferTypes(){const t=this.gasPrice!=null,e=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,n=this.accessList!=null,s=this.#c!=null||this.#l;this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&p(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),p(!e||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),p(this.type!==0||!n,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return this.type!=null?i.push(this.type):this.authorizationList&&this.authorizationList.length?i.push(4):e?i.push(2):t?(i.push(1),n||i.push(0)):n?(i.push(1),i.push(2)):(s&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return ct.from(this)}toJSON(){const t=e=>e==null?null:e.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:t(this.gasLimit),gasPrice:t(this.gasPrice),maxPriorityFeePerGas:t(this.maxPriorityFeePerGas),maxFeePerGas:t(this.maxFeePerGas),value:t(this.value),chainId:t(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(t){if(t==null)return new ct;if(typeof t=="string"){const n=y(t);if(n[0]>=127)return ct.from(go(n));switch(n[0]){case 1:return ct.from(wo(n));case 2:return ct.from(yo(n));case 3:return ct.from(Po(n));case 4:return ct.from(No(n))}p(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const e=new ct;return t.type!=null&&(e.type=t.type),t.to!=null&&(e.to=t.to),t.nonce!=null&&(e.nonce=t.nonce),t.gasLimit!=null&&(e.gasLimit=t.gasLimit),t.gasPrice!=null&&(e.gasPrice=t.gasPrice),t.maxPriorityFeePerGas!=null&&(e.maxPriorityFeePerGas=t.maxPriorityFeePerGas),t.maxFeePerGas!=null&&(e.maxFeePerGas=t.maxFeePerGas),t.maxFeePerBlobGas!=null&&(e.maxFeePerBlobGas=t.maxFeePerBlobGas),t.data!=null&&(e.data=t.data),t.value!=null&&(e.value=t.value),t.chainId!=null&&(e.chainId=t.chainId),t.signature!=null&&(e.signature=D.from(t.signature)),t.accessList!=null&&(e.accessList=t.accessList),t.authorizationList!=null&&(e.authorizationList=t.authorizationList),t.blobVersionedHashes!=null&&(e.blobVersionedHashes=t.blobVersionedHashes),t.kzg!=null&&(e.kzg=t.kzg),t.blobs!=null&&(e.blobs=t.blobs),t.hash!=null&&(l(e.isSigned(),"unsigned transaction cannot define '.hash'","tx",t),l(e.hash===t.hash,"hash mismatch","tx",t)),t.from!=null&&(l(e.isSigned(),"unsigned transaction cannot define '.from'","tx",t),l(e.from.toLowerCase()===(t.from||"").toLowerCase(),"from mismatch","tx",t)),e}}function Ao(r){return l(typeof r.address=="string","invalid address for hashAuthorization","auth.address",r),B(O(["0x05",Ot([r.chainId!=null?M(r.chainId):"0x",x(r.address),r.nonce!=null?M(r.nonce):"0x"])]))}function St(r){return B(et(r))}const oi=new Uint8Array(32);oi.fill(0);function Lr(r){return l(r.length!==0,"invalid ENS name; empty component","comp",r),r}function ci(r){const t=et(To(r)),e=[];if(r.length===0)return e;let n=0;for(let s=0;s<t.length;s++)t[s]===46&&(e.push(Lr(t.slice(n,s))),n=s+1);return l(n<t.length,"invalid ENS name; empty component","name",r),e.push(Lr(t.slice(n))),e}function To(r){try{if(r.length===0)throw new Error("empty label");return na(r)}catch(t){l(!1,`invalid ENS name (${t.message})`,"name",r)}}function Gn(r){l(typeof r=="string","invalid ENS name; not a string","name",r),l(r.length,"invalid ENS name (empty label)","name",r);let t=oi;const e=ci(r);for(;e.length;)t=B(O([t,B(e.pop())]));return g(t)}function xo(r,t){const e=t;return l(e<=255,"DNS encoded label cannot exceed 255","length",e),g(O(ci(r).map(n=>{l(n.length<=e,`label ${JSON.stringify(r)} exceeds ${e} bytes`,"name",r);const s=new Uint8Array(n.length+1);return s.set(n,1),s[0]=s.length-1,s})))+"00"}function Io(r){return typeof r=="string"&&(r=et(r)),B(O([et($a),et(String(r.length)),r]))}const fi=new Uint8Array(32);fi.fill(0);const Ro=BigInt(-1),li=BigInt(0),ui=BigInt(1),Oo=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function So(r){const t=y(r),e=t.length%32;return e?O([t,fi.slice(e)]):g(t)}const Co=It(ui,32),Uo=It(li,32),Fr={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},vn=["name","version","chainId","verifyingContract","salt"];function Br(r){return function(t){return l(typeof t=="string",`invalid domain value for ${JSON.stringify(r)}`,`domain.${r}`,t),t}}const Lo={name:Br("name"),version:Br("version"),chainId:function(r){const t=b(r,"domain.chainId");return l(t>=0,"invalid chain ID","domain.chainId",r),Number.isSafeInteger(t)?Number(t):dt(t)},verifyingContract:function(r){try{return x(r).toLowerCase()}catch{}l(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",r)},salt:function(r){const t=y(r,"domain.salt");return l(t.length===32,'invalid domain value "salt"',"domain.salt",r),g(t)}};function An(r){{const t=r.match(/^(u?)int(\d+)$/);if(t){const e=t[1]==="",n=parseInt(t[2]);l(n%8===0&&n!==0&&n<=256&&t[2]===String(n),"invalid numeric width","type",r);const s=Kt(Oo,e?n-1:n),i=e?(s+ui)*Ro:li;return function(a){const o=b(a,"value");return l(o>=i&&o<=s,`value out-of-bounds for ${r}`,"value",o),It(e?Es(o,256):o,32)}}}{const t=r.match(/^bytes(\d+)$/);if(t){const e=parseInt(t[1]);return l(e!==0&&e<=32&&t[1]===String(e),"invalid bytes width","type",r),function(n){const s=y(n);return l(s.length===e,`invalid length for ${r}`,"value",n),So(n)}}}switch(r){case"address":return function(t){return xt(x(t),32)};case"bool":return function(t){return t?Co:Uo};case"bytes":return function(t){return B(t)};case"string":return function(t){return St(t)}}return null}function _r(r,t){return`${r}(${t.map(({name:e,type:n})=>n+" "+e).join(",")})`}function Xe(r){const t=r.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return t?{base:t[1],index:t[2]+t[4],array:{base:t[1],prefix:t[1]+t[2],count:t[5]?parseInt(t[5]):-1}}:{base:r}}class Q{primaryType;#t;get types(){return JSON.parse(this.#t)}#e;#n;constructor(t){this.#e=new Map,this.#n=new Map;const e=new Map,n=new Map,s=new Map,i={};Object.keys(t).forEach(c=>{i[c]=t[c].map(({name:f,type:u})=>{let{base:h,index:d}=Xe(u);return h==="int"&&!t.int&&(h="int256"),h==="uint"&&!t.uint&&(h="uint256"),{name:f,type:h+(d||"")}}),e.set(c,new Set),n.set(c,[]),s.set(c,new Set)}),this.#t=JSON.stringify(i);for(const c in i){const f=new Set;for(const u of i[c]){l(!f.has(u.name),`duplicate variable name ${JSON.stringify(u.name)} in ${JSON.stringify(c)}`,"types",t),f.add(u.name);const h=Xe(u.type).base;l(h!==c,`circular type reference to ${JSON.stringify(h)}`,"types",t),!An(h)&&(l(n.has(h),`unknown type ${JSON.stringify(h)}`,"types",t),n.get(h).push(c),e.get(c).add(h))}}const a=Array.from(n.keys()).filter(c=>n.get(c).length===0);l(a.length!==0,"missing primary type","types",t),l(a.length===1,`ambiguous primary types or unused types: ${a.map(c=>JSON.stringify(c)).join(", ")}`,"types",t),E(this,{primaryType:a[0]});function o(c,f){l(!f.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",t),f.add(c);for(const u of e.get(c))if(n.has(u)){o(u,f);for(const h of f)s.get(h).add(u)}f.delete(c)}o(this.primaryType,new Set);for(const[c,f]of s){const u=Array.from(f);u.sort(),this.#e.set(c,_r(c,i[c])+u.map(h=>_r(h,i[h])).join(""))}}getEncoder(t){let e=this.#n.get(t);return e||(e=this.#r(t),this.#n.set(t,e)),e}#r(t){{const s=An(t);if(s)return s}const e=Xe(t).array;if(e){const s=e.prefix,i=this.getEncoder(s);return a=>{l(e.count===-1||e.count===a.length,`array length mismatch; expected length ${e.count}`,"value",a);let o=a.map(i);return this.#e.has(s)&&(o=o.map(B)),B(O(o))}}const n=this.types[t];if(n){const s=St(this.#e.get(t));return i=>{const a=n.map(({name:o,type:c})=>{const f=this.getEncoder(c)(i[o]);return this.#e.has(c)?B(f):f});return a.unshift(s),O(a)}}l(!1,`unknown type: ${t}`,"type",t)}encodeType(t){const e=this.#e.get(t);return l(e,`unknown type: ${JSON.stringify(t)}`,"name",t),e}encodeData(t,e){return this.getEncoder(t)(e)}hashStruct(t,e){return B(this.encodeData(t,e))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,e,n){if(An(t))return n(t,e);const s=Xe(t).array;if(s)return l(s.count===-1||s.count===e.length,`array length mismatch; expected length ${s.count}`,"value",e),e.map(a=>this._visit(s.prefix,a,n));const i=this.types[t];if(i)return i.reduce((a,{name:o,type:c})=>(a[o]=this._visit(c,e[o],n),a),{});l(!1,`unknown type: ${t}`,"type",t)}visit(t,e){return this._visit(this.primaryType,t,e)}static from(t){return new Q(t)}static getPrimaryType(t){return Q.from(t).primaryType}static hashStruct(t,e,n){return Q.from(e).hashStruct(t,n)}static hashDomain(t){const e=[];for(const n in t){if(t[n]==null)continue;const s=Fr[n];l(s,`invalid typed-data domain key: ${JSON.stringify(n)}`,"domain",t),e.push({name:n,type:s})}return e.sort((n,s)=>vn.indexOf(n.name)-vn.indexOf(s.name)),Q.hashStruct("EIP712Domain",{EIP712Domain:e},t)}static encode(t,e,n){return O(["0x1901",Q.hashDomain(t),Q.from(e).hash(n)])}static hash(t,e,n){return B(Q.encode(t,e,n))}static async resolveNames(t,e,n,s){t=Object.assign({},t);for(const o in t)t[o]==null&&delete t[o];const i={};t.verifyingContract&&!U(t.verifyingContract,20)&&(i[t.verifyingContract]="0x");const a=Q.from(e);a.visit(n,(o,c)=>(o==="address"&&!U(c,20)&&(i[c]="0x"),c));for(const o in i)i[o]=await s(o);return t.verifyingContract&&i[t.verifyingContract]&&(t.verifyingContract=i[t.verifyingContract]),n=a.visit(n,(o,c)=>o==="address"&&i[c]?i[c]:c),{domain:t,value:n}}static getPayload(t,e,n){Q.hashDomain(t);const s={},i=[];vn.forEach(c=>{const f=t[c];f!=null&&(s[c]=Lo[c](f),i.push({name:c,type:Fr[c]}))});const a=Q.from(e);e=a.types;const o=Object.assign({},e);return l(o.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",e),o.EIP712Domain=i,a.encode(n),{types:o,domain:s,primaryType:a.primaryType,message:a.visit(n,(c,f)=>{if(c.match(/^bytes(\d*)/))return g(y(f));if(c.match(/^u?int/))return b(f).toString();switch(c){case"address":return f.toLowerCase();case"bool":return!!f;case"string":return l(typeof f=="string","invalid string","value",f),f}l(!1,"unsupported type","type",c)})}}}function tt(r){const t=new Set;return r.forEach(e=>t.add(e)),Object.freeze(t)}const Fo="external public payable override",Bo=tt(Fo.split(" ")),hi="constant external internal payable private public pure view override",_o=tt(hi.split(" ")),di="constructor error event fallback function receive struct",pi=tt(di.split(" ")),gi="calldata memory storage payable indexed",Do=tt(gi.split(" ")),$o="tuple returns",Mo=[di,gi,$o,hi].join(" "),Go=tt(Mo.split(" ")),zo={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},Vo=new RegExp("^(\\s*)"),Ho=new RegExp("^([0-9]+)"),Ko=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),mi=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),yi=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");class ut{#t;#e;get offset(){return this.#t}get length(){return this.#e.length-this.#t}constructor(t){this.#t=0,this.#e=t.slice()}clone(){return new ut(this.#e)}reset(){this.#t=0}#n(t=0,e=0){return new ut(this.#e.slice(t,e).map(n=>Object.freeze(Object.assign({},n,{match:n.match-t,linkBack:n.linkBack-t,linkNext:n.linkNext-t}))))}popKeyword(t){const e=this.peek();if(e.type!=="KEYWORD"||!t.has(e.text))throw new Error(`expected keyword ${e.text}`);return this.pop().text}popType(t){if(this.peek().type!==t){const e=this.peek();throw new Error(`expected ${t}; got ${e.type} ${JSON.stringify(e.text)}`)}return this.pop().text}popParen(){const t=this.peek();if(t.type!=="OPEN_PAREN")throw new Error("bad start");const e=this.#n(this.#t+1,t.match+1);return this.#t=t.match+1,e}popParams(){const t=this.peek();if(t.type!=="OPEN_PAREN")throw new Error("bad start");const e=[];for(;this.#t<t.match-1;){const n=this.peek().linkNext;e.push(this.#n(this.#t+1,n)),this.#t=n}return this.#t=t.match+1,e}peek(){if(this.#t>=this.#e.length)throw new Error("out-of-bounds");return this.#e[this.#t]}peekKeyword(t){const e=this.peekType("KEYWORD");return e!=null&&t.has(e)?e:null}peekType(t){if(this.length===0)return null;const e=this.peek();return e.type===t?e.text:null}pop(){const t=this.peek();return this.#t++,t}toString(){const t=[];for(let e=this.#t;e<this.#e.length;e++){const n=this.#e[e];t.push(`${n.type}:${n.text}`)}return`<TokenString ${t.join(" ")}>`}}function $t(r){const t=[],e=a=>{const o=i<r.length?JSON.stringify(r[i]):"$EOI";throw new Error(`invalid token ${o} at ${i}: ${a}`)};let n=[],s=[],i=0;for(;i<r.length;){let a=r.substring(i),o=a.match(Vo);o&&(i+=o[1].length,a=r.substring(i));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};t.push(c);let f=zo[a[0]]||"";if(f){if(c.type=f,c.text=a[0],i++,f==="OPEN_PAREN")n.push(t.length-1),s.push(t.length-1);else if(f=="CLOSE_PAREN")n.length===0&&e("no matching open bracket"),c.match=n.pop(),t[c.match].match=t.length-1,c.depth--,c.linkBack=s.pop(),t[c.linkBack].linkNext=t.length-1;else if(f==="COMMA")c.linkBack=s.pop(),t[c.linkBack].linkNext=t.length-1,s.push(t.length-1);else if(f==="OPEN_BRACKET")c.type="BRACKET";else if(f==="CLOSE_BRACKET"){let u=t.pop().text;if(t.length>0&&t[t.length-1].type==="NUMBER"){const h=t.pop().text;u=h+u,t[t.length-1].value=N(h)}if(t.length===0||t[t.length-1].type!=="BRACKET")throw new Error("missing opening bracket");t[t.length-1].text+=u}continue}if(o=a.match(Ko),o){if(c.text=o[1],i+=c.text.length,Go.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(yi)){c.type="TYPE";continue}c.type="ID";continue}if(o=a.match(Ho),o){c.text=o[1],c.type="NUMBER",i+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(a[0])} at position ${i}`)}return new ut(t.map(a=>Object.freeze(a)))}function Dr(r,t){let e=[];for(const n in t.keys())r.has(n)&&e.push(n);if(e.length>1)throw new Error(`conflicting types: ${e.join(", ")}`)}function hn(r,t){if(t.peekKeyword(pi)){const e=t.pop().text;if(e!==r)throw new Error(`expected ${r}, got ${e}`)}return t.popType("ID")}function Ct(r,t){const e=new Set;for(;;){const n=r.peekType("KEYWORD");if(n==null||t&&!t.has(n))break;if(r.pop(),e.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);e.add(n)}return Object.freeze(e)}function bi(r){let t=Ct(r,_o);return Dr(t,tt("constant payable nonpayable".split(" "))),Dr(t,tt("pure view payable nonpayable".split(" "))),t.has("view")?"view":t.has("pure")?"pure":t.has("payable")?"payable":t.has("nonpayable")?"nonpayable":t.has("constant")?"view":"nonpayable"}function Tt(r,t){return r.popParams().map(e=>C.from(e,t))}function wi(r){if(r.peekType("AT")){if(r.pop(),r.peekType("NUMBER"))return b(r.pop().text);throw new Error("invalid gas")}return null}function Zt(r){if(r.length)throw new Error(`unexpected tokens at offset ${r.offset}: ${r.toString()}`)}const Xo=new RegExp(/^(.*)\[([0-9]*)\]$/);function $r(r){const t=r.match(yi);if(l(t,"invalid type","type",r),r==="uint")return"uint256";if(r==="int")return"int256";if(t[2]){const e=parseInt(t[2]);l(e!==0&&e<=32,"invalid bytes length","type",r)}else if(t[3]){const e=parseInt(t[3]);l(e!==0&&e<=256&&e%8===0,"invalid numeric width","type",r)}return r}const _={},st=Symbol.for("_ethers_internal"),Mr="_ParamTypeInternal",Gr="_ErrorInternal",zr="_EventInternal",Vr="_ConstructorInternal",Hr="_FallbackInternal",Kr="_FunctionInternal",Xr="_StructInternal";class C{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(t,e,n,s,i,a,o,c){if(_t(t,_,"ParamType"),Object.defineProperty(this,st,{value:Mr}),a&&(a=Object.freeze(a.slice())),s==="array"){if(o==null||c==null)throw new Error("")}else if(o!=null||c!=null)throw new Error("");if(s==="tuple"){if(a==null)throw new Error("")}else if(a!=null)throw new Error("");E(this,{name:e,type:n,baseType:s,indexed:i,components:a,arrayLength:o,arrayChildren:c})}format(t){if(t==null&&(t="sighash"),t==="json"){const n=this.name||"";if(this.isArray()){const i=JSON.parse(this.arrayChildren.format("json"));return i.name=n,i.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(i)}const s={type:this.baseType==="tuple"?"tuple":this.type,name:n};return typeof this.indexed=="boolean"&&(s.indexed=this.indexed),this.isTuple()&&(s.components=this.components.map(i=>JSON.parse(i.format(t)))),JSON.stringify(s)}let e="";return this.isArray()?(e+=this.arrayChildren.format(t),e+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?e+="("+this.components.map(n=>n.format(t)).join(t==="full"?", ":",")+")":e+=this.type,t!=="sighash"&&(this.indexed===!0&&(e+=" indexed"),t==="full"&&this.name&&(e+=" "+this.name)),e}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(t,e){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const n=this;return t.map(s=>n.arrayChildren.walk(s,e))}if(this.isTuple()){if(!Array.isArray(t))throw new Error("invalid tuple value");if(t.length!==this.components.length)throw new Error("array is wrong length");const n=this;return t.map((s,i)=>n.components[i].walk(s,e))}return e(this.type,t)}#t(t,e,n,s){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");const a=this.arrayChildren,o=e.slice();o.forEach((c,f)=>{a.#t(t,c,n,u=>{o[f]=u})}),s(o);return}if(this.isTuple()){const a=this.components;let o;if(Array.isArray(e))o=e.slice();else{if(e==null||typeof e!="object")throw new Error("invalid tuple value");o=a.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in e))throw new Error(`missing value for component ${c.name}`);return e[c.name]})}if(o.length!==this.components.length)throw new Error("array is wrong length");o.forEach((c,f)=>{a[f].#t(t,c,n,u=>{o[f]=u})}),s(o);return}const i=n(this.type,e);i.then?t.push(async function(){s(await i)}()):s(i)}async walkAsync(t,e){const n=[],s=[t];return this.#t(n,t,e,i=>{s[0]=i}),n.length&&await Promise.all(n),s[0]}static from(t,e){if(C.isParamType(t))return t;if(typeof t=="string")try{return C.from($t(t),e)}catch{l(!1,"invalid param type","obj",t)}else if(t instanceof ut){let o="",c="",f=null;Ct(t,tt(["tuple"])).has("tuple")||t.peekType("OPEN_PAREN")?(c="tuple",f=t.popParams().map(k=>C.from(k)),o=`tuple(${f.map(k=>k.format()).join(",")})`):(o=$r(t.popType("TYPE")),c=o);let u=null,h=null;for(;t.length&&t.peekType("BRACKET");){const k=t.pop();u=new C(_,"",o,c,null,f,h,u),h=k.value,o+=k.text,c="array",f=null}let d=null;if(Ct(t,Do).has("indexed")){if(!e)throw new Error("");d=!0}const P=t.peekType("ID")?t.pop().text:"";if(t.length)throw new Error("leftover tokens");return new C(_,P,o,c,d,f,h,u)}const n=t.name;l(!n||typeof n=="string"&&n.match(mi),"invalid name","obj.name",n);let s=t.indexed;s!=null&&(l(e,"parameter cannot be indexed","obj.indexed",t.indexed),s=!!s);let i=t.type,a=i.match(Xo);if(a){const o=parseInt(a[2]||"-1"),c=C.from({type:a[1],components:t.components});return new C(_,n||"",i,"array",s,null,o,c)}if(i==="tuple"||i.startsWith("tuple(")||i.startsWith("(")){const o=t.components!=null?t.components.map(f=>C.from(f)):null;return new C(_,n||"",i,"tuple",s,o,null,null)}return i=$r(t.type),new C(_,n||"",i,i,s,null,null,null)}static isParamType(t){return t&&t[st]===Mr}}class Yt{type;inputs;constructor(t,e,n){_t(t,_,"Fragment"),n=Object.freeze(n.slice()),E(this,{type:e,inputs:n})}static from(t){if(typeof t=="string"){try{Yt.from(JSON.parse(t))}catch{}return Yt.from($t(t))}if(t instanceof ut)switch(t.peekKeyword(pi)){case"constructor":return vt.from(t);case"error":return nt.from(t);case"event":return yt.from(t);case"fallback":case"receive":return kt.from(t);case"function":return bt.from(t);case"struct":return Wt.from(t)}else if(typeof t=="object"){switch(t.type){case"constructor":return vt.from(t);case"error":return nt.from(t);case"event":return yt.from(t);case"fallback":case"receive":return kt.from(t);case"function":return bt.from(t);case"struct":return Wt.from(t)}p(!1,`unsupported type: ${t.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}l(!1,"unsupported frgament object","obj",t)}static isConstructor(t){return vt.isFragment(t)}static isError(t){return nt.isFragment(t)}static isEvent(t){return yt.isFragment(t)}static isFunction(t){return bt.isFragment(t)}static isStruct(t){return Wt.isFragment(t)}}class dn extends Yt{name;constructor(t,e,n,s){super(t,e,s),l(typeof n=="string"&&n.match(mi),"invalid identifier","name",n),s=Object.freeze(s.slice()),E(this,{name:n})}}function Ie(r,t){return"("+t.map(e=>e.format(r)).join(r==="full"?", ":",")+")"}class nt extends dn{constructor(t,e,n){super(t,"error",e,n),Object.defineProperty(this,st,{value:Gr})}get selector(){return St(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});const e=[];return t!=="sighash"&&e.push("error"),e.push(this.name+Ie(t,this.inputs)),e.join(" ")}static from(t){if(nt.isFragment(t))return t;if(typeof t=="string")return nt.from($t(t));if(t instanceof ut){const e=hn("error",t),n=Tt(t);return Zt(t),new nt(_,e,n)}return new nt(_,t.name,t.inputs?t.inputs.map(C.from):[])}static isFragment(t){return t&&t[st]===Gr}}class yt extends dn{anonymous;constructor(t,e,n,s){super(t,"event",e,n),Object.defineProperty(this,st,{value:zr}),E(this,{anonymous:s})}get topicHash(){return St(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});const e=[];return t!=="sighash"&&e.push("event"),e.push(this.name+Ie(t,this.inputs)),t!=="sighash"&&this.anonymous&&e.push("anonymous"),e.join(" ")}static getTopicHash(t,e){return e=(e||[]).map(s=>C.from(s)),new yt(_,t,e,!1).topicHash}static from(t){if(yt.isFragment(t))return t;if(typeof t=="string")try{return yt.from($t(t))}catch{l(!1,"invalid event fragment","obj",t)}else if(t instanceof ut){const e=hn("event",t),n=Tt(t,!0),s=!!Ct(t,tt(["anonymous"])).has("anonymous");return Zt(t),new yt(_,e,n,s)}return new yt(_,t.name,t.inputs?t.inputs.map(e=>C.from(e,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[st]===zr}}class vt extends Yt{payable;gas;constructor(t,e,n,s,i){super(t,e,n),Object.defineProperty(this,st,{value:Vr}),E(this,{payable:s,gas:i})}format(t){if(p(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});const e=[`constructor${Ie(t,this.inputs)}`];return this.payable&&e.push("payable"),this.gas!=null&&e.push(`@${this.gas.toString()}`),e.join(" ")}static from(t){if(vt.isFragment(t))return t;if(typeof t=="string")try{return vt.from($t(t))}catch{l(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof ut){Ct(t,tt(["constructor"]));const e=Tt(t),n=!!Ct(t,Bo).has("payable"),s=wi(t);return Zt(t),new vt(_,"constructor",e,n,s)}return new vt(_,"constructor",t.inputs?t.inputs.map(C.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[st]===Vr}}class kt extends Yt{payable;constructor(t,e,n){super(t,"fallback",e),Object.defineProperty(this,st,{value:Hr}),E(this,{payable:n})}format(t){const e=this.inputs.length===0?"receive":"fallback";if(t==="json"){const n=this.payable?"payable":"nonpayable";return JSON.stringify({type:e,stateMutability:n})}return`${e}()${this.payable?" payable":""}`}static from(t){if(kt.isFragment(t))return t;if(typeof t=="string")try{return kt.from($t(t))}catch{l(!1,"invalid fallback fragment","obj",t)}else if(t instanceof ut){const e=t.toString(),n=t.peekKeyword(tt(["fallback","receive"]));if(l(n,"type must be fallback or receive","obj",e),t.popKeyword(tt(["fallback","receive"]))==="receive"){const o=Tt(t);return l(o.length===0,"receive cannot have arguments","obj.inputs",o),Ct(t,tt(["payable"])),Zt(t),new kt(_,[],!0)}let i=Tt(t);i.length?l(i.length===1&&i[0].type==="bytes","invalid fallback inputs","obj.inputs",i.map(o=>o.format("minimal")).join(", ")):i=[C.from("bytes")];const a=bi(t);if(l(a==="nonpayable"||a==="payable","fallback cannot be constants","obj.stateMutability",a),Ct(t,tt(["returns"])).has("returns")){const o=Tt(t);l(o.length===1&&o[0].type==="bytes","invalid fallback outputs","obj.outputs",o.map(c=>c.format("minimal")).join(", "))}return Zt(t),new kt(_,i,a==="payable")}if(t.type==="receive")return new kt(_,[],!0);if(t.type==="fallback"){const e=[C.from("bytes")],n=t.stateMutability==="payable";return new kt(_,e,n)}l(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[st]===Hr}}class bt extends dn{constant;outputs;stateMutability;payable;gas;constructor(t,e,n,s,i,a){super(t,"function",e,s),Object.defineProperty(this,st,{value:Kr}),i=Object.freeze(i.slice()),E(this,{constant:n==="view"||n==="pure",gas:a,outputs:i,payable:n==="payable",stateMutability:n})}get selector(){return St(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(t))),outputs:this.outputs.map(n=>JSON.parse(n.format(t)))});const e=[];return t!=="sighash"&&e.push("function"),e.push(this.name+Ie(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&e.push(this.stateMutability),this.outputs&&this.outputs.length&&(e.push("returns"),e.push(Ie(t,this.outputs))),this.gas!=null&&e.push(`@${this.gas.toString()}`)),e.join(" ")}static getSelector(t,e){return e=(e||[]).map(s=>C.from(s)),new bt(_,t,"view",e,[],null).selector}static from(t){if(bt.isFragment(t))return t;if(typeof t=="string")try{return bt.from($t(t))}catch{l(!1,"invalid function fragment","obj",t)}else if(t instanceof ut){const n=hn("function",t),s=Tt(t),i=bi(t);let a=[];Ct(t,tt(["returns"])).has("returns")&&(a=Tt(t));const o=wi(t);return Zt(t),new bt(_,n,i,s,a,o)}let e=t.stateMutability;return e==null&&(e="payable",typeof t.constant=="boolean"?(e="view",t.constant||(e="payable",typeof t.payable=="boolean"&&!t.payable&&(e="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(e="nonpayable")),new bt(_,t.name,e,t.inputs?t.inputs.map(C.from):[],t.outputs?t.outputs.map(C.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[st]===Kr}}class Wt extends dn{constructor(t,e,n){super(t,"struct",e,n),Object.defineProperty(this,st,{value:Xr})}format(){throw new Error("@TODO")}static from(t){if(typeof t=="string")try{return Wt.from($t(t))}catch{l(!1,"invalid struct fragment","obj",t)}else if(t instanceof ut){const e=hn("struct",t),n=Tt(t);return Zt(t),new Wt(_,e,n)}return new Wt(_,t.name,t.inputs?t.inputs.map(C.from):[])}static isFragment(t){return t&&t[st]===Xr}}const gt=new Map;gt.set(0,"GENERIC_PANIC");gt.set(1,"ASSERT_FALSE");gt.set(17,"OVERFLOW");gt.set(18,"DIVIDE_BY_ZERO");gt.set(33,"ENUM_RANGE_ERROR");gt.set(34,"BAD_STORAGE_DATA");gt.set(49,"STACK_UNDERFLOW");gt.set(50,"ARRAY_RANGE_ERROR");gt.set(65,"OUT_OF_MEMORY");gt.set(81,"UNINITIALIZED_FUNCTION_CALL");const Jo=new RegExp(/^bytes([0-9]*)$/),Wo=new RegExp(/^(u?int)([0-9]*)$/);let Tn=null,Jr=1024;function jo(r,t,e,n){let s="missing revert data",i=null;const a=null;let o=null;if(e){s="execution reverted";const f=y(e);if(e=g(e),f.length===0)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(f.length%32!==4)s+=" (could not decode reason; invalid data length)";else if(g(f.slice(0,4))==="0x08c379a0")try{i=n.decode(["string"],f.slice(4))[0],o={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch{s+=" (could not decode reason; invalid string data)"}else if(g(f.slice(0,4))==="0x4e487b71")try{const u=Number(n.decode(["uint256"],f.slice(4))[0]);o={signature:"Panic(uint256)",name:"Panic",args:[u]},i=`Panic due to ${gt.get(u)||"UNKNOWN"}(${u})`,s+=`: ${i}`}catch{s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const c={to:t.to?x(t.to):null,data:t.data||"0x"};return t.from&&(c.from=x(t.from)),F(s,"CALL_EXCEPTION",{action:r,data:e,reason:i,transaction:c,invocation:a,revert:o})}class ge{#t(t){if(t.isArray())return new Ja(this.#t(t.arrayChildren),t.arrayLength,t.name);if(t.isTuple())return new Ke(t.components.map(n=>this.#t(n)),t.name);switch(t.baseType){case"address":return new Ka(t.name);case"bool":return new Wa(t.name);case"string":return new ro(t.name);case"bytes":return new ja(t.name);case"":return new Qa(t.name)}let e=t.type.match(Wo);if(e){let n=parseInt(e[2]||"256");return l(n!==0&&n<=256&&n%8===0,"invalid "+e[1]+" bit length","param",t),new no(n/8,e[1]==="int",t.name)}if(e=t.type.match(Jo),e){let n=parseInt(e[1]);return l(n!==0&&n<=32,"invalid bytes length","param",t),new Za(n,t.name)}l(!1,"invalid type","type",t.type)}getDefaultValue(t){const e=t.map(s=>this.#t(C.from(s)));return new Ke(e,"_").defaultValue()}encode(t,e){ms(e.length,t.length,"types/values length mismatch");const n=t.map(a=>this.#t(C.from(a))),s=new Ke(n,"_"),i=new Mn;return s.encode(i,e),i.data}decode(t,e,n){const s=t.map(a=>this.#t(C.from(a)));return new Ke(s,"_").decode(new qn(e,n,Jr))}static _setDefaultMaxInflation(t){l(typeof t=="number"&&Number.isInteger(t),"invalid defaultMaxInflation factor","value",t),Jr=t}static defaultAbiCoder(){return Tn==null&&(Tn=new ge),Tn}static getBuiltinCallException(t,e,n){return jo(t,e,n,ge.defaultAbiCoder())}}class Zo{fragment;name;signature;topic;args;constructor(t,e,n){const s=t.name,i=t.format();E(this,{fragment:t,name:s,signature:i,topic:e,args:n})}}class Yo{fragment;name;args;signature;selector;value;constructor(t,e,n,s){const i=t.name,a=t.format();E(this,{fragment:t,name:i,args:n,signature:a,selector:e,value:s})}}class Qo{fragment;name;args;signature;selector;constructor(t,e,n){const s=t.name,i=t.format();E(this,{fragment:t,name:s,args:n,signature:i,selector:e})}}class Wr{hash;_isIndexed;static isIndexed(t){return!!(t&&t._isIndexed)}constructor(t){E(this,{hash:t,_isIndexed:!0})}}const jr={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},Zr={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:r=>`reverted with reason string ${JSON.stringify(r)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:r=>{let t="unknown panic code";return r>=0&&r<=255&&jr[r.toString()]&&(t=jr[r.toString()]),`reverted with panic code 0x${r.toString(16)} (${t})`}}};class Lt{fragments;deploy;fallback;receive;#t;#e;#n;#r;constructor(t){let e=[];typeof t=="string"?e=JSON.parse(t):e=t,this.#n=new Map,this.#t=new Map,this.#e=new Map;const n=[];for(const a of e)try{n.push(Yt.from(a))}catch(o){console.log(`[Warning] Invalid Fragment ${JSON.stringify(a)}:`,o.message)}E(this,{fragments:Object.freeze(n)});let s=null,i=!1;this.#r=this.getAbiCoder(),this.fragments.forEach((a,o)=>{let c;switch(a.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}E(this,{deploy:a});return;case"fallback":a.inputs.length===0?i=!0:(l(!s||a.payable!==s.payable,"conflicting fallback fragments",`fragments[${o}]`,a),s=a,i=s.payable);return;case"function":c=this.#n;break;case"event":c=this.#e;break;case"error":c=this.#t;break;default:return}const f=a.format();c.has(f)||c.set(f,a)}),this.deploy||E(this,{deploy:vt.from("constructor()")}),E(this,{fallback:s,receive:i})}format(t){const e=t?"minimal":"full";return this.fragments.map(s=>s.format(e))}formatJson(){const t=this.fragments.map(e=>e.format("json"));return JSON.stringify(t.map(e=>JSON.parse(e)))}getAbiCoder(){return ge.defaultAbiCoder()}#s(t,e,n){if(U(t)){const i=t.toLowerCase();for(const a of this.#n.values())if(i===a.selector)return a;return null}if(t.indexOf("(")===-1){const i=[];for(const[a,o]of this.#n)a.split("(")[0]===t&&i.push(o);if(e){const a=e.length>0?e[e.length-1]:null;let o=e.length,c=!0;$.isTyped(a)&&a.type==="overrides"&&(c=!1,o--);for(let f=i.length-1;f>=0;f--){const u=i[f].inputs.length;u!==o&&(!c||u!==o-1)&&i.splice(f,1)}for(let f=i.length-1;f>=0;f--){const u=i[f].inputs;for(let h=0;h<e.length;h++)if($.isTyped(e[h])){if(h>=u.length){if(e[h].type==="overrides")continue;i.splice(f,1);break}if(e[h].type!==u[h].baseType){i.splice(f,1);break}}}}if(i.length===1&&e&&e.length!==i[0].inputs.length){const a=e[e.length-1];(a==null||Array.isArray(a)||typeof a!="object")&&i.splice(0,1)}if(i.length===0)return null;if(i.length>1&&n){const a=i.map(o=>JSON.stringify(o.format())).join(", ");l(!1,`ambiguous function description (i.e. matches ${a})`,"key",t)}return i[0]}const s=this.#n.get(bt.from(t).format());return s||null}getFunctionName(t){const e=this.#s(t,null,!1);return l(e,"no matching function","key",t),e.name}hasFunction(t){return!!this.#s(t,null,!1)}getFunction(t,e){return this.#s(t,e||null,!0)}forEachFunction(t){const e=Array.from(this.#n.keys());e.sort((n,s)=>n.localeCompare(s));for(let n=0;n<e.length;n++){const s=e[n];t(this.#n.get(s),n)}}#a(t,e,n){if(U(t)){const i=t.toLowerCase();for(const a of this.#e.values())if(i===a.topicHash)return a;return null}if(t.indexOf("(")===-1){const i=[];for(const[a,o]of this.#e)a.split("(")[0]===t&&i.push(o);if(e){for(let a=i.length-1;a>=0;a--)i[a].inputs.length<e.length&&i.splice(a,1);for(let a=i.length-1;a>=0;a--){const o=i[a].inputs;for(let c=0;c<e.length;c++)if($.isTyped(e[c])&&e[c].type!==o[c].baseType){i.splice(a,1);break}}}if(i.length===0)return null;if(i.length>1&&n){const a=i.map(o=>JSON.stringify(o.format())).join(", ");l(!1,`ambiguous event description (i.e. matches ${a})`,"key",t)}return i[0]}const s=this.#e.get(yt.from(t).format());return s||null}getEventName(t){const e=this.#a(t,null,!1);return l(e,"no matching event","key",t),e.name}hasEvent(t){return!!this.#a(t,null,!1)}getEvent(t,e){return this.#a(t,e||null,!0)}forEachEvent(t){const e=Array.from(this.#e.keys());e.sort((n,s)=>n.localeCompare(s));for(let n=0;n<e.length;n++){const s=e[n];t(this.#e.get(s),n)}}getError(t,e){if(U(t)){const s=t.toLowerCase();if(Zr[s])return nt.from(Zr[s].signature);for(const i of this.#t.values())if(s===i.selector)return i;return null}if(t.indexOf("(")===-1){const s=[];for(const[i,a]of this.#t)i.split("(")[0]===t&&s.push(a);if(s.length===0)return t==="Error"?nt.from("error Error(string)"):t==="Panic"?nt.from("error Panic(uint256)"):null;if(s.length>1){const i=s.map(a=>JSON.stringify(a.format())).join(", ");l(!1,`ambiguous error description (i.e. ${i})`,"name",t)}return s[0]}if(t=nt.from(t).format(),t==="Error(string)")return nt.from("error Error(string)");if(t==="Panic(uint256)")return nt.from("error Panic(uint256)");const n=this.#t.get(t);return n||null}forEachError(t){const e=Array.from(this.#t.keys());e.sort((n,s)=>n.localeCompare(s));for(let n=0;n<e.length;n++){const s=e[n];t(this.#t.get(s),n)}}_decodeParams(t,e){return this.#r.decode(t,e)}_encodeParams(t,e){return this.#r.encode(t,e)}encodeDeploy(t){return this._encodeParams(this.deploy.inputs,t||[])}decodeErrorResult(t,e){if(typeof t=="string"){const n=this.getError(t);l(n,"unknown error","fragment",t),t=n}return l(L(e,0,4)===t.selector,`data signature does not match error ${t.name}.`,"data",e),this._decodeParams(t.inputs,L(e,4))}encodeErrorResult(t,e){if(typeof t=="string"){const n=this.getError(t);l(n,"unknown error","fragment",t),t=n}return O([t.selector,this._encodeParams(t.inputs,e||[])])}decodeFunctionData(t,e){if(typeof t=="string"){const n=this.getFunction(t);l(n,"unknown function","fragment",t),t=n}return l(L(e,0,4)===t.selector,`data signature does not match function ${t.name}.`,"data",e),this._decodeParams(t.inputs,L(e,4))}encodeFunctionData(t,e){if(typeof t=="string"){const n=this.getFunction(t);l(n,"unknown function","fragment",t),t=n}return O([t.selector,this._encodeParams(t.inputs,e||[])])}decodeFunctionResult(t,e){if(typeof t=="string"){const i=this.getFunction(t);l(i,"unknown function","fragment",t),t=i}let n="invalid length for result data";const s=Z(e);if(s.length%32===0)try{return this.#r.decode(t.outputs,s)}catch{n="could not decode result data"}p(!1,n,"BAD_DATA",{value:g(s),info:{method:t.name,signature:t.format()}})}makeError(t,e){const n=y(t,"data"),s=ge.getBuiltinCallException("call",e,n);if(s.message.startsWith("execution reverted (unknown custom error)")){const o=g(n.slice(0,4)),c=this.getError(o);if(c)try{const f=this.#r.decode(c.inputs,n.slice(4));s.revert={name:c.name,signature:c.format(),args:f},s.reason=s.revert.signature,s.message=`execution reverted: ${s.reason}`}catch{s.message="execution reverted (coult not decode custom error)"}}const a=this.parseTransaction(e);return a&&(s.invocation={method:a.name,signature:a.signature,args:a.args}),s}encodeFunctionResult(t,e){if(typeof t=="string"){const n=this.getFunction(t);l(n,"unknown function","fragment",t),t=n}return g(this.#r.encode(t.outputs,e||[]))}encodeFilterTopics(t,e){if(typeof t=="string"){const i=this.getEvent(t);l(i,"unknown event","eventFragment",t),t=i}p(e.length<=t.inputs.length,`too many arguments for ${t.format()}`,"UNEXPECTED_ARGUMENT",{count:e.length,expectedCount:t.inputs.length});const n=[];t.anonymous||n.push(t.topicHash);const s=(i,a)=>i.type==="string"?St(a):i.type==="bytes"?B(g(a)):(i.type==="bool"&&typeof a=="boolean"?a=a?"0x01":"0x00":i.type.match(/^u?int/)?a=It(a):i.type.match(/^bytes/)?a=oa(a,32):i.type==="address"&&this.#r.encode(["address"],[a]),xt(g(a),32));for(e.forEach((i,a)=>{const o=t.inputs[a];if(!o.indexed){l(i==null,"cannot filter non-indexed parameters; must be null","contract."+o.name,i);return}i==null?n.push(null):o.baseType==="array"||o.baseType==="tuple"?l(!1,"filtering with tuples or arrays not supported","contract."+o.name,i):Array.isArray(i)?n.push(i.map(c=>s(o,c))):n.push(s(o,i))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(t,e){if(typeof t=="string"){const a=this.getEvent(t);l(a,"unknown event","eventFragment",t),t=a}const n=[],s=[],i=[];return t.anonymous||n.push(t.topicHash),l(e.length===t.inputs.length,"event arguments/values mismatch","values",e),t.inputs.forEach((a,o)=>{const c=e[o];if(a.indexed)if(a.type==="string")n.push(St(c));else if(a.type==="bytes")n.push(B(c));else{if(a.baseType==="tuple"||a.baseType==="array")throw new Error("not implemented");n.push(this.#r.encode([a.type],[c]))}else s.push(a),i.push(c)}),{data:this.#r.encode(s,i),topics:n}}decodeEventLog(t,e,n){if(typeof t=="string"){const m=this.getEvent(t);l(m,"unknown event","eventFragment",t),t=m}if(n!=null&&!t.anonymous){const m=t.topicHash;l(U(n[0],32)&&n[0].toLowerCase()===m,"fragment/topic mismatch","topics[0]",n[0]),n=n.slice(1)}const s=[],i=[],a=[];t.inputs.forEach((m,P)=>{m.indexed?m.type==="string"||m.type==="bytes"||m.baseType==="tuple"||m.baseType==="array"?(s.push(C.from({type:"bytes32",name:m.name})),a.push(!0)):(s.push(m),a.push(!1)):(i.push(m),a.push(!1))});const o=n!=null?this.#r.decode(s,O(n)):null,c=this.#r.decode(i,e,!0),f=[],u=[];let h=0,d=0;return t.inputs.forEach((m,P)=>{let k=null;if(m.indexed)if(o==null)k=new Wr(null);else if(a[P])k=new Wr(o[d++]);else try{k=o[d++]}catch(R){k=R}else try{k=c[h++]}catch(R){k=R}f.push(k),u.push(m.name||null)}),Nt.fromItems(f,u)}parseTransaction(t){const e=y(t.data,"tx.data"),n=b(t.value!=null?t.value:0,"tx.value"),s=this.getFunction(g(e.slice(0,4)));if(!s)return null;const i=this.#r.decode(s.inputs,e.slice(4));return new Yo(s,s.selector,i,n)}parseCallResult(t){throw new Error("@TODO")}parseLog(t){const e=this.getEvent(t.topics[0]);return!e||e.anonymous?null:new Zo(e,e.topicHash,this.decodeEventLog(e,t.data,t.topics))}parseError(t){const e=g(t),n=this.getError(L(e,0,4));if(!n)return null;const s=this.#r.decode(n.inputs,L(e,4));return new Qo(n,n.selector,s)}static from(t){return t instanceof Lt?t:typeof t=="string"?new Lt(JSON.parse(t)):typeof t.formatJson=="function"?new Lt(t.formatJson()):typeof t.format=="function"?new Lt(t.format("json")):new Lt(t)}}const Ei=BigInt(0);function de(r){return r??null}function z(r){return r==null?null:r.toString()}class Yr{gasPrice;maxFeePerGas;maxPriorityFeePerGas;constructor(t,e,n){E(this,{gasPrice:de(t),maxFeePerGas:de(e),maxPriorityFeePerGas:de(n)})}toJSON(){const{gasPrice:t,maxFeePerGas:e,maxPriorityFeePerGas:n}=this;return{_type:"FeeData",gasPrice:z(t),maxFeePerGas:z(e),maxPriorityFeePerGas:z(n)}}}function Re(r){const t={};r.to&&(t.to=r.to),r.from&&(t.from=r.from),r.data&&(t.data=g(r.data));const e="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const s of e)!(s in r)||r[s]==null||(t[s]=b(r[s],`request.${s}`));const n="type,nonce".split(/,/);for(const s of n)!(s in r)||r[s]==null||(t[s]=N(r[s],`request.${s}`));return r.accessList&&(t.accessList=te(r.accessList)),r.authorizationList&&(t.authorizationList=r.authorizationList.slice()),"blockTag"in r&&(t.blockTag=r.blockTag),"enableCcipRead"in r&&(t.enableCcipRead=!!r.enableCcipRead),"customData"in r&&(t.customData=r.customData),"blobVersionedHashes"in r&&r.blobVersionedHashes&&(t.blobVersionedHashes=r.blobVersionedHashes.slice()),"kzg"in r&&(t.kzg=r.kzg),"blobs"in r&&r.blobs&&(t.blobs=r.blobs.map(s=>an(s)?g(s):Object.assign({},s))),t}class qo{provider;number;hash;timestamp;parentHash;parentBeaconBlockRoot;nonce;difficulty;gasLimit;gasUsed;stateRoot;receiptsRoot;blobGasUsed;excessBlobGas;miner;prevRandao;extraData;baseFeePerGas;#t;constructor(t,e){this.#t=t.transactions.map(n=>typeof n!="string"?new Be(n,e):n),E(this,{provider:e,hash:de(t.hash),number:t.number,timestamp:t.timestamp,parentHash:t.parentHash,parentBeaconBlockRoot:t.parentBeaconBlockRoot,nonce:t.nonce,difficulty:t.difficulty,gasLimit:t.gasLimit,gasUsed:t.gasUsed,blobGasUsed:t.blobGasUsed,excessBlobGas:t.excessBlobGas,miner:t.miner,prevRandao:de(t.prevRandao),extraData:t.extraData,baseFeePerGas:de(t.baseFeePerGas),stateRoot:t.stateRoot,receiptsRoot:t.receiptsRoot})}get transactions(){return this.#t.map(t=>typeof t=="string"?t:t.hash)}get prefetchedTransactions(){const t=this.#t.slice();return t.length===0?[]:(p(typeof t[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),t)}toJSON(){const{baseFeePerGas:t,difficulty:e,extraData:n,gasLimit:s,gasUsed:i,hash:a,miner:o,prevRandao:c,nonce:f,number:u,parentHash:h,parentBeaconBlockRoot:d,stateRoot:m,receiptsRoot:P,timestamp:k,transactions:R}=this;return{_type:"Block",baseFeePerGas:z(t),difficulty:z(e),extraData:n,gasLimit:z(s),gasUsed:z(i),blobGasUsed:z(this.blobGasUsed),excessBlobGas:z(this.excessBlobGas),hash:a,miner:o,prevRandao:c,nonce:f,number:u,parentHash:h,timestamp:k,parentBeaconBlockRoot:d,stateRoot:m,receiptsRoot:P,transactions:R}}[Symbol.iterator](){let t=0;const e=this.transactions;return{next:()=>t<this.length?{value:e[t++],done:!1}:{value:void 0,done:!0}}}get length(){return this.#t.length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(t){let e;if(typeof t=="number")e=this.#t[t];else{const n=t.toLowerCase();for(const s of this.#t)if(typeof s=="string"){if(s!==n)continue;e=s;break}else{if(s.hash!==n)continue;e=s;break}}if(e==null)throw new Error("no such tx");return typeof e=="string"?await this.provider.getTransaction(e):e}getPrefetchedTransaction(t){const e=this.prefetchedTransactions;if(typeof t=="number")return e[t];t=t.toLowerCase();for(const n of e)if(n.hash===t)return n;l(!1,"no matching transaction","indexOrHash",t)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return tc(this)}}class Fe{provider;transactionHash;blockHash;blockNumber;removed;address;data;topics;index;transactionIndex;constructor(t,e){this.provider=e;const n=Object.freeze(t.topics.slice());E(this,{transactionHash:t.transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,removed:t.removed,address:t.address,data:t.data,topics:n,index:t.index,transactionIndex:t.transactionIndex})}toJSON(){const{address:t,blockHash:e,blockNumber:n,data:s,index:i,removed:a,topics:o,transactionHash:c,transactionIndex:f}=this;return{_type:"log",address:t,blockHash:e,blockNumber:n,data:s,index:i,removed:a,topics:o,transactionHash:c,transactionIndex:f}}async getBlock(){const t=await this.provider.getBlock(this.blockHash);return p(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransaction(){const t=await this.provider.getTransaction(this.transactionHash);return p(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransactionReceipt(){const t=await this.provider.getTransactionReceipt(this.transactionHash);return p(!!t,"failed to find transaction receipt","UNKNOWN_ERROR",{}),t}removedEvent(){return ec(this)}}class Pi{provider;to;from;contractAddress;hash;index;blockHash;blockNumber;logsBloom;gasUsed;blobGasUsed;cumulativeGasUsed;gasPrice;blobGasPrice;type;status;root;#t;constructor(t,e){this.#t=Object.freeze(t.logs.map(s=>new Fe(s,e)));let n=Ei;t.effectiveGasPrice!=null?n=t.effectiveGasPrice:t.gasPrice!=null&&(n=t.gasPrice),E(this,{provider:e,to:t.to,from:t.from,contractAddress:t.contractAddress,hash:t.hash,index:t.index,blockHash:t.blockHash,blockNumber:t.blockNumber,logsBloom:t.logsBloom,gasUsed:t.gasUsed,cumulativeGasUsed:t.cumulativeGasUsed,blobGasUsed:t.blobGasUsed,gasPrice:n,blobGasPrice:t.blobGasPrice,type:t.type,status:t.status,root:t.root})}get logs(){return this.#t}toJSON(){const{to:t,from:e,contractAddress:n,hash:s,index:i,blockHash:a,blockNumber:o,logsBloom:c,logs:f,status:u,root:h}=this;return{_type:"TransactionReceipt",blockHash:a,blockNumber:o,contractAddress:n,cumulativeGasUsed:z(this.cumulativeGasUsed),from:e,gasPrice:z(this.gasPrice),blobGasUsed:z(this.blobGasUsed),blobGasPrice:z(this.blobGasPrice),gasUsed:z(this.gasUsed),hash:s,index:i,logs:f,logsBloom:c,root:h,status:u,to:t}}get length(){return this.logs.length}[Symbol.iterator](){let t=0;return{next:()=>t<this.length?{value:this.logs[t++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const t=await this.provider.getBlock(this.blockHash);if(t==null)throw new Error("TODO");return t}async getTransaction(){const t=await this.provider.getTransaction(this.hash);if(t==null)throw new Error("TODO");return t}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return Ni(this)}reorderedEvent(t){return p(!t||t.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),ki(this,t)}}class Be{provider;blockNumber;blockHash;index;hash;type;to;from;nonce;gasLimit;gasPrice;maxPriorityFeePerGas;maxFeePerGas;maxFeePerBlobGas;data;value;chainId;signature;accessList;blobVersionedHashes;authorizationList;#t;constructor(t,e){this.provider=e,this.blockNumber=t.blockNumber!=null?t.blockNumber:null,this.blockHash=t.blockHash!=null?t.blockHash:null,this.hash=t.hash,this.index=t.index,this.type=t.type,this.from=t.from,this.to=t.to||null,this.gasLimit=t.gasLimit,this.nonce=t.nonce,this.data=t.data,this.value=t.value,this.gasPrice=t.gasPrice,this.maxPriorityFeePerGas=t.maxPriorityFeePerGas!=null?t.maxPriorityFeePerGas:null,this.maxFeePerGas=t.maxFeePerGas!=null?t.maxFeePerGas:null,this.maxFeePerBlobGas=t.maxFeePerBlobGas!=null?t.maxFeePerBlobGas:null,this.chainId=t.chainId,this.signature=t.signature,this.accessList=t.accessList!=null?t.accessList:null,this.blobVersionedHashes=t.blobVersionedHashes!=null?t.blobVersionedHashes:null,this.authorizationList=t.authorizationList!=null?t.authorizationList:null,this.#t=-1}toJSON(){const{blockNumber:t,blockHash:e,index:n,hash:s,type:i,to:a,from:o,nonce:c,data:f,signature:u,accessList:h,blobVersionedHashes:d}=this;return{_type:"TransactionResponse",accessList:h,blockNumber:t,blockHash:e,blobVersionedHashes:d,chainId:z(this.chainId),data:f,from:o,gasLimit:z(this.gasLimit),gasPrice:z(this.gasPrice),hash:s,maxFeePerGas:z(this.maxFeePerGas),maxPriorityFeePerGas:z(this.maxPriorityFeePerGas),maxFeePerBlobGas:z(this.maxFeePerBlobGas),nonce:c,signature:u,to:a,index:n,type:i,value:z(this.value)}}async getBlock(){let t=this.blockNumber;if(t==null){const n=await this.getTransaction();n&&(t=n.blockNumber)}if(t==null)return null;const e=this.provider.getBlock(t);if(e==null)throw new Error("TODO");return e}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:e,blockNumber:n}=await Y({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return e==null||e.blockNumber==null?0:n-e.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(t,e){const n=t??1,s=e??0;let i=this.#t,a=-1,o=i===-1;const c=async()=>{if(o)return null;const{blockNumber:d,nonce:m}=await Y({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(m<this.nonce){i=d;return}if(o)return null;const P=await this.getTransaction();if(!(P&&P.blockNumber!=null))for(a===-1&&(a=i-3,a<this.#t&&(a=this.#t));a<=d;){if(o)return null;const k=await this.provider.getBlock(a,!0);if(k==null)return;for(const R of k)if(R===this.hash)return;for(let R=0;R<k.length;R++){const v=await k.getTransaction(R);if(v.from===this.from&&v.nonce===this.nonce){if(o)return null;const K=await this.provider.getTransactionReceipt(v.hash);if(K==null||d-K.blockNumber+1<n)return;let wt="replaced";v.data===this.data&&v.to===this.to&&v.value===this.value?wt="repriced":v.data==="0x"&&v.from===v.to&&v.value===Ei&&(wt="cancelled"),p(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:wt==="replaced"||wt==="cancelled",reason:wt,replacement:v.replaceableTransaction(i),hash:v.hash,receipt:K})}}a++}},f=d=>{if(d==null||d.status!==0)return d;p(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:d.to,from:d.from,data:""},receipt:d})},u=await this.provider.getTransactionReceipt(this.hash);if(n===0)return f(u);if(u){if(n===1||await u.confirmations()>=n)return f(u)}else if(await c(),n===0)return null;return await new Promise((d,m)=>{const P=[],k=()=>{P.forEach(v=>v())};if(P.push(()=>{o=!0}),s>0){const v=setTimeout(()=>{k(),m(F("wait for transaction timeout","TIMEOUT"))},s);P.push(()=>{clearTimeout(v)})}const R=async v=>{if(await v.confirmations()>=n){k();try{d(f(v))}catch(K){m(K)}}};if(P.push(()=>{this.provider.off(this.hash,R)}),this.provider.on(this.hash,R),i>=0){const v=async()=>{try{await c()}catch(K){if(j(K,"TRANSACTION_REPLACED")){k(),m(K);return}}o||this.provider.once("block",v)};P.push(()=>{this.provider.off("block",v)}),this.provider.once("block",v)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return p(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Ni(this)}reorderedEvent(t){return p(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),p(!t||t.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),ki(this,t)}replaceableTransaction(t){l(Number.isInteger(t)&&t>=0,"invalid startBlock","startBlock",t);const e=new Be(this,this.provider);return e.#t=t,e}}function tc(r){return{orphan:"drop-block",hash:r.hash,number:r.number}}function ki(r,t){return{orphan:"reorder-transaction",tx:r,other:t}}function Ni(r){return{orphan:"drop-transaction",tx:r}}function ec(r){return{orphan:"drop-log",log:{transactionHash:r.transactionHash,blockHash:r.blockHash,blockNumber:r.blockNumber,address:r.address,data:r.data,topics:Object.freeze(r.topics.slice()),index:r.index}}}class er extends Fe{interface;fragment;args;constructor(t,e,n){super(t,t.provider);const s=e.decodeEventLog(n,t.data,t.topics);E(this,{args:s,fragment:n,interface:e})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class vi extends Fe{error;constructor(t,e){super(t,t.provider),E(this,{error:e})}}class nc extends Pi{#t;constructor(t,e,n){super(n,e),this.#t=t}get logs(){return super.logs.map(t=>{const e=t.topics.length?this.#t.getEvent(t.topics[0]):null;if(e)try{return new er(t,this.#t,e)}catch(n){return new vi(t,n)}return t})}}class nr extends Be{#t;constructor(t,e,n){super(n,e),this.#t=t}async wait(t,e){const n=await super.wait(t,e);return n==null?null:new nc(this.#t,this.provider,n)}}class Ai extends ks{log;constructor(t,e,n,s){super(t,e,n),E(this,{log:s})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class rc extends Ai{constructor(t,e,n,s,i){super(t,e,n,new er(i,t.interface,s));const a=t.interface.decodeEventLog(s,this.log.data,this.log.topics);E(this,{args:a,fragment:s})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const Qr=BigInt(0);function Ti(r){return r&&typeof r.call=="function"}function xi(r){return r&&typeof r.estimateGas=="function"}function pn(r){return r&&typeof r.resolveName=="function"}function Ii(r){return r&&typeof r.sendTransaction=="function"}function Ri(r){if(r!=null){if(pn(r))return r;if(r.provider)return r.provider}}class sc{#t;fragment;constructor(t,e,n){if(E(this,{fragment:e}),e.inputs.length<n.length)throw new Error("too many arguments");const s=Qt(t.runner,"resolveName"),i=pn(s)?s:null;this.#t=async function(){const a=await Promise.all(e.inputs.map((o,c)=>n[c]==null?null:o.walkAsync(n[c],(u,h)=>u==="address"?Array.isArray(h)?Promise.all(h.map(d=>H(d,i))):H(h,i):h)));return t.interface.encodeFilterTopics(e,a)}()}getTopicFilter(){return this.#t}}function Qt(r,t){return r==null?null:typeof r[t]=="function"?r:r.provider&&typeof r.provider[t]=="function"?r.provider:null}function Xt(r){return r==null?null:r.provider||null}async function rr(r,t){const e=$.dereference(r,"overrides");l(typeof e=="object","invalid overrides parameter","overrides",r);const n=Re(e);return l(n.to==null||(t||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),l(n.data==null||(t||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}async function Oi(r,t,e){const n=Qt(r,"resolveName"),s=pn(n)?n:null;return await Promise.all(t.map((i,a)=>i.walkAsync(e[a],(o,c)=>(c=$.dereference(c,o),o==="address"?H(c,s):c))))}function ic(r){const t=async function(a){const o=await rr(a,["data"]);o.to=await r.getAddress(),o.from&&(o.from=await H(o.from,Ri(r.runner)));const c=r.interface,f=b(o.value||Qr,"overrides.value")===Qr,u=(o.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!u&&!f&&l(!1,"cannot send data to receive or send value to non-payable fallback","overrides",a),l(c.fallback||u,"cannot send data to receive-only contract","overrides.data",o.data);const h=c.receive||c.fallback&&c.fallback.payable;return l(h||f,"cannot send value to non-payable fallback","overrides.value",o.value),l(c.fallback||u,"cannot send data to receive-only contract","overrides.data",o.data),o},e=async function(a){const o=Qt(r.runner,"call");p(Ti(o),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await t(a);try{return await o.call(c)}catch(f){throw Qn(f)&&f.data?r.interface.makeError(f.data,c):f}},n=async function(a){const o=r.runner;p(Ii(o),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await o.sendTransaction(await t(a)),f=Xt(r.runner);return new nr(r.interface,f,c)},s=async function(a){const o=Qt(r.runner,"estimateGas");return p(xi(o),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await o.estimateGas(await t(a))},i=async a=>await n(a);return E(i,{_contract:r,estimateGas:s,populateTransaction:t,send:n,staticCall:e}),i}function ac(r,t){const e=function(...f){const u=r.interface.getFunction(t,f);return p(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t,args:f}}),u},n=async function(...f){const u=e(...f);let h={};if(u.inputs.length+1===f.length&&(h=await rr(f.pop()),h.from&&(h.from=await H(h.from,Ri(r.runner)))),u.inputs.length!==f.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const d=await Oi(r.runner,u.inputs,f);return Object.assign({},h,await Y({to:r.getAddress(),data:r.interface.encodeFunctionData(u,d)}))},s=async function(...f){const u=await o(...f);return u.length===1?u[0]:u},i=async function(...f){const u=r.runner;p(Ii(u),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const h=await u.sendTransaction(await n(...f)),d=Xt(r.runner);return new nr(r.interface,d,h)},a=async function(...f){const u=Qt(r.runner,"estimateGas");return p(xi(u),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await u.estimateGas(await n(...f))},o=async function(...f){const u=Qt(r.runner,"call");p(Ti(u),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const h=await n(...f);let d="0x";try{d=await u.call(h)}catch(P){throw Qn(P)&&P.data?r.interface.makeError(P.data,h):P}const m=e(...f);return r.interface.decodeFunctionResult(m,d)},c=async(...f)=>e(...f).constant?await s(...f):await i(...f);return E(c,{name:r.interface.getFunctionName(t),_contract:r,_key:t,getFragment:e,estimateGas:a,populateTransaction:n,send:i,staticCall:s,staticCallResult:o}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{const f=r.interface.getFunction(t);return p(f,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t}}),f}}),c}function oc(r,t){const e=function(...s){const i=r.interface.getEvent(t,s);return p(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t,args:s}}),i},n=function(...s){return new sc(r,e(...s),s)};return E(n,{name:r.interface.getEventName(t),_contract:r,_key:t,getFragment:e}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const s=r.interface.getEvent(t);return p(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:t}}),s}}),n}const en=Symbol.for("_ethersInternal_contract"),Si=new WeakMap;function cc(r,t){Si.set(r[en],t)}function it(r){return Si.get(r[en])}function fc(r){return r&&typeof r=="object"&&"getTopicFilter"in r&&typeof r.getTopicFilter=="function"&&r.fragment}async function sr(r,t){let e,n=null;if(Array.isArray(t)){const i=function(a){if(U(a,32))return a;const o=r.interface.getEvent(a);return l(o,"unknown fragment","name",a),o.topicHash};e=t.map(a=>a==null?null:Array.isArray(a)?a.map(i):i(a))}else t==="*"?e=[null]:typeof t=="string"?U(t,32)?e=[t]:(n=r.interface.getEvent(t),l(n,"unknown fragment","event",t),e=[n.topicHash]):fc(t)?e=await t.getTopicFilter():"fragment"in t?(n=t.fragment,e=[n.topicHash]):l(!1,"unknown event name","event",t);e=e.map(i=>{if(i==null)return null;if(Array.isArray(i)){const a=Array.from(new Set(i.map(o=>o.toLowerCase())).values());return a.length===1?a[0]:(a.sort(),a)}return i.toLowerCase()});const s=e.map(i=>i==null?"null":Array.isArray(i)?i.join("|"):i).join("&");return{fragment:n,tag:s,topics:e}}async function Te(r,t){const{subs:e}=it(r);return e.get((await sr(r,t)).tag)||null}async function qr(r,t,e){const n=Xt(r.runner);p(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:t});const{fragment:s,tag:i,topics:a}=await sr(r,e),{addr:o,subs:c}=it(r);let f=c.get(i);if(!f){const h={address:o||r,topics:a},d=R=>{let v=s;if(v==null)try{v=r.interface.getEvent(R.topics[0])}catch{}if(v){const K=v,wt=s?r.interface.decodeEventLog(s,R.data,R.topics):[];Vn(r,e,wt,bn=>new rc(r,bn,e,K,R))}else Vn(r,e,[],K=>new Ai(r,K,e,R))};let m=[];f={tag:i,listeners:[],start:()=>{m.length||m.push(n.on(h,d))},stop:async()=>{if(m.length==0)return;let R=m;m=[],await Promise.all(R),n.off(h,d)}},c.set(i,f)}return f}let zn=Promise.resolve();async function lc(r,t,e,n){await zn;const s=await Te(r,t);if(!s)return!1;const i=s.listeners.length;return s.listeners=s.listeners.filter(({listener:a,once:o})=>{const c=Array.from(e);n&&c.push(n(o?null:a));try{a.call(r,...c)}catch{}return!o}),s.listeners.length===0&&(s.stop(),it(r).subs.delete(s.tag)),i>0}async function Vn(r,t,e,n){try{await zn}catch{}const s=lc(r,t,e,n);return zn=s,await s}const Je=["then"];class jt{target;interface;runner;filters;[en];fallback;constructor(t,e,n,s){l(typeof t=="string"||ni(t),"invalid value for Contract target","target",t),n==null&&(n=null);const i=Lt.from(e);E(this,{target:t,runner:n,interface:i}),Object.defineProperty(this,en,{value:{}});let a,o=null,c=null;if(s){const h=Xt(n);c=new nr(this.interface,h,s)}let f=new Map;if(typeof t=="string")if(U(t))o=t,a=Promise.resolve(t);else{const h=Qt(n,"resolveName");if(!pn(h))throw F("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});a=h.resolveName(t).then(d=>{if(d==null)throw F("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:t});return it(this).addr=d,d})}else a=t.getAddress().then(h=>{if(h==null)throw new Error("TODO");return it(this).addr=h,h});cc(this,{addrPromise:a,addr:o,deployTx:c,subs:f});const u=new Proxy({},{get:(h,d,m)=>{if(typeof d=="symbol"||Je.indexOf(d)>=0)return Reflect.get(h,d,m);try{return this.getEvent(d)}catch(P){if(!j(P,"INVALID_ARGUMENT")||P.argument!=="key")throw P}},has:(h,d)=>Je.indexOf(d)>=0?Reflect.has(h,d):Reflect.has(h,d)||this.interface.hasEvent(String(d))});return E(this,{filters:u}),E(this,{fallback:i.receive||i.fallback?ic(this):null}),new Proxy(this,{get:(h,d,m)=>{if(typeof d=="symbol"||d in h||Je.indexOf(d)>=0)return Reflect.get(h,d,m);try{return h.getFunction(d)}catch(P){if(!j(P,"INVALID_ARGUMENT")||P.argument!=="key")throw P}},has:(h,d)=>typeof d=="symbol"||d in h||Je.indexOf(d)>=0?Reflect.has(h,d):h.interface.hasFunction(d)})}connect(t){return new jt(this.target,this.interface,t)}attach(t){return new jt(t,this.interface,this.runner)}async getAddress(){return await it(this).addrPromise}async getDeployedCode(){const t=Xt(this.runner);p(t,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const e=await t.getCode(await this.getAddress());return e==="0x"?null:e}async waitForDeployment(){const t=this.deploymentTransaction();if(t)return await t.wait(),this;if(await this.getDeployedCode()!=null)return this;const n=Xt(this.runner);return p(n!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((s,i)=>{const a=async()=>{try{if(await this.getDeployedCode()!=null)return s(this);n.once("block",a)}catch(o){i(o)}};a()})}deploymentTransaction(){return it(this).deployTx}getFunction(t){return typeof t!="string"&&(t=t.format()),ac(this,t)}getEvent(t){return typeof t!="string"&&(t=t.format()),oc(this,t)}async queryTransaction(t){throw new Error("@TODO")}async queryFilter(t,e,n){e==null&&(e=0),n==null&&(n="latest");const{addr:s,addrPromise:i}=it(this),a=s||await i,{fragment:o,topics:c}=await sr(this,t),f={address:a,topics:c,fromBlock:e,toBlock:n},u=Xt(this.runner);return p(u,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await u.getLogs(f)).map(h=>{let d=o;if(d==null)try{d=this.interface.getEvent(h.topics[0])}catch{}if(d)try{return new er(h,this.interface,d)}catch(m){return new vi(h,m)}return new Fe(h,u)})}async on(t,e){const n=await qr(this,"on",t);return n.listeners.push({listener:e,once:!1}),n.start(),this}async once(t,e){const n=await qr(this,"once",t);return n.listeners.push({listener:e,once:!0}),n.start(),this}async emit(t,...e){return await Vn(this,t,e,null)}async listenerCount(t){if(t){const s=await Te(this,t);return s?s.listeners.length:0}const{subs:e}=it(this);let n=0;for(const{listeners:s}of e.values())n+=s.length;return n}async listeners(t){if(t){const s=await Te(this,t);return s?s.listeners.map(({listener:i})=>i):[]}const{subs:e}=it(this);let n=[];for(const{listeners:s}of e.values())n=n.concat(s.map(({listener:i})=>i));return n}async off(t,e){const n=await Te(this,t);if(!n)return this;if(e){const s=n.listeners.map(({listener:i})=>i).indexOf(e);s>=0&&n.listeners.splice(s,1)}return(e==null||n.listeners.length===0)&&(n.stop(),it(this).subs.delete(n.tag)),this}async removeAllListeners(t){if(t){const e=await Te(this,t);if(!e)return this;e.stop(),it(this).subs.delete(e.tag)}else{const{subs:e}=it(this);for(const{tag:n,stop:s}of e.values())s(),e.delete(n)}return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return await this.off(t,e)}static buildClass(t){class e extends jt{constructor(s,i=null){super(s,t,i)}}return e}static from(t,e,n){return n==null&&(n=null),new this(t,e,n)}}function uc(){return jt}class X extends uc(){}class ir{interface;bytecode;runner;constructor(t,e,n){const s=Lt.from(t);e instanceof Uint8Array||(typeof e=="object"&&(e=e.object),e.startsWith("0x")||(e="0x"+e)),e=g(y(e)),E(this,{bytecode:e,interface:s,runner:n||null})}attach(t){return new jt(t,this.interface,this.runner)}async getDeployTransaction(...t){let e={};const n=this.interface.deploy;if(n.inputs.length+1===t.length&&(e=await rr(t.pop())),n.inputs.length!==t.length)throw new Error("incorrect number of arguments to constructor");const s=await Oi(this.runner,n.inputs,t),i=O([this.bytecode,this.interface.encodeDeploy(s)]);return Object.assign({},e,{data:i})}async deploy(...t){const e=await this.getDeployTransaction(...t);p(this.runner&&typeof this.runner.sendTransaction=="function","factory runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const n=await this.runner.sendTransaction(e),s=ei(n);return new jt(s,this.interface,this.runner,n)}connect(t){return new ir(this.interface,this.bytecode,t)}static fromSolidity(t,e){l(t!=null,"bad compiler output","output",t),typeof t=="string"&&(t=JSON.parse(t));const n=t.abi;let s="";return t.bytecode?s=t.bytecode:t.evm&&t.evm.bytecode&&(s=t.evm.bytecode),new this(n,s,e)}}function xn(r){return r.match(/^ipfs:\/\/ipfs\//i)?r=r.substring(12):r.match(/^ipfs:\/\//i)?r=r.substring(7):l(!1,"unsupported IPFS format","link",r),`https://gateway.ipfs.io/ipfs/${r}`}class hc{name;constructor(t){E(this,{name:t})}connect(t){return this}supportsCoinType(t){return!1}async encodeAddress(t,e){throw new Error("unsupported coin")}async decodeAddress(t,e){throw new Error("unsupported coin")}}const Ci=new RegExp("^(ipfs)://(.*)$","i"),ts=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),Ci,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];class pe{provider;address;name;#t;#e;constructor(t,e,n){E(this,{provider:t,address:e,name:n}),this.#t=null,this.#e=new X(e,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],t)}async supportsWildcard(){return this.#t==null&&(this.#t=(async()=>{try{return await this.#e.supportsInterface("0x9061b923")}catch(t){if(j(t,"CALL_EXCEPTION"))return!1;throw this.#t=null,t}})()),await this.#t}async#n(t,e){e=(e||[]).slice();const n=this.#e.interface;e.unshift(Gn(this.name));let s=null;await this.supportsWildcard()&&(s=n.getFunction(t),p(s,"missing fragment","UNKNOWN_ERROR",{info:{funcName:t}}),e=[xo(this.name,255),n.encodeFunctionData(s,e)],t="resolve(bytes,bytes)"),e.push({enableCcipRead:!0});try{const i=await this.#e[t](...e);return s?n.decodeFunctionResult(s,i)[0]:i}catch(i){if(!j(i,"CALL_EXCEPTION"))throw i}return null}async getAddress(t){if(t==null&&(t=60),t===60)try{const i=await this.#n("addr(bytes32)");return i==null||i===xe?null:i}catch(i){if(j(i,"CALL_EXCEPTION"))return null;throw i}if(t>=0&&t<2147483648){let i=t+2147483648;const a=await this.#n("addr(bytes32,uint)",[i]);if(U(a,20))return x(a)}let e=null;for(const i of this.provider.plugins)if(i instanceof hc&&i.supportsCoinType(t)){e=i;break}if(e==null)return null;const n=await this.#n("addr(bytes32,uint)",[t]);if(n==null||n==="0x")return null;const s=await e.decodeAddress(t,n);if(s!=null)return s;p(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${t})`,info:{coinType:t,data:n}})}async getText(t){const e=await this.#n("text(bytes32,string)",[t]);return e==null||e==="0x"?null:e}async getContentHash(){const t=await this.#n("contenthash(bytes32)");if(t==null||t==="0x")return null;const e=t.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(e){const s=e[1]==="e3010170"?"ipfs":"ipns",i=parseInt(e[4],16);if(e[5].length===i*2)return`${s}://${Ps("0x"+e[2])}`}const n=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(n&&n[1].length===64)return`bzz://${n[1]}`;p(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:t}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const t=[{type:"name",value:this.name}];try{const e=await this.getText("avatar");if(e==null)return t.push({type:"!avatar",value:""}),{url:null,linkage:t};t.push({type:"avatar",value:e});for(let n=0;n<ts.length;n++){const s=e.match(ts[n]);if(s==null)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return t.push({type:"url",value:e}),{linkage:t,url:e};case"ipfs":{const a=xn(e);return t.push({type:"ipfs",value:e}),t.push({type:"url",value:a}),{linkage:t,url:a}}case"erc721":case"erc1155":{const a=i==="erc721"?"tokenURI(uint256)":"uri(uint256)";t.push({type:i,value:e});const o=await this.getAddress();if(o==null)return t.push({type:"!owner",value:""}),{url:null,linkage:t};const c=(s[2]||"").split("/");if(c.length!==2)return t.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:t};const f=c[1],u=new X(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(i==="erc721"){const k=await u.ownerOf(f);if(o!==k)return t.push({type:"!owner",value:k}),{url:null,linkage:t};t.push({type:"owner",value:k})}else if(i==="erc1155"){const k=await u.balanceOf(o,f);if(!k)return t.push({type:"!balance",value:"0"}),{url:null,linkage:t};t.push({type:"balance",value:k.toString()})}let h=await u[a](f);if(h==null||h==="0x")return t.push({type:"!metadata-url",value:""}),{url:null,linkage:t};t.push({type:"metadata-url-base",value:h}),i==="erc1155"&&(h=h.replace("{id}",It(f,32).substring(2)),t.push({type:"metadata-url-expanded",value:h})),h.match(/^ipfs:/i)&&(h=xn(h)),t.push({type:"metadata-url",value:h});let d={};const m=await new Rt(h).send();m.assertOk();try{d=m.bodyJson}catch{try{t.push({type:"!metadata",value:m.bodyText})}catch{const v=m.body;return v&&t.push({type:"!metadata",value:g(v)}),{url:null,linkage:t}}return{url:null,linkage:t}}if(!d)return t.push({type:"!metadata",value:""}),{url:null,linkage:t};t.push({type:"metadata",value:JSON.stringify(d)});let P=d.image;if(typeof P!="string")return t.push({type:"!imageUrl",value:""}),{url:null,linkage:t};if(!P.match(/^(https:\/\/|data:)/i)){if(P.match(Ci)==null)return t.push({type:"!imageUrl-ipfs",value:P}),{url:null,linkage:t};t.push({type:"imageUrl-ipfs",value:P}),P=xn(P)}return t.push({type:"url",value:P}),{linkage:t,url:P}}}}}catch{}return{linkage:t,url:null}}static async getEnsAddress(t){const e=await t.getNetwork(),n=e.getPlugin("org.ethers.plugins.network.Ens");return p(n,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:e}}),n.address}static async#r(t,e){const n=await pe.getEnsAddress(t);try{const i=await new X(n,["function resolver(bytes32) view returns (address)"],t).resolver(Gn(e),{enableCcipRead:!0});return i===xe?null:i}catch(s){throw s}return null}static async fromName(t,e){let n=e;for(;;){if(n===""||n==="."||e!=="eth"&&n==="eth")return null;const s=await pe.#r(t,n);if(s!=null){const i=new pe(t,s,e);return n!==e&&!await i.supportsWildcard()?null:i}n=n.split(".").slice(1).join(".")}}}const es=BigInt(0);function A(r,t){return function(e){return e==null?t:r(e)}}function Oe(r,t){return e=>{if(t&&e==null)return null;if(!Array.isArray(e))throw new Error("not an array");return e.map(n=>r(n))}}function _e(r,t){return e=>{const n={};for(const s in r){let i=s;if(t&&s in t&&!(i in e)){for(const a of t[s])if(a in e){i=a;break}}try{const a=r[s](e[i]);a!==void 0&&(n[s]=a)}catch(a){const o=a instanceof Error?a.message:"not-an-error";p(!1,`invalid value for value.${s} (${o})`,"BAD_DATA",{value:e})}}return n}}function dc(r){switch(r){case!0:case"true":return!0;case!1:case"false":return!1}l(!1,`invalid boolean; ${JSON.stringify(r)}`,"value",r)}function me(r){return l(U(r,!0),"invalid data","value",r),r}function W(r){return l(U(r,32),"invalid hash","value",r),r}const pc=_e({address:x,blockHash:W,blockNumber:N,data:me,index:N,removed:A(dc,!1),topics:Oe(W),transactionHash:W,transactionIndex:N},{index:["logIndex"]});function gc(r){return pc(r)}const mc=_e({hash:A(W),parentHash:W,parentBeaconBlockRoot:A(W,null),number:N,timestamp:N,nonce:A(me),difficulty:b,gasLimit:b,gasUsed:b,stateRoot:A(W,null),receiptsRoot:A(W,null),blobGasUsed:A(b,null),excessBlobGas:A(b,null),miner:A(x),prevRandao:A(W,null),extraData:me,baseFeePerGas:A(b)},{prevRandao:["mixHash"]});function yc(r){const t=mc(r);return t.transactions=r.transactions.map(e=>typeof e=="string"?e:Ui(e)),t}const bc=_e({transactionIndex:N,blockNumber:N,transactionHash:W,address:x,topics:Oe(W),data:me,index:N,blockHash:W},{index:["logIndex"]});function wc(r){return bc(r)}const Ec=_e({to:A(x,null),from:A(x,null),contractAddress:A(x,null),index:N,root:A(g),gasUsed:b,blobGasUsed:A(b,null),logsBloom:A(me),blockHash:W,hash:W,logs:Oe(wc),blockNumber:N,cumulativeGasUsed:b,effectiveGasPrice:A(b),blobGasPrice:A(b,null),status:A(N),type:A(N,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function Pc(r){return Ec(r)}function Ui(r){r.to&&b(r.to)===es&&(r.to="0x0000000000000000000000000000000000000000");const t=_e({hash:W,index:A(N,void 0),type:e=>e==="0x"||e==null?0:N(e),accessList:A(te,null),blobVersionedHashes:A(Oe(W,!0),null),authorizationList:A(Oe(e=>{let n;if(e.signature)n=e.signature;else{let s=e.yParity;s==="0x1b"?s=0:s==="0x1c"&&(s=1),n=Object.assign({},e,{yParity:s})}return{address:x(e.address),chainId:b(e.chainId),nonce:b(e.nonce),signature:D.from(n)}},!1),null),blockHash:A(W,null),blockNumber:A(N,null),transactionIndex:A(N,null),from:x,gasPrice:A(b),maxPriorityFeePerGas:A(b),maxFeePerGas:A(b),maxFeePerBlobGas:A(b,null),gasLimit:b,to:A(x,null),value:b,nonce:N,data:me,creates:A(x,null),chainId:A(b,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(r);if(t.to==null&&t.creates==null&&(t.creates=ei(t)),(r.type===1||r.type===2)&&r.accessList==null&&(t.accessList=[]),r.signature?t.signature=D.from(r.signature):t.signature=D.from(r),t.chainId==null){const e=t.signature.legacyChainId;e!=null&&(t.chainId=e)}return t.blockHash&&b(t.blockHash)===es&&(t.blockHash=null),t}const kc="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class De{name;constructor(t){E(this,{name:t})}clone(){return new De(this.name)}}class gn extends De{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(t,e){t==null&&(t=0),super(`org.ethers.network.plugins.GasCost#${t||0}`);const n={effectiveBlock:t};function s(i,a){let o=(e||{})[i];o==null&&(o=a),l(typeof o=="number",`invalud value for ${i}`,"costs",e),n[i]=o}s("txBase",21e3),s("txCreate",32e3),s("txDataZero",4),s("txDataNonzero",16),s("txAccessListStorageKey",1900),s("txAccessListAddress",2400),E(this,n)}clone(){return new gn(this.effectiveBlock,this)}}class mn extends De{address;targetNetwork;constructor(t,e){super("org.ethers.plugins.network.Ens"),E(this,{address:t||kc,targetNetwork:e??1})}clone(){return new mn(this.address,this.targetNetwork)}}class Nc extends De{#t;#e;get url(){return this.#t}get processFunc(){return this.#e}constructor(t,e){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#t=t,this.#e=e}clone(){return this}}const In=new Map;class at{#t;#e;#n;constructor(t,e){this.#t=t,this.#e=b(e),this.#n=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#t}set name(t){this.#t=t}get chainId(){return this.#e}set chainId(t){this.#e=b(t,"chainId")}matches(t){if(t==null)return!1;if(typeof t=="string"){try{return this.chainId===b(t)}catch{}return this.name===t}if(typeof t=="number"||typeof t=="bigint"){try{return this.chainId===b(t)}catch{}return!1}if(typeof t=="object"){if(t.chainId!=null){try{return this.chainId===b(t.chainId)}catch{}return!1}return t.name!=null?this.name===t.name:!1}return!1}get plugins(){return Array.from(this.#n.values())}attachPlugin(t){if(this.#n.get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return this.#n.set(t.name,t.clone()),this}getPlugin(t){return this.#n.get(t)||null}getPlugins(t){return this.plugins.filter(e=>e.name.split("#")[0]===t)}clone(){const t=new at(this.name,this.chainId);return this.plugins.forEach(e=>{t.attachPlugin(e.clone())}),t}computeIntrinsicGas(t){const e=this.getPlugin("org.ethers.plugins.network.GasCost")||new gn;let n=e.txBase;if(t.to==null&&(n+=e.txCreate),t.data)for(let s=2;s<t.data.length;s+=2)t.data.substring(s,s+2)==="00"?n+=e.txDataZero:n+=e.txDataNonzero;if(t.accessList){const s=te(t.accessList);for(const i in s)n+=e.txAccessListAddress+e.txAccessListStorageKey*s[i].storageKeys.length}return n}static from(t){if(vc(),t==null)return at.from("mainnet");if(typeof t=="number"&&(t=BigInt(t)),typeof t=="string"||typeof t=="bigint"){const e=In.get(t);if(e)return e();if(typeof t=="bigint")return new at("unknown",t);l(!1,"unknown network","network",t)}if(typeof t.clone=="function")return t.clone();if(typeof t=="object"){l(typeof t.name=="string"&&typeof t.chainId=="number","invalid network object name or chainId","network",t);const e=new at(t.name,t.chainId);return(t.ensAddress||t.ensNetwork!=null)&&e.attachPlugin(new mn(t.ensAddress,t.ensNetwork)),e}l(!1,"invalid network","network",t)}static register(t,e){typeof t=="number"&&(t=BigInt(t));const n=In.get(t);n&&l(!1,`conflicting network for ${JSON.stringify(n.name)}`,"nameOrChainId",t),In.set(t,e)}}function ns(r,t){const e=String(r);if(!e.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${r}`);const n=e.split(".");if(n.length===1&&n.push(""),n.length!==2)throw new Error(`invalid gwei value: ${r}`);for(;n[1].length<t;)n[1]+="0";if(n[1].length>9){let s=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||s++,n[1]=s.toString()}return BigInt(n[0]+n[1])}function rs(r){return new Nc(r,async(t,e,n)=>{n.setHeader("User-Agent","ethers");let s;try{const[i,a]=await Promise.all([n.send(),t()]);s=i;const o=s.bodyJson.standard;return{gasPrice:a.gasPrice,maxFeePerGas:ns(o.maxFee,9),maxPriorityFeePerGas:ns(o.maxPriorityFee,9)}}catch(i){p(!1,`error encountered with polygon gas station (${JSON.stringify(n.url)})`,"SERVER_ERROR",{request:n,response:s,error:i})}})}let ss=!1;function vc(){if(ss)return;ss=!0;function r(t,e,n){const s=function(){const i=new at(t,e);return n.ensNetwork!=null&&i.attachPlugin(new mn(null,n.ensNetwork)),i.attachPlugin(new gn),(n.plugins||[]).forEach(a=>{i.attachPlugin(a)}),i};at.register(t,s),at.register(e,s),n.altNames&&n.altNames.forEach(i=>{at.register(i,s)})}r("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),r("ropsten",3,{ensNetwork:3}),r("rinkeby",4,{ensNetwork:4}),r("goerli",5,{ensNetwork:5}),r("kovan",42,{ensNetwork:42}),r("sepolia",11155111,{ensNetwork:11155111}),r("holesky",17e3,{ensNetwork:17e3}),r("classic",61,{}),r("classicKotti",6,{}),r("arbitrum",42161,{ensNetwork:1}),r("arbitrum-goerli",421613,{}),r("arbitrum-sepolia",421614,{}),r("base",8453,{ensNetwork:1}),r("base-goerli",84531,{}),r("base-sepolia",84532,{}),r("bnb",56,{ensNetwork:1}),r("bnbt",97,{}),r("linea",59144,{ensNetwork:1}),r("linea-goerli",59140,{}),r("linea-sepolia",59141,{}),r("matic",137,{ensNetwork:1,plugins:[rs("https://gasstation.polygon.technology/v2")]}),r("matic-amoy",80002,{}),r("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[rs("https://gasstation-testnet.polygon.technology/v2")]}),r("optimism",10,{ensNetwork:1,plugins:[]}),r("optimism-goerli",420,{}),r("optimism-sepolia",11155420,{}),r("xdai",100,{ensNetwork:1})}function Hn(r){return JSON.parse(JSON.stringify(r))}class Ac{#t;#e;#n;#r;constructor(t){this.#t=t,this.#e=null,this.#n=4e3,this.#r=-2}get pollingInterval(){return this.#n}set pollingInterval(t){this.#n=t}async#s(){try{const t=await this.#t.getBlockNumber();if(this.#r===-2){this.#r=t;return}if(t!==this.#r){for(let e=this.#r+1;e<=t;e++){if(this.#e==null)return;await this.#t.emit("block",e)}this.#r=t}}catch{}this.#e!=null&&(this.#e=this.#t._setTimeout(this.#s.bind(this),this.#n))}start(){this.#e||(this.#e=this.#t._setTimeout(this.#s.bind(this),this.#n),this.#s())}stop(){this.#e&&(this.#t._clearTimeout(this.#e),this.#e=null)}pause(t){this.stop(),t&&(this.#r=-2)}resume(){this.start()}}class ar{#t;#e;#n;constructor(t){this.#t=t,this.#n=!1,this.#e=e=>{this._poll(e,this.#t)}}async _poll(t,e){throw new Error("sub-classes must override this")}start(){this.#n||(this.#n=!0,this.#e(-2),this.#t.on("block",this.#e))}stop(){this.#n&&(this.#n=!1,this.#t.off("block",this.#e))}pause(t){this.stop()}resume(){this.start()}}class Tc extends ar{#t;#e;constructor(t,e){super(t),this.#t=e,this.#e=-2}pause(t){t&&(this.#e=-2),super.pause(t)}async _poll(t,e){const n=await e.getBlock(this.#t);n!=null&&(this.#e===-2?this.#e=n.number:n.number>this.#e&&(e.emit(this.#t,n.number),this.#e=n.number))}}class xc extends ar{#t;constructor(t,e){super(t),this.#t=Hn(e)}async _poll(t,e){throw new Error("@TODO")}}class Ic extends ar{#t;constructor(t,e){super(t),this.#t=e}async _poll(t,e){const n=await e.getTransactionReceipt(this.#t);n&&e.emit(this.#t,n)}}class or{#t;#e;#n;#r;#s;constructor(t,e){this.#t=t,this.#e=Hn(e),this.#n=this.#a.bind(this),this.#r=!1,this.#s=-2}async#a(t){if(this.#s===-2)return;const e=Hn(this.#e);e.fromBlock=this.#s+1,e.toBlock=t;const n=await this.#t.getLogs(e);if(n.length===0){this.#s<t-60&&(this.#s=t-60);return}for(const s of n)this.#t.emit(this.#e,s),this.#s=s.blockNumber}start(){this.#r||(this.#r=!0,this.#s===-2&&this.#t.getBlockNumber().then(t=>{this.#s=t}),this.#t.on("block",this.#n))}stop(){this.#r&&(this.#r=!1,this.#t.off("block",this.#n))}pause(t){this.stop(),t&&(this.#s=-2)}resume(){this.start()}}const Rc=BigInt(2),Oc=10;function We(r){return r&&typeof r.then=="function"}function je(r,t){return r+":"+JSON.stringify(t,(e,n)=>{if(n==null)return"null";if(typeof n=="bigint")return`bigint:${n.toString()}`;if(typeof n=="string")return n.toLowerCase();if(typeof n=="object"&&!Array.isArray(n)){const s=Object.keys(n);return s.sort(),s.reduce((i,a)=>(i[a]=n[a],i),{})}return n})}class Li{name;constructor(t){E(this,{name:t})}start(){}stop(){}pause(t){}resume(){}}function Sc(r){return JSON.parse(JSON.stringify(r))}function Kn(r){return r=Array.from(new Set(r).values()),r.sort(),r}async function Rn(r,t){if(r==null)throw new Error("invalid event");if(Array.isArray(r)&&(r={topics:r}),typeof r=="string")switch(r){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:r,tag:r}}if(U(r,32)){const e=r.toLowerCase();return{type:"transaction",tag:je("tx",{hash:e}),hash:e}}if(r.orphan){const e=r;return{type:"orphan",tag:je("orphan",e),filter:Sc(e)}}if(r.address||r.topics){const e=r,n={topics:(e.topics||[]).map(s=>s==null?null:Array.isArray(s)?Kn(s.map(i=>i.toLowerCase())):s.toLowerCase())};if(e.address){const s=[],i=[],a=o=>{U(o)?s.push(o):i.push((async()=>{s.push(await H(o,t))})())};Array.isArray(e.address)?e.address.forEach(a):a(e.address),i.length&&await Promise.all(i),n.address=Kn(s.map(o=>o.toLowerCase()))}return{filter:n,tag:je("event",n),type:"event"}}l(!1,"unknown ProviderEvent","event",r)}function On(){return new Date().getTime()}const Cc={cacheTimeout:250,pollingInterval:4e3};class Uc{#t;#e;#n;#r;#s;#a;#i;#o;#u;#f;#p;#g;constructor(t,e){if(this.#g=Object.assign({},Cc,e||{}),t==="any")this.#a=!0,this.#s=null;else if(t){const n=at.from(t);this.#a=!1,this.#s=Promise.resolve(n),setTimeout(()=>{this.emit("network",n,null)},0)}else this.#a=!1,this.#s=null;this.#o=-1,this.#i=new Map,this.#t=new Map,this.#e=new Map,this.#n=null,this.#r=!1,this.#u=1,this.#f=new Map,this.#p=!1}get pollingInterval(){return this.#g.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#e.values())}attachPlugin(t){if(this.#e.get(t.name))throw new Error(`cannot replace existing plugin: ${t.name} `);return this.#e.set(t.name,t.connect(this)),this}getPlugin(t){return this.#e.get(t)||null}get disableCcipRead(){return this.#p}set disableCcipRead(t){this.#p=!!t}async#c(t){const e=this.#g.cacheTimeout;if(e<0)return await this._perform(t);const n=je(t.method,t);let s=this.#i.get(n);return s||(s=this._perform(t),this.#i.set(n,s),setTimeout(()=>{this.#i.get(n)===s&&this.#i.delete(n)},e)),await s}async ccipReadFetch(t,e,n){if(this.disableCcipRead||n.length===0||t.to==null)return null;const s=t.to.toLowerCase(),i=e.toLowerCase(),a=[];for(let o=0;o<n.length;o++){const c=n[o],f=c.replace("{sender}",s).replace("{data}",i),u=new Rt(f);c.indexOf("{data}")===-1&&(u.body={data:i,sender:s}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:u,index:o,urls:n});let h="unknown error",d;try{d=await u.send()}catch(m){a.push(m.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:{error:m}});continue}try{const m=d.bodyJson;if(m.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:u,result:m}),m.data;m.message&&(h=m.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:m})}catch{}p(d.statusCode<400||d.statusCode>=500,`response not found during CCIP fetch: ${h}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:t,info:{url:c,errorMessage:h}}),a.push(h)}p(!1,`error encountered during CCIP fetch: ${a.map(o=>JSON.stringify(o)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:t,info:{urls:n,errorMessages:a}})}_wrapBlock(t,e){return new qo(yc(t),this)}_wrapLog(t,e){return new Fe(gc(t),this)}_wrapTransactionReceipt(t,e){return new Pi(Pc(t),this)}_wrapTransactionResponse(t,e){return new Be(Ui(t),this)}_detectNetwork(){p(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(t){p(!1,`unsupported method: ${t.method}`,"UNSUPPORTED_OPERATION",{operation:t.method,info:t})}async getBlockNumber(){const t=N(await this.#c({method:"getBlockNumber"}),"%response");return this.#o>=0&&(this.#o=t),t}_getAddress(t){return H(t,this)}_getBlockTag(t){if(t==null)return"latest";switch(t){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return t}if(U(t))return U(t,32)?t:dt(t);if(typeof t=="bigint"&&(t=N(t,"blockTag")),typeof t=="number")return t>=0?dt(t):this.#o>=0?dt(this.#o+t):this.getBlockNumber().then(e=>dt(e+t));l(!1,"invalid blockTag","blockTag",t)}_getFilter(t){const e=(t.topics||[]).map(c=>c==null?null:Array.isArray(c)?Kn(c.map(f=>f.toLowerCase())):c.toLowerCase()),n="blockHash"in t?t.blockHash:void 0,s=(c,f,u)=>{let h;switch(c.length){case 0:break;case 1:h=c[0];break;default:c.sort(),h=c}if(n&&(f!=null||u!=null))throw new Error("invalid filter");const d={};return h&&(d.address=h),e.length&&(d.topics=e),f&&(d.fromBlock=f),u&&(d.toBlock=u),n&&(d.blockHash=n),d};let i=[];if(t.address)if(Array.isArray(t.address))for(const c of t.address)i.push(this._getAddress(c));else i.push(this._getAddress(t.address));let a;"fromBlock"in t&&(a=this._getBlockTag(t.fromBlock));let o;return"toBlock"in t&&(o=this._getBlockTag(t.toBlock)),i.filter(c=>typeof c!="string").length||a!=null&&typeof a!="string"||o!=null&&typeof o!="string"?Promise.all([Promise.all(i),a,o]).then(c=>s(c[0],c[1],c[2])):s(i,a,o)}_getTransactionRequest(t){const e=Re(t),n=[];if(["to","from"].forEach(s=>{if(e[s]==null)return;const i=H(e[s],this);We(i)?n.push(async function(){e[s]=await i}()):e[s]=i}),e.blockTag!=null){const s=this._getBlockTag(e.blockTag);We(s)?n.push(async function(){e.blockTag=await s}()):e.blockTag=s}return n.length?async function(){return await Promise.all(n),e}():e}async getNetwork(){if(this.#s==null){const s=(async()=>{try{const i=await this._detectNetwork();return this.emit("network",i,null),i}catch(i){throw this.#s===s&&(this.#s=null),i}})();return this.#s=s,(await s).clone()}const t=this.#s,[e,n]=await Promise.all([t,this._detectNetwork()]);return e.chainId!==n.chainId&&(this.#a?(this.emit("network",n,e),this.#s===t&&(this.#s=Promise.resolve(n))):p(!1,`network changed: ${e.chainId} => ${n.chainId} `,"NETWORK_ERROR",{event:"changed"})),e.clone()}async getFeeData(){const t=await this.getNetwork(),e=async()=>{const{_block:s,gasPrice:i,priorityFee:a}=await Y({_block:this.#y("latest",!1),gasPrice:(async()=>{try{const u=await this.#c({method:"getGasPrice"});return b(u,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const u=await this.#c({method:"getPriorityFee"});return b(u,"%response")}catch{}return null})()});let o=null,c=null;const f=this._wrapBlock(s,t);return f&&f.baseFeePerGas&&(c=a??BigInt("1000000000"),o=f.baseFeePerGas*Rc+c),new Yr(i,o,c)},n=t.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(n){const s=new Rt(n.url),i=await n.processFunc(e,this,s);return new Yr(i.gasPrice,i.maxFeePerGas,i.maxPriorityFeePerGas)}return await e()}async estimateGas(t){let e=this._getTransactionRequest(t);return We(e)&&(e=await e),b(await this.#c({method:"estimateGas",transaction:e}),"%response")}async#l(t,e,n){p(n<Oc,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},t,{blockTag:e,enableCcipRead:!0})});const s=Re(t);try{return g(await this._perform({method:"call",transaction:s,blockTag:e}))}catch(i){if(!this.disableCcipRead&&Qn(i)&&i.data&&n>=0&&e==="latest"&&s.to!=null&&L(i.data,0,4)==="0x556f1830"){const a=i.data,o=await H(s.to,this);let c;try{c=Dc(L(i.data,4))}catch(h){p(!1,h.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:s,info:{data:a}})}p(c.sender.toLowerCase()===o.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:a,reason:"OffchainLookup",transaction:s,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const f=await this.ccipReadFetch(s,c.calldata,c.urls);p(f!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:s,info:{data:i.data,errorArgs:c.errorArgs}});const u={to:o,data:O([c.selector,_c([f,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:u});try{const h=await this.#l(u,e,n+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},u),result:h}),h}catch(h){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},u),error:h}),h}}throw i}}async#h(t){const{value:e}=await Y({network:this.getNetwork(),value:t});return e}async call(t){const{tx:e,blockTag:n}=await Y({tx:this._getTransactionRequest(t),blockTag:this._getBlockTag(t.blockTag)});return await this.#h(this.#l(e,n,t.enableCcipRead?0:-1))}async#d(t,e,n){let s=this._getAddress(e),i=this._getBlockTag(n);return(typeof s!="string"||typeof i!="string")&&([s,i]=await Promise.all([s,i])),await this.#h(this.#c(Object.assign(t,{address:s,blockTag:i})))}async getBalance(t,e){return b(await this.#d({method:"getBalance"},t,e),"%response")}async getTransactionCount(t,e){return N(await this.#d({method:"getTransactionCount"},t,e),"%response")}async getCode(t,e){return g(await this.#d({method:"getCode"},t,e))}async getStorage(t,e,n){const s=b(e,"position");return g(await this.#d({method:"getStorage",position:s},t,n))}async broadcastTransaction(t){const{blockNumber:e,hash:n,network:s}=await Y({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:t}),network:this.getNetwork()}),i=ct.from(t);if(i.hash!==n)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(i,s).replaceableTransaction(e)}async#y(t,e){if(U(t,32))return await this.#c({method:"getBlock",blockHash:t,includeTransactions:e});let n=this._getBlockTag(t);return typeof n!="string"&&(n=await n),await this.#c({method:"getBlock",blockTag:n,includeTransactions:e})}async getBlock(t,e){const{network:n,params:s}=await Y({network:this.getNetwork(),params:this.#y(t,!!e)});return s==null?null:this._wrapBlock(s,n)}async getTransaction(t){const{network:e,params:n}=await Y({network:this.getNetwork(),params:this.#c({method:"getTransaction",hash:t})});return n==null?null:this._wrapTransactionResponse(n,e)}async getTransactionReceipt(t){const{network:e,params:n}=await Y({network:this.getNetwork(),params:this.#c({method:"getTransactionReceipt",hash:t})});if(n==null)return null;if(n.gasPrice==null&&n.effectiveGasPrice==null){const s=await this.#c({method:"getTransaction",hash:t});if(s==null)throw new Error("report this; could not find tx or effectiveGasPrice");n.effectiveGasPrice=s.gasPrice}return this._wrapTransactionReceipt(n,e)}async getTransactionResult(t){const{result:e}=await Y({network:this.getNetwork(),result:this.#c({method:"getTransactionResult",hash:t})});return e==null?null:g(e)}async getLogs(t){let e=this._getFilter(t);We(e)&&(e=await e);const{network:n,params:s}=await Y({network:this.getNetwork(),params:this.#c({method:"getLogs",filter:e})});return s.map(i=>this._wrapLog(i,n))}_getProvider(t){p(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(t){return await pe.fromName(this,t)}async getAvatar(t){const e=await this.getResolver(t);return e?await e.getAvatar():null}async resolveName(t){const e=await this.getResolver(t);return e?await e.getAddress():null}async lookupAddress(t){t=x(t);const e=Gn(t.substring(2).toLowerCase()+".addr.reverse");try{const n=await pe.getEnsAddress(this),i=await new X(n,["function resolver(bytes32) view returns (address)"],this).resolver(e);if(i==null||i===xe)return null;const o=await new X(i,["function name(bytes32) view returns (string)"],this).name(e);return await this.resolveName(o)!==t?null:o}catch(n){if(j(n,"BAD_DATA")&&n.value==="0x"||j(n,"CALL_EXCEPTION"))return null;throw n}return null}async waitForTransaction(t,e,n){const s=e??1;return s===0?this.getTransactionReceipt(t):new Promise(async(i,a)=>{let o=null;const c=async f=>{try{const u=await this.getTransactionReceipt(t);if(u!=null&&f-u.blockNumber+1>=s){i(u),o&&(clearTimeout(o),o=null);return}}catch(u){console.log("EEE",u)}this.once("block",c)};n!=null&&(o=setTimeout(()=>{o!=null&&(o=null,this.off("block",c),a(F("timeout","TIMEOUT",{reason:"timeout"})))},n)),c(await this.getBlockNumber())})}async waitForBlock(t){p(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(t){const e=this.#f.get(t);e&&(e.timer&&clearTimeout(e.timer),this.#f.delete(t))}_setTimeout(t,e){e==null&&(e=0);const n=this.#u++,s=()=>{this.#f.delete(n),t()};if(this.paused)this.#f.set(n,{timer:null,func:s,time:e});else{const i=setTimeout(s,e);this.#f.set(n,{timer:i,func:s,time:On()})}return n}_forEachSubscriber(t){for(const e of this.#t.values())t(e.subscriber)}_getSubscriber(t){switch(t.type){case"debug":case"error":case"network":return new Li(t.type);case"block":{const e=new Ac(this);return e.pollingInterval=this.pollingInterval,e}case"safe":case"finalized":return new Tc(this,t.type);case"event":return new or(this,t.filter);case"transaction":return new Ic(this,t.hash);case"orphan":return new xc(this,t.filter)}throw new Error(`unsupported event: ${t.type}`)}_recoverSubscriber(t,e){for(const n of this.#t.values())if(n.subscriber===t){n.started&&n.subscriber.stop(),n.subscriber=e,n.started&&e.start(),this.#n!=null&&e.pause(this.#n);break}}async#m(t,e){let n=await Rn(t,this);return n.type==="event"&&e&&e.length>0&&e[0].removed===!0&&(n=await Rn({orphan:"drop-log",log:e[0]},this)),this.#t.get(n.tag)||null}async#b(t){const e=await Rn(t,this),n=e.tag;let s=this.#t.get(n);return s||(s={subscriber:this._getSubscriber(e),tag:n,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#t.set(n,s)),s}async on(t,e){const n=await this.#b(t);return n.listeners.push({listener:e,once:!1}),n.started||(n.subscriber.start(),n.started=!0,this.#n!=null&&n.subscriber.pause(this.#n)),this}async once(t,e){const n=await this.#b(t);return n.listeners.push({listener:e,once:!0}),n.started||(n.subscriber.start(),n.started=!0,this.#n!=null&&n.subscriber.pause(this.#n)),this}async emit(t,...e){const n=await this.#m(t,e);if(!n||n.listeners.length===0)return!1;const s=n.listeners.length;return n.listeners=n.listeners.filter(({listener:i,once:a})=>{const o=new ks(this,a?null:i,t);try{i.call(this,...e,o)}catch{}return!a}),n.listeners.length===0&&(n.started&&n.subscriber.stop(),this.#t.delete(n.tag)),s>0}async listenerCount(t){if(t){const n=await this.#m(t);return n?n.listeners.length:0}let e=0;for(const{listeners:n}of this.#t.values())e+=n.length;return e}async listeners(t){if(t){const n=await this.#m(t);return n?n.listeners.map(({listener:s})=>s):[]}let e=[];for(const{listeners:n}of this.#t.values())e=e.concat(n.map(({listener:s})=>s));return e}async off(t,e){const n=await this.#m(t);if(!n)return this;if(e){const s=n.listeners.map(({listener:i})=>i).indexOf(e);s>=0&&n.listeners.splice(s,1)}return(!e||n.listeners.length===0)&&(n.started&&n.subscriber.stop(),this.#t.delete(n.tag)),this}async removeAllListeners(t){if(t){const{tag:e,started:n,subscriber:s}=await this.#b(t);n&&s.stop(),this.#t.delete(e)}else for(const[e,{started:n,subscriber:s}]of this.#t)n&&s.stop(),this.#t.delete(e);return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return this.off(t,e)}get destroyed(){return this.#r}destroy(){this.removeAllListeners();for(const t of this.#f.keys())this._clearTimeout(t);this.#r=!0}get paused(){return this.#n!=null}set paused(t){!!t!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(t){if(this.#o=-1,this.#n!=null){if(this.#n==!!t)return;p(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(e=>e.pause(t)),this.#n=!!t;for(const e of this.#f.values())e.timer&&clearTimeout(e.timer),e.time=On()-e.time}resume(){if(this.#n!=null){this._forEachSubscriber(t=>t.resume()),this.#n=null;for(const t of this.#f.values()){let e=t.time;e<0&&(e=0),t.time=On(),setTimeout(t.func,e)}}}}function Lc(r,t){try{const e=Xn(r,t);if(e)return tn(e)}catch{}return null}function Xn(r,t){if(r==="0x")return null;try{const e=N(L(r,t,t+32)),n=N(L(r,e,e+32));return L(r,e+32,e+32+n)}catch{}return null}function is(r){const t=M(r);if(t.length>32)throw new Error("internal; should not happen");const e=new Uint8Array(32);return e.set(t,32-t.length),e}function Fc(r){if(r.length%32===0)return r;const t=new Uint8Array(Math.ceil(r.length/32)*32);return t.set(r),t}const Bc=new Uint8Array([]);function _c(r){const t=[];let e=0;for(let n=0;n<r.length;n++)t.push(Bc),e+=32;for(let n=0;n<r.length;n++){const s=y(r[n]);t[n]=is(e),t.push(is(s.length)),t.push(Fc(s)),e+=32+Math.ceil(s.length/32)*32}return O(t)}const as="0x0000000000000000000000000000000000000000000000000000000000000000";function Dc(r){const t={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};p(ue(r)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const e=L(r,0,32);p(L(e,0,12)===L(as,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),t.sender=L(e,12);try{const n=[],s=N(L(r,32,64)),i=N(L(r,s,s+32)),a=L(r,s+32);for(let o=0;o<i;o++){const c=Lc(a,o*32);if(c==null)throw new Error("abort");n.push(c)}t.urls=n}catch{p(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const n=Xn(r,64);if(n==null)throw new Error("abort");t.calldata=n}catch{p(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}p(L(r,100,128)===L(as,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),t.selector=L(r,96,100);try{const n=Xn(r,128);if(n==null)throw new Error("abort");t.extraData=n}catch{p(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return t.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(n=>t[n]),t}function zt(r,t){if(r.provider)return r.provider;p(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:t})}async function os(r,t){let e=Re(t);if(e.to!=null&&(e.to=H(e.to,r)),e.from!=null){const n=e.from;e.from=Promise.all([r.getAddress(),H(n,r)]).then(([s,i])=>(l(s.toLowerCase()===i.toLowerCase(),"transaction from mismatch","tx.from",i),s))}else e.from=r.getAddress();return await Y(e)}class cr{provider;constructor(t){E(this,{provider:t||null})}async getNonce(t){return zt(this,"getTransactionCount").getTransactionCount(await this.getAddress(),t)}async populateCall(t){return await os(this,t)}async populateTransaction(t){const e=zt(this,"populateTransaction"),n=await os(this,t);n.nonce==null&&(n.nonce=await this.getNonce("pending")),n.gasLimit==null&&(n.gasLimit=await this.estimateGas(n));const s=await this.provider.getNetwork();if(n.chainId!=null){const a=b(n.chainId);l(a===s.chainId,"transaction chainId mismatch","tx.chainId",t.chainId)}else n.chainId=s.chainId;const i=n.maxFeePerGas!=null||n.maxPriorityFeePerGas!=null;if(n.gasPrice!=null&&(n.type===2||i)?l(!1,"eip-1559 transaction do not support gasPrice","tx",t):(n.type===0||n.type===1)&&i&&l(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",t),(n.type===2||n.type==null)&&n.maxFeePerGas!=null&&n.maxPriorityFeePerGas!=null)n.type=2;else if(n.type===0||n.type===1){const a=await e.getFeeData();p(a.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),n.gasPrice==null&&(n.gasPrice=a.gasPrice)}else{const a=await e.getFeeData();if(n.type==null)if(a.maxFeePerGas!=null&&a.maxPriorityFeePerGas!=null)if(n.authorizationList&&n.authorizationList.length?n.type=4:n.type=2,n.gasPrice!=null){const o=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=o,n.maxPriorityFeePerGas=o}else n.maxFeePerGas==null&&(n.maxFeePerGas=a.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=a.maxPriorityFeePerGas);else a.gasPrice!=null?(p(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),n.gasPrice==null&&(n.gasPrice=a.gasPrice),n.type=0):p(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(n.type===2||n.type===3||n.type===4)&&(n.maxFeePerGas==null&&(n.maxFeePerGas=a.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=a.maxPriorityFeePerGas))}return await Y(n)}async populateAuthorization(t){const e=Object.assign({},t);return e.chainId==null&&(e.chainId=(await zt(this,"getNetwork").getNetwork()).chainId),e.nonce==null&&(e.nonce=await this.getNonce()),e}async estimateGas(t){return zt(this,"estimateGas").estimateGas(await this.populateCall(t))}async call(t){return zt(this,"call").call(await this.populateCall(t))}async resolveName(t){return await zt(this,"resolveName").resolveName(t)}async sendTransaction(t){const e=zt(this,"sendTransaction"),n=await this.populateTransaction(t);delete n.from;const s=ct.from(n);return await e.broadcastTransaction(await this.signTransaction(s))}authorize(t){p(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}class fr extends cr{address;constructor(t,e){super(e),E(this,{address:t})}async getAddress(){return this.address}connect(t){return new fr(this.address,t)}#t(t,e){p(!1,`VoidSigner cannot sign ${t}`,"UNSUPPORTED_OPERATION",{operation:e})}async signTransaction(t){this.#t("transactions","signTransaction")}async signMessage(t){this.#t("messages","signMessage")}async signTypedData(t,e,n){this.#t("typed-data","signTypedData")}}function $c(r){return JSON.parse(JSON.stringify(r))}class Fi{#t;#e;#n;#r;#s;#a;constructor(t){this.#t=t,this.#e=null,this.#n=this.#i.bind(this),this.#r=!1,this.#s=null,this.#a=!1}_subscribe(t){throw new Error("subclasses must override this")}_emitResults(t,e){throw new Error("subclasses must override this")}_recover(t){throw new Error("subclasses must override this")}async#i(t){try{this.#e==null&&(this.#e=this._subscribe(this.#t));let e=null;try{e=await this.#e}catch(i){if(!j(i,"UNSUPPORTED_OPERATION")||i.operation!=="eth_newFilter")throw i}if(e==null){this.#e=null,this.#t._recoverSubscriber(this,this._recover(this.#t));return}const n=await this.#t.getNetwork();if(this.#s||(this.#s=n),this.#s.chainId!==n.chainId)throw new Error("chaid changed");if(this.#a)return;const s=await this.#t.send("eth_getFilterChanges",[e]);await this._emitResults(this.#t,s)}catch(e){console.log("@TODO",e)}this.#t.once("block",this.#n)}#o(){const t=this.#e;t&&(this.#e=null,t.then(e=>{this.#t.destroyed||this.#t.send("eth_uninstallFilter",[e])}))}start(){this.#r||(this.#r=!0,this.#i(-2))}stop(){this.#r&&(this.#r=!1,this.#a=!0,this.#o(),this.#t.off("block",this.#n))}pause(t){t&&this.#o(),this.#t.off("block",this.#n)}resume(){this.start()}}class Mc extends Fi{#t;constructor(t,e){super(t),this.#t=$c(e)}_recover(t){return new or(t,this.#t)}async _subscribe(t){return await t.send("eth_newFilter",[this.#t])}async _emitResults(t,e){for(const n of e)t.emit(this.#t,t._wrapLog(n,t._network))}}class Gc extends Fi{async _subscribe(t){return await t.send("eth_newPendingTransactionFilter",[])}async _emitResults(t,e){for(const n of e)t.emit("pending",n)}}const zc="bigint,boolean,function,number,string,symbol".split(/,/g);function Ze(r){if(r==null||zc.indexOf(typeof r)>=0||typeof r.getAddress=="function")return r;if(Array.isArray(r))return r.map(Ze);if(typeof r=="object")return Object.keys(r).reduce((t,e)=>(t[e]=r[e],t),{});throw new Error(`should not happen: ${r} (${typeof r})`)}function Vc(r){return new Promise(t=>{setTimeout(t,r)})}function ie(r){return r&&r.toLowerCase()}function cs(r){return r&&typeof r.pollingInterval=="number"}const Bi={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class Sn extends cr{address;constructor(t,e){super(t),e=x(e),E(this,{address:e})}connect(t){p(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const e=Ze(t),n=[];if(e.from){const i=e.from;n.push((async()=>{const a=await H(i,this.provider);l(a!=null&&a.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=a})())}else e.from=this.address;if(e.gasLimit==null&&n.push((async()=>{e.gasLimit=await this.provider.estimateGas({...e,from:this.address})})()),e.to!=null){const i=e.to;n.push((async()=>{e.to=await H(i,this.provider)})())}n.length&&await Promise.all(n);const s=this.provider.getRpcTransaction(e);return this.provider.send("eth_sendTransaction",[s])}async sendTransaction(t){const e=await this.provider.getBlockNumber(),n=await this.sendUncheckedTransaction(t);return await new Promise((s,i)=>{const a=[1e3,100];let o=0;const c=async()=>{try{const f=await this.provider.getTransaction(n);if(f!=null){s(f.replaceableTransaction(e));return}}catch(f){if(j(f,"CANCELLED")||j(f,"BAD_DATA")||j(f,"NETWORK_ERROR")||j(f,"UNSUPPORTED_OPERATION")){f.info==null&&(f.info={}),f.info.sendTransactionHash=n,i(f);return}if(j(f,"INVALID_ARGUMENT")&&(o++,f.info==null&&(f.info={}),f.info.sendTransactionHash=n,o>10)){i(f);return}this.provider.emit("error",F("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:f}))}this.provider._setTimeout(()=>{c()},a.pop()||4e3)};c()})}async signTransaction(t){const e=Ze(t);if(e.from){const s=await H(e.from,this.provider);l(s!=null&&s.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=s}else e.from=this.address;const n=this.provider.getRpcTransaction(e);return await this.provider.send("eth_signTransaction",[n])}async signMessage(t){const e=typeof t=="string"?et(t):t;return await this.provider.send("personal_sign",[g(e),this.address.toLowerCase()])}async signTypedData(t,e,n){const s=Ze(n),i=await Q.resolveNames(t,e,s,async a=>{const o=await H(a);return l(o!=null,"TypedData does not support null address","value",a),o});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(Q.getPayload(i.domain,e,i.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const e=typeof t=="string"?et(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),g(e)])}}class Hc extends Uc{#t;#e;#n;#r;#s;#a;#i;#o(){if(this.#r)return;const t=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");this.#r=setTimeout(()=>{this.#r=null;const e=this.#n;for(this.#n=[];e.length;){const n=[e.shift()];for(;e.length&&n.length!==this.#t.batchMaxCount;)if(n.push(e.shift()),JSON.stringify(n.map(i=>i.payload)).length>this.#t.batchMaxSize){e.unshift(n.pop());break}(async()=>{const s=n.length===1?n[0].payload:n.map(i=>i.payload);this.emit("debug",{action:"sendRpcPayload",payload:s});try{const i=await this._send(s);this.emit("debug",{action:"receiveRpcResult",result:i});for(const{resolve:a,reject:o,payload:c}of n){if(this.destroyed){o(F("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:c.method}));continue}const f=i.filter(u=>u.id===c.id)[0];if(f==null){const u=F("missing response for request","BAD_DATA",{value:i,info:{payload:c}});this.emit("error",u),o(u);continue}if("error"in f){o(this.getRpcError(c,f));continue}a(f.result)}}catch(i){this.emit("debug",{action:"receiveRpcError",error:i});for(const{reject:a}of n)a(i)}})()}},t)}constructor(t,e){super(t,e),this.#e=1,this.#t=Object.assign({},Bi,e||{}),this.#n=[],this.#r=null,this.#a=null,this.#i=null;{let s=null;const i=new Promise(a=>{s=a});this.#s={promise:i,resolve:s}}const n=this._getOption("staticNetwork");typeof n=="boolean"?(l(!n||t!=="any","staticNetwork cannot be used on special network 'any'","options",e),n&&t!=null&&(this.#a=at.from(t))):n&&(l(t==null||n.matches(t),"staticNetwork MUST match network object","options",e),this.#a=n)}_getOption(t){return this.#t[t]}get _network(){return p(this.#a,"network is not available yet","NETWORK_ERROR"),this.#a}async _perform(t){if(t.method==="call"||t.method==="estimateGas"){let n=t.transaction;if(n&&n.type!=null&&b(n.type)&&n.maxFeePerGas==null&&n.maxPriorityFeePerGas==null){const s=await this.getFeeData();s.maxFeePerGas==null&&s.maxPriorityFeePerGas==null&&(t=Object.assign({},t,{transaction:Object.assign({},n,{type:void 0})}))}}const e=this.getRpcRequest(t);return e!=null?await this.send(e.method,e.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t)if(t===!0){if(this.#a)return this.#a}else return t;return this.#i?await this.#i:this.ready?(this.#i=(async()=>{try{const e=at.from(b(await this.send("eth_chainId",[])));return this.#i=null,e}catch(e){throw this.#i=null,e}})(),await this.#i):(this.#i=(async()=>{const e={id:this.#e++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:e});let n;try{n=(await this._send(e))[0],this.#i=null}catch(s){throw this.#i=null,this.emit("debug",{action:"receiveRpcError",error:s}),s}if(this.emit("debug",{action:"receiveRpcResult",result:n}),"result"in n)return at.from(b(n.result));throw this.getRpcError(e,n)})(),await this.#i)}_start(){this.#s==null||this.#s.resolve==null||(this.#s.resolve(),this.#s=null,(async()=>{for(;this.#a==null&&!this.destroyed;)try{this.#a=await this._detectNetwork()}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",F("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await Vc(1e3)}this.#o()})())}async _waitUntilReady(){if(this.#s!=null)return await this.#s.promise}_getSubscriber(t){return t.type==="pending"?new Gc(this):t.type==="event"?this._getOption("polling")?new or(this,t.filter):new Mc(this,t.filter):t.type==="orphan"&&t.filter.orphan==="drop-log"?new Li("orphan"):super._getSubscriber(t)}get ready(){return this.#s==null}getRpcTransaction(t){const e={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(n=>{if(t[n]==null)return;let s=n;n==="gasLimit"&&(s="gas"),e[s]=dt(b(t[n],`tx.${n}`))}),["from","to","data"].forEach(n=>{t[n]!=null&&(e[n]=g(t[n]))}),t.accessList&&(e.accessList=te(t.accessList)),t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes.map(n=>n.toLowerCase())),t.authorizationList&&(e.authorizationList=t.authorizationList.map(n=>{const s=ai(n);return{address:s.address,nonce:dt(s.nonce),chainId:dt(s.chainId),yParity:dt(s.signature.yParity),r:dt(s.signature.r),s:dt(s.signature.s)}})),e}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[ie(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[ie(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[ie(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[ie(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&t.filter.address!=null&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(ie):t.filter.address=ie(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,e){const{method:n}=t,{error:s}=e;if(n==="eth_estimateGas"&&s.message){const o=s.message;if(!o.match(/revert/i)&&o.match(/insufficient funds/i))return F("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:s}});if(o.match(/nonce/i)&&o.match(/too low/i))return F("nonce has already been used","NONCE_EXPIRED",{transaction:t.params[0],info:{payload:t,error:s}})}if(n==="eth_call"||n==="eth_estimateGas"){const o=Jn(s),c=ge.getBuiltinCallException(n==="eth_call"?"call":"estimateGas",t.params[0],o?o.data:null);return c.info={error:s,payload:t},c}const i=JSON.stringify(Xc(s));if(typeof s.message=="string"&&s.message.match(/user denied|ethers-user-denied/i))return F("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[n]||"unknown",reason:"rejected",info:{payload:t,error:s}});if(n==="eth_sendRawTransaction"||n==="eth_sendTransaction"){const o=t.params[0];if(i.match(/insufficient funds|base fee exceeds gas limit/i))return F("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:o,info:{error:s}});if(i.match(/nonce/i)&&i.match(/too low/i))return F("nonce has already been used","NONCE_EXPIRED",{transaction:o,info:{error:s}});if(i.match(/replacement transaction/i)&&i.match(/underpriced/i))return F("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:o,info:{error:s}});if(i.match(/only replay-protected/i))return F("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:n,info:{transaction:o,info:{error:s}}})}let a=!!i.match(/the method .* does not exist/i);return a||s&&s.details&&s.details.startsWith("Unauthorized method:")&&(a=!0),a?F("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:s,payload:t}}):F("could not coalesce error","UNKNOWN_ERROR",{error:s,payload:t})}send(t,e){if(this.destroyed)return Promise.reject(F("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const n=this.#e++,s=new Promise((i,a)=>{this.#n.push({resolve:i,reject:a,payload:{method:t,params:e,id:n,jsonrpc:"2.0"}})});return this.#o(),s}async getSigner(t){t==null&&(t=0);const e=this.send("eth_accounts",[]);if(typeof t=="number"){const s=await e;if(t>=s.length)throw new Error("no such account");return new Sn(this,s[t])}const{accounts:n}=await Y({network:this.getNetwork(),accounts:e});t=x(t);for(const s of n)if(x(s)===t)return new Sn(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(e=>new Sn(this,e))}destroy(){this.#r&&(clearTimeout(this.#r),this.#r=null);for(const{payload:t,reject:e}of this.#n)e(F("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));this.#n=[],super.destroy()}}class Kc extends Hc{#t;constructor(t,e){super(t,e);let n=this._getOption("pollingInterval");n==null&&(n=Bi.pollingInterval),this.#t=n}_getSubscriber(t){const e=super._getSubscriber(t);return cs(e)&&(e.pollingInterval=this.#t),e}get pollingInterval(){return this.#t}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");this.#t=t,this._forEachSubscriber(e=>{cs(e)&&(e.pollingInterval=this.#t)})}}function Jn(r){if(r==null)return null;if(typeof r.message=="string"&&r.message.match(/revert/i)&&U(r.data))return{message:r.message,data:r.data};if(typeof r=="object"){for(const t in r){const e=Jn(r[t]);if(e)return e}return null}if(typeof r=="string")try{return Jn(JSON.parse(r))}catch{}return null}function Wn(r,t){if(r!=null){if(typeof r.message=="string"&&t.push(r.message),typeof r=="object")for(const e in r)Wn(r[e],t);if(typeof r=="string")try{return Wn(JSON.parse(r),t)}catch{}}}function Xc(r){const t=[];return Wn(r,t),t}class Ht extends Kc{#t;#e;constructor(t,e,n){const s=Object.assign({},n??{},{batchMaxCount:1});l(t&&t.request,"invalid EIP-1193 provider","ethereum",t),super(e,s),this.#e=null,n&&n.providerInfo&&(this.#e=n.providerInfo),this.#t=async(i,a)=>{const o={method:i,params:a};this.emit("debug",{action:"sendEip1193Request",payload:o});try{const c=await t.request(o);return this.emit("debug",{action:"receiveEip1193Result",result:c}),c}catch(c){const f=new Error(c.message);throw f.code=c.code,f.data=c.data,f.payload=o,this.emit("debug",{action:"receiveEip1193Error",error:f}),f}}}get providerInfo(){return this.#e}async send(t,e){return await this._start(),await super.send(t,e)}async _send(t){l(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const e=await this.#t(t.method,t.params||[]);return[{id:t.id,result:e}]}catch(e){return[{id:t.id,error:{code:e.code,data:e.data,message:e.message}}]}}getRpcError(t,e){switch(e=JSON.parse(JSON.stringify(e)),e.error.code||-1){case 4001:e.error.message=`ethers-user-denied: ${e.error.message}`;break;case 4200:e.error.message=`ethers-unsupported: ${e.error.message}`;break}return super.getRpcError(t,e)}async hasSigner(t){t==null&&(t=0);const e=await this.send("eth_accounts",[]);return typeof t=="number"?e.length>t:(t=t.toLowerCase(),e.filter(n=>n.toLowerCase()===t).length!==0)}async getSigner(t){if(t==null&&(t=0),!await this.hasSigner(t))try{await this.#t("eth_requestAccounts",[])}catch(e){const n=e.payload;throw this.getRpcError(n,{id:n.id,error:e})}return await super.getSigner(t)}static async discover(t){if(t==null&&(t={}),t.provider)return new Ht(t.provider);const e=t.window?t.window:typeof window<"u"?window:null;if(e==null)return null;const n=t.anyProvider;if(n&&e.ethereum)return new Ht(e.ethereum);if(!("addEventListener"in e&&"dispatchEvent"in e&&"removeEventListener"in e))return null;const s=t.timeout?t.timeout:300;return s===0?null:await new Promise((i,a)=>{let o=[];const c=h=>{o.push(h.detail),n&&f()},f=()=>{if(clearTimeout(u),o.length)if(t&&t.filter){const h=t.filter(o.map(d=>Object.assign({},d.info)));if(h==null)i(null);else if(h instanceof Ht)i(h);else{let d=null;if(h.uuid&&(d=o.filter(P=>h.uuid===P.info.uuid)[0]),d){const{provider:m,info:P}=d;i(new Ht(m,void 0,{providerInfo:P}))}else a(F("filter returned unknown info","UNSUPPORTED_OPERATION",{value:h}))}}else{const{provider:h,info:d}=o[0];i(new Ht(h,void 0,{providerInfo:d}))}else i(null);e.removeEventListener("eip6963:announceProvider",c)},u=setTimeout(()=>{f()},s);e.addEventListener("eip6963:announceProvider",c),e.dispatchEvent(new Event("eip6963:requestProvider"))})}}class yn extends cr{address;#t;constructor(t,e){super(e),l(t&&typeof t.sign=="function","invalid private key","privateKey","[ REDACTED ]"),this.#t=t;const n=Le(this.signingKey.publicKey);E(this,{address:n})}get signingKey(){return this.#t}get privateKey(){return this.signingKey.privateKey}async getAddress(){return this.address}connect(t){return new yn(this.#t,t)}async signTransaction(t){t=Re(t);const{to:e,from:n}=await Y({to:t.to?H(t.to,this):void 0,from:t.from?H(t.from,this):void 0});e!=null&&(t.to=e),n!=null&&(t.from=n),t.from!=null&&(l(x(t.from)===this.address,"transaction from address mismatch","tx.from",t.from),delete t.from);const s=ct.from(t);return s.signature=this.signingKey.sign(s.unsignedHash),s.serialized}async signMessage(t){return this.signMessageSync(t)}signMessageSync(t){return this.signingKey.sign(Io(t)).serialized}authorizeSync(t){l(typeof t.address=="string","invalid address for authorizeSync","auth.address",t);const e=this.signingKey.sign(Ao(t));return Object.assign({},{address:x(t.address),nonce:b(t.nonce||0),chainId:b(t.chainId||0)},{signature:e})}async authorize(t){return t=Object.assign({},t,{address:await H(t.address,this)}),this.authorizeSync(await this.populateAuthorization(t))}async signTypedData(t,e,n){const s=await Q.resolveNames(t,e,n,async i=>{p(this.provider!=null,"cannot resolve ENS names without a provider","UNSUPPORTED_OPERATION",{operation:"resolveName",info:{name:i}});const a=await this.provider.resolveName(i);return p(a!=null,"unconfigured ENS name","UNCONFIGURED_NAME",{value:i}),a});return this.signingKey.sign(Q.hash(s.domain,e,s.value)).serialized}}const nn=" !#$%&'()*+,-./<=>?@[]^_`{|}~",Jc=/^[a-z]*$/i;function fs(r,t){let e=97;return r.reduce((n,s)=>(s===t?e++:s.match(Jc)?n.push(String.fromCharCode(e)+s):(e=97,n.push(s)),n),[])}function Wc(r,t){for(let s=nn.length-1;s>=0;s--)r=r.split(nn[s]).join(t.substring(2*s,2*s+2));const e=[],n=r.replace(/(:|([0-9])|([A-Z][a-z]*))/g,(s,i,a,o)=>{if(a)for(let c=parseInt(a);c>=0;c--)e.push(";");else e.push(i.toLowerCase());return""});if(n)throw new Error(`leftovers: ${JSON.stringify(n)}`);return fs(fs(e,";"),":")}function jc(r){return l(r[0]==="0","unsupported auwl data","data",r),Wc(r.substring(1+2*nn.length),r.substring(1,1+2*nn.length))}class Zc{locale;constructor(t){E(this,{locale:t})}split(t){return t.toLowerCase().split(/\s+/g)}join(t){return t.join(" ")}}class Yc extends Zc{#t;#e;constructor(t,e,n){super(t),this.#t=e,this.#e=n,this.#n=null}get _data(){return this.#t}_decodeWords(){return jc(this.#t)}#n;#r(){if(this.#n==null){const t=this._decodeWords();if(St(t.join(`
`)+`
`)!==this.#e)throw new Error(`BIP39 Wordlist for ${this.locale} FAILED`);this.#n=t}return this.#n}getWord(t){const e=this.#r();return l(t>=0&&t<e.length,`invalid word index: ${t}`,"index",t),e[t]}getWordIndex(t){return this.#r().indexOf(t)}}const Qc="0erleonalorenseinceregesticitStanvetearctssi#ch2Athck&tneLl0And#Il.yLeOutO=S|S%b/ra@SurdU'0Ce[Cid|CountCu'Hie=IdOu,-Qui*Ro[TT]T%T*[Tu$0AptDD-tD*[Ju,M.UltV<)Vi)0Rob-0FairF%dRaid0A(EEntRee0Ead0MRRp%tS!_rmBumCoholErtI&LLeyLowMo,O}PhaReadySoT Ways0A>urAz(gOngOuntU'd0Aly,Ch%Ci|G G!GryIm$K!Noun)Nu$O` Sw T&naTiqueXietyY1ArtOlogyPe?P!Pro=Ril1ChCt-EaEnaGueMMedM%MyOundR<+Re,Ri=RowTTefa@Ti,Tw%k0KPe@SaultSetSi,SumeThma0H!>OmTa{T&dT.udeTra@0Ct]D.Gu,NtTh%ToTumn0Era+OcadoOid0AkeA*AyEsomeFulKw?d0Is:ByChel%C#D+GL<)Lc#y~MbooN<aNn RRelyRga(R*lSeS-SketTt!3A^AnAutyCau'ComeEfF%eG(Ha=H(dLie=LowLtN^Nef./TrayTt Twe&Y#d3Cyc!DKeNdOlogyRdR`Tt _{AdeAmeAnketA,EakE[IndOodO[omOu'UeUrUsh_rdAtDyIlMbNeNusOkO,Rd R(gRrowSsTtomUn)XY_{etA(AndA[A=EadEezeI{Id+IefIghtIngIskOccoliOk&OnzeOomO` OwnUsh2Bb!DdyD+tFf$oIldLbLkL!tNd!Nk Rd&Rg R,SS(e[SyTt Y Zz:Bba+B(B!CtusGeKe~LmM aMpNN$N)lNdyNn#NoeNvasNy#Pab!P.$Pta(RRb#RdRgoRpetRryRtSeShS(o/!Su$TT$ogT^Teg%yTt!UghtU'Ut]Ve3Il(gL yM|NsusNturyRe$Rta(_irAlkAmp]An+AosApt Ar+A'AtEapE{Ee'EfErryE,I{&IefIldIm}yOi)Oo'R#-U{!UnkUrn0G?Nnam#Rc!Tiz&TyVil_imApArifyAwAyE<ErkEv I{I|IffImbIn-IpO{OgO'O`OudOwnUbUmpU, Ut^_^A,C#utDeFfeeIlInL!@L%LumnMb(eMeMf%tM-Mm#Mp<yNc tNdu@NfirmNg*[N}@Nsid NtrolNv()OkOlPp PyR$ReRnR*@/Tt#U^UntryUp!Ur'Us(V Yo>_{Ad!AftAmA}AshAt AwlAzyEamEd.EekEwI{etImeIspIt-OpO[Ou^OwdUci$UelUi'Umb!Un^UshYY,$2BeLtu*PPbo?dRiousRr|Rta(R=Sh]/omTe3C!:DMa+MpN)Ng R(gShUght WnY3AlBa>BrisCadeCemb CideCl(eC%a>C*a'ErF&'F(eFyG*eLayLiv M<dMi'Ni$Nti,NyP?tP&dPos.P`PutyRi=ScribeS tSignSkSpair/royTailTe@VelopVi)Vo>3AgramAlAm#dAryCeE'lEtFf G.$Gn.yLemmaNn NosaurRe@RtSag*eScov Sea'ShSmi[S%d Splay/<)V tVideV%)Zzy5Ct%Cum|G~Lph(Ma(Na>NkeyN%OrSeUb!Ve_ftAg#AmaA,-AwEamE[IftIllInkIpI=OpUmY2CkMbNeR(g/T^Ty1Arf1Nam-:G G!RlyRnR`Sily/Sy1HoOlogyOnomy0GeItUca>1F%t0G1GhtTh 2BowD E@r-Eg<tEm|Eph<tEvat%I>Se0B?kBodyBra)Er+Ot]PloyPow Pty0Ab!A@DD![D%'EmyErgyF%)Ga+G(eH<)JoyLi,OughR-hRollSu*T Ti*TryVelope1Isode0U$Uip0AA'OdeOs]R%Upt0CapeSayS&)Ta>0Ern$H-s1Id&)IlOkeOl=1A@Amp!Ce[Ch<+C.eCludeCu'Ecu>Erci'Hau,Hib.I!I,ItOt-P<dPe@Pi*Pla(Po'P*[T&dTra0EEbrow:Br-CeCultyDeIntI`~L'MeMilyMousNNcyNtasyRmSh]TT$Th TigueUltV%.e3Atu*Bru?yD $EEdElMa!N)/iv$T^V W3B Ct]EldGu*LeLmLt N$NdNeNg NishReRmR,Sc$ShTT}[X_gAmeAshAtAv%EeIghtIpOatO{O%Ow UidUshY_mCusGIlLd~owOdOtR)Re,R+tRkRtu}RumRw?dSsil/ UndX_gi!AmeEqu|EshI&dIn+OgOntO,OwnOz&U.2ElNNnyRna)RyTu*:D+tInLaxy~ yMePRa+Rba+Rd&Rl-Rm|SSpTeTh U+Ze3N $NiusN*Nt!Nu(e/u*2O,0AntFtGg!Ng RaffeRlVe_dAn)A*A[IdeImp'ObeOomOryO=OwUe_tDde[LdOdO'RillaSpelSsipV nWn_bA)A(AntApeA[Av.yEatE&IdIefItOc yOupOwUnt_rdE[IdeIltIt?N3M:B.IrLfMm M, NdPpyRb%RdRshR=,TVeWkZ?d3AdAl`ArtAvyD+hogIght~oLmetLpNRo3Dd&Gh~NtPRe/%y5BbyCkeyLdLeLiday~owMeNeyOdPeRnRr%R'Sp.$/TelUrV 5BGeM<Mb!M%Nd*dNgryNtRd!RryRtSb<d3Brid:1EOn0EaEntifyLe2N%e4LLeg$L}[0A+Ita>M&'Mu}Pa@Po'Pro=Pul'0ChCludeComeC*a'DexD-a>Do%Du,ryF<tFl-tF%mHa!H .Iti$Je@JuryMa>N Noc|PutQuiryS<eSe@SideSpi*/$lTa@T e,ToVe,V.eVol=3On0L<dOla>Sue0Em1Ory:CketGu?RZz3AlousAns~yWel9BInKeUr}yY5D+I)MpNg!Ni%Nk/:Ng?oo3EnEpT^upY3CkDD}yNdNgdomSsTT^&TeTt&Wi4EeIfeO{Ow:BBelB%Dd DyKeMpNgua+PtopR+T T(UghUndryVaWWnWsu.Y Zy3Ad AfArnA=Ctu*FtGG$G&dIsu*M#NdNg`NsOp?dSs#Tt Vel3ArB tyBr?yC&'FeFtGhtKeMbM.NkOnQuid/Tt!VeZ?d5AdAnB, C$CkG-NelyNgOpTt yUdUn+VeY$5CkyGga+Mb N?N^Xury3R-s:Ch(eDG-G}tIdIlInJ%KeMm$NNa+Nda>NgoNs]Nu$P!Rb!R^Rg(R(eRketRria+SkSs/ T^T i$ThTrixTt XimumZe3AdowAnAsu*AtCh<-D$DiaLodyLtMb M%yNt]NuRcyR+R.RryShSsa+T$Thod3Dd!DnightLk~]M-NdNimumN%Nu>Rac!Rr%S ySs/akeXXedXtu*5Bi!DelDifyMM|N.%NkeyN, N`OnR$ReRn(gSqu.oTh T]T%Unta(U'VeVie5ChFf(LeLtiplySc!SeumShroomS-/Tu$3Self/ yTh:I=MePk(Rrow/yT]Tu*3ArCkEdGati=G!@I` PhewR=/TTw%kUtr$V WsXt3CeGht5B!I'M(eeOd!Rm$R`SeTab!TeTh(gTi)VelW5C!?Mb R'T:K0EyJe@Li+Scu*S =Ta(Vious0CurE<Tob 0Or1FF Fi)T&2L1Ay0DI=Ymp-0It0CeEI#L(eLy1EnEraIn]Po'T]1An+B.Ch?dD D(?yG<I|Ig($Ph<0Tr-h0H 0Tdo%T TputTside0AlEnEr0NN 0Yg&0/ 0O}:CtDd!GeIrLa)LmNdaNelN-N` P RadeR|RkRrotRtySsT^ThTi|TrolTt nU'VeYm|3A)AnutArAs<tL-<NN$tyNcilOp!Pp Rfe@Rm.Rs#T2O}OtoRa'Ys-$0AnoCn-Ctu*E)GGe#~LotNkO} Pe/olT^Zza_)A}tA,-A>AyEa'Ed+U{UgUn+2EmEtIntL?LeLi)NdNyOlPul?Rt]S.]Ssib!/TatoTt yV tyWd W _@i)Ai'Ed-tEf Epa*Es|EttyEv|I)IdeIm?yIntI%.yIs#Iva>IzeOb!mO)[Odu)Of.OgramOje@Omo>OofOp tyOsp O>@OudOvide2Bl-Dd(g~LpL'Mpk(N^PilPpyR^a'R.yRpo'R'ShTZz!3Ramid:99Al.yAntumArt E,]I{ItIzO>:Bb.Cco#CeCkD?DioIlInI'~yMpN^NdomN+PidReTeTh V&WZ%3AdyAlAs#BelBuildC$lCei=CipeC%dCyc!Du)F!@F%mFu'G]G*tGul?Je@LaxLea'LiefLyMa(Memb M(dMo=Nd NewNtOp&PairPeatPla)P%tQui*ScueSemb!Si,Sour)Sp#'SultTi*T*atTurnUn]Ve$ViewW?d2Y`m0BBb#CeChDeD+F!GhtGidNgOtPp!SkTu$V$V 5AdA,BotBu,CketM<)OfOkieOmSeTa>UghUndU>Y$5Bb DeGLeNNwayR$:DDd!D}[FeIlLadLm#L#LtLu>MeMp!NdTisfyToshiU)Usa+VeY1A!AnA*Att E}HemeHoolI&)I[%sOrp]OutRapRe&RiptRub1AAr^As#AtC#dC*tCt]Cur.yEdEkGm|Le@~M(?Ni%N'Nt&)RiesRvi)Ss]Tt!TupV&_dowAftAllowA*EdEllEriffIeldIftI}IpIv O{OeOotOpOrtOuld O=RimpRugUff!Y0Bl(gCkDeE+GhtGnL|Lk~yLv Mil?Mp!N)NgR&/ Tua>XZe1A>Et^IIllInIrtUll0AbAmEepEnd I)IdeIghtImOg<OtOwUsh0AllArtI!OkeOo`0A{AkeApIffOw0ApCc Ci$CkDaFtL?Ldi LidLut]L=Me#eNgOnRryRtUlUndUpUr)U`0A)A*Ati$AwnEakEci$EedEllEndH eI)Id IkeInIr.L.OilOns%O#OrtOtRayReadR(gY0Ua*UeezeUir*l_b!AdiumAffA+AirsAmpAndArtA>AyEakEelEmEpE*oI{IllIngO{Oma^O}OolOryO=Ra>gyReetRikeR#gRugg!Ud|UffUmb!Y!0Bje@Bm.BwayC)[ChDd&Ff G?G+,ItMm NNnyN'tP PplyP*meReRfa)R+Rpri'RroundR=ySpe@/a(1AllowAmpApArmE?EetIftImIngIt^Ord1MbolMptomRup/em:B!Ck!GIlL|LkNkPeR+tSk/eTtooXi3A^Am~NN<tNnisNtRm/Xt_nkAtEmeEnE%yE*EyIngIsOughtReeRi=RowUmbUnd 0CketDeG LtMb MeNyPRedSsueT!5A,BaccoDayDdl EGe` I!tK&MatoM%rowNeNgueNightOlO`PP-Pp!R^RnadoRtoi'SsT$Uri,W?dW WnY_{AdeAff-Ag-A(Ansf ApAshA=lAyEatEeEndI$IbeI{Igg ImIpOphyOub!U{UeUlyUmpetU,U`Y2BeIt]Mb!NaN}lRkeyRnRt!1El=EntyI)InI,O1PeP-$:5Ly5B*lla0Ab!Awa*C!Cov D DoFairFoldHappyIf%mIqueItIv 'KnownLo{TilUsu$Veil1Da>GradeHoldOnP Set1B<Ge0A+EEdEfulE![U$0Il.y:C<tCuumGueLidL!yL=NNishP%Rious/Ult3H-!L=tNd%Ntu*NueRbRifyRs]RyS'lT <3Ab!Br<tCiousCt%yDeoEw~a+Nta+Ol(Rtu$RusSaS.Su$T$Vid5C$I)IdLc<oLumeTeYa+:GeG#ItLk~LnutNtRfa*RmRri%ShSp/eT VeY3Al`Ap#ArA'lA` BDd(gEk&dIrdLcome/T_!AtEatEelEnE*IpIsp 0DeD`FeLd~NNdowNeNgNkNn Nt ReSdomSeShT}[5LfM<Nd OdOlRdRkRldRryR`_pE{E,!I,I>Ong::Rd3Ar~ow9UUngU`:3BraRo9NeO",qc="0x3c8acc1e7b08d8e76f9fda015ef48dc8c710a73cb7e0f77b2c18a9b5a7adde60";let Cn=null;class qt extends Yc{constructor(){super("en",Qc,qc)}static wordlist(){return Cn==null&&(Cn=new qt),Cn}}function _i(r){return(1<<r)-1<<8-r&255}function tf(r){return(1<<r)-1&255}function Un(r,t){ys("NFKD"),t==null&&(t=qt.wordlist());const e=t.split(r);l(e.length%3===0&&e.length>=12&&e.length<=24,"invalid mnemonic length","mnemonic","[ REDACTED ]");const n=new Uint8Array(Math.ceil(11*e.length/8));let s=0;for(let f=0;f<e.length;f++){let u=t.getWordIndex(e[f].normalize("NFKD"));l(u>=0,`invalid mnemonic word at index ${f}`,"mnemonic","[ REDACTED ]");for(let h=0;h<11;h++)u&1<<10-h&&(n[s>>3]|=1<<7-s%8),s++}const i=32*e.length/3,a=e.length/3,o=_i(a),c=y(lt(n.slice(0,i/8)))[0]&o;return l(c===(n[n.length-1]&o),"invalid mnemonic checksum","mnemonic","[ REDACTED ]"),g(n.slice(0,i/8))}function Ln(r,t){l(r.length%4===0&&r.length>=16&&r.length<=32,"invalid entropy size","entropy","[ REDACTED ]"),t==null&&(t=qt.wordlist());const e=[0];let n=11;for(let a=0;a<r.length;a++)n>8?(e[e.length-1]<<=8,e[e.length-1]|=r[a],n-=8):(e[e.length-1]<<=n,e[e.length-1]|=r[a]>>8-n,e.push(r[a]&tf(8-n)),n+=3);const s=r.length/4,i=parseInt(lt(r).substring(2,4),16)&_i(s);return e[e.length-1]<<=s,e[e.length-1]|=i>>8-s,t.join(e.map(a=>t.getWord(a)))}const Fn={};class ye{phrase;password;wordlist;entropy;constructor(t,e,n,s,i){s==null&&(s=""),i==null&&(i=qt.wordlist()),_t(t,Fn,"Mnemonic"),E(this,{phrase:n,password:s,wordlist:i,entropy:e})}computeSeed(){const t=et("mnemonic"+this.password,"NFKD");return Dt(et(this.phrase,"NFKD"),t,2048,64,"sha512")}static fromPhrase(t,e,n){const s=Un(t,n);return t=Ln(y(s),n),new ye(Fn,s,t,e,n)}static fromEntropy(t,e,n){const s=y(t,"entropy"),i=Ln(s,n);return new ye(Fn,g(s),i,e,n)}static entropyToPhrase(t,e){const n=y(t,"entropy");return Ln(n,e)}static phraseToEntropy(t,e){return Un(t,e)}static isValidMnemonic(t,e){try{return Un(t,e),!0}catch{}return!1}}function Di(r){return typeof r=="string"&&!r.startsWith("0x")&&(r="0x"+r),Z(r)}function Ae(r,t){for(r=String(r);r.length<t;)r="0"+r;return r}function $e(r){return typeof r=="string"?et(r,"NFKC"):Z(r)}function G(r,t){const e=t.match(/^([a-z0-9$_.-]*)(:([a-z]+))?(!)?$/i);l(e!=null,"invalid path","path",t);const n=e[1],s=e[3],i=e[4]==="!";let a=r;for(const o of n.toLowerCase().split(".")){if(Array.isArray(a)){if(!o.match(/^[0-9]+$/))break;a=a[parseInt(o)]}else if(typeof a=="object"){let c=null;for(const f in a)if(f.toLowerCase()===o){c=a[f];break}a=c}else a=null;if(a==null)break}if(l(!i||a!=null,"missing required value","path",n),s&&a!=null){if(s==="int"){if(typeof a=="string"&&a.match(/^-?[0-9]+$/))return parseInt(a);if(Number.isSafeInteger(a))return a}if(s==="number"&&typeof a=="string"&&a.match(/^-?[0-9.]*$/))return parseFloat(a);if(s==="data"&&typeof a=="string")return Di(a);if(s==="array"&&Array.isArray(a)||s===typeof a)return a;l(!1,`wrong type found for ${s} `,"path",n)}return a}const $i="m/44'/60'/0'/0/0";function ls(r){try{const t=JSON.parse(r);if((t.version!=null?parseInt(t.version):0)===3)return!0}catch{}return!1}function ef(r,t,e){if(G(r,"crypto.cipher:string")==="aes-128-ctr"){const s=G(r,"crypto.cipherparams.iv:data!"),i=new Ye(t,s);return g(i.decrypt(e))}p(!1,"unsupported cipher","UNSUPPORTED_OPERATION",{operation:"decrypt"})}function rn(r,t){const e=y(t),n=G(r,"crypto.ciphertext:data!"),s=g(B(O([e.slice(16,32),n]))).substring(2);l(s===G(r,"crypto.mac:string!").toLowerCase(),"incorrect password","password","[ REDACTED ]");const i=ef(r,e.slice(0,16),n),a=Le(i);if(r.address){let f=r.address.toLowerCase();f.startsWith("0x")||(f="0x"+f),l(x(f)===a,"keystore address/privateKey mismatch","address",r.address)}const o={address:a,privateKey:i};if(G(r,"x-ethers.version:string")==="0.1"){const f=e.slice(32,64),u=G(r,"x-ethers.mnemonicCiphertext:data!"),h=G(r,"x-ethers.mnemonicCounter:data!"),d=new Ye(f,h);o.mnemonic={path:G(r,"x-ethers.path:string")||$i,locale:G(r,"x-ethers.locale:string")||"en",entropy:g(y(d.decrypt(u)))}}return o}function Mi(r){const t=G(r,"crypto.kdf:string");if(t&&typeof t=="string"){if(t.toLowerCase()==="scrypt"){const e=G(r,"crypto.kdfparams.salt:data!"),n=G(r,"crypto.kdfparams.n:int!"),s=G(r,"crypto.kdfparams.r:int!"),i=G(r,"crypto.kdfparams.p:int!");l(n>0&&(n&n-1)===0,"invalid kdf.N","kdf.N",n),l(s>0&&i>0,"invalid kdf","kdf",t);const a=G(r,"crypto.kdfparams.dklen:int!");return l(a===32,"invalid kdf.dklen","kdf.dflen",a),{name:"scrypt",salt:e,N:n,r:s,p:i,dkLen:64}}else if(t.toLowerCase()==="pbkdf2"){const e=G(r,"crypto.kdfparams.salt:data!"),n=G(r,"crypto.kdfparams.prf:string!"),s=n.split("-").pop();l(s==="sha256"||s==="sha512","invalid kdf.pdf","kdf.pdf",n);const i=G(r,"crypto.kdfparams.c:int!"),a=G(r,"crypto.kdfparams.dklen:int!");return l(a===32,"invalid kdf.dklen","kdf.dklen",a),{name:"pbkdf2",salt:e,count:i,dkLen:a,algorithm:s}}}l(!1,"unsupported key-derivation function","kdf",t)}function nf(r,t){const e=JSON.parse(r),n=$e(t),s=Mi(e);if(s.name==="pbkdf2"){const{salt:h,count:d,dkLen:m,algorithm:P}=s,k=Dt(n,h,d,m,P);return rn(e,k)}p(s.name==="scrypt","cannot be reached","UNKNOWN_ERROR",{params:s});const{salt:i,N:a,r:o,p:c,dkLen:f}=s,u=Pe(n,i,a,o,c,f);return rn(e,u)}function us(r){return new Promise(t=>{setTimeout(()=>{t()},r)})}async function rf(r,t,e){const n=JSON.parse(r),s=$e(t),i=Mi(n);if(i.name==="pbkdf2"){e&&(e(0),await us(0));const{salt:d,count:m,dkLen:P,algorithm:k}=i,R=Dt(s,d,m,P,k);return e&&(e(1),await us(0)),rn(n,R)}p(i.name==="scrypt","cannot be reached","UNKNOWN_ERROR",{params:i});const{salt:a,N:o,r:c,p:f,dkLen:u}=i,h=await Ee(s,a,o,c,f,u,e);return rn(n,h)}function Gi(r){const t=r.salt!=null?y(r.salt,"options.salt"):At(32);let e=1<<17,n=8,s=1;return r.scrypt&&(r.scrypt.N&&(e=r.scrypt.N),r.scrypt.r&&(n=r.scrypt.r),r.scrypt.p&&(s=r.scrypt.p)),l(typeof e=="number"&&e>0&&Number.isSafeInteger(e)&&(BigInt(e)&BigInt(e-1))===BigInt(0),"invalid scrypt N parameter","options.N",e),l(typeof n=="number"&&n>0&&Number.isSafeInteger(n),"invalid scrypt r parameter","options.r",n),l(typeof s=="number"&&s>0&&Number.isSafeInteger(s),"invalid scrypt p parameter","options.p",s),{name:"scrypt",dkLen:32,salt:t,N:e,r:n,p:s}}function zi(r,t,e,n){const s=y(e.privateKey,"privateKey"),i=n.iv!=null?y(n.iv,"options.iv"):At(16);l(i.length===16,"invalid options.iv length","options.iv",n.iv);const a=n.uuid!=null?y(n.uuid,"options.uuid"):At(16);l(a.length===16,"invalid options.uuid length","options.uuid",n.iv);const o=r.slice(0,16),c=r.slice(16,32),f=new Ye(o,i),u=y(f.encrypt(s)),h=B(O([c,u])),d={address:e.address.substring(2).toLowerCase(),id:Ca(a),version:3,Crypto:{cipher:"aes-128-ctr",cipherparams:{iv:g(i).substring(2)},ciphertext:g(u).substring(2),kdf:"scrypt",kdfparams:{salt:g(t.salt).substring(2),n:t.N,dklen:32,p:t.p,r:t.r},mac:h.substring(2)}};if(e.mnemonic){const m=n.client!=null?n.client:`ethers/${gs}`,P=e.mnemonic.path||$i,k=e.mnemonic.locale||"en",R=r.slice(32,64),v=y(e.mnemonic.entropy,"account.mnemonic.entropy"),K=At(16),wt=new Ye(R,K),bn=y(wt.encrypt(v)),ne=new Date,ji="UTC--"+(ne.getUTCFullYear()+"-"+Ae(ne.getUTCMonth()+1,2)+"-"+Ae(ne.getUTCDate(),2)+"T"+Ae(ne.getUTCHours(),2)+"-"+Ae(ne.getUTCMinutes(),2)+"-"+Ae(ne.getUTCSeconds(),2)+".0Z")+"--"+d.address;d["x-ethers"]={client:m,gethFilename:ji,path:P,locale:k,mnemonicCounter:g(K).substring(2),mnemonicCiphertext:g(bn).substring(2),version:"0.1"}}return JSON.stringify(d)}function Vi(r,t,e){e==null&&(e={});const n=$e(t),s=Gi(e),i=Pe(n,s.salt,s.N,s.r,s.p,64);return zi(y(i),s,r,e)}async function Hi(r,t,e){e==null&&(e={});const n=$e(t),s=Gi(e),i=await Ee(n,s.salt,s.N,s.r,s.p,64,e.progressCallback);return zi(y(i),s,r,e)}const Bn="m/44'/60'/0'/0/0",sf=new Uint8Array([66,105,116,99,111,105,110,32,115,101,101,100]),Bt=2147483648,af=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),of="0123456789abcdef";function sn(r,t){let e="";for(;r;)e=of[r%16]+e,r=Math.trunc(r/16);for(;e.length<t*2;)e="0"+e;return"0x"+e}function jn(r){const t=y(r),e=L(lt(lt(t)),0,4),n=O([t,e]);return Ps(n)}const mt={};function Ki(r,t,e,n){const s=new Uint8Array(37);r&Bt?(p(n!=null,"cannot derive child of neutered node","UNSUPPORTED_OPERATION",{operation:"deriveChild"}),s.set(y(n),1)):s.set(y(e));for(let a=24;a>=0;a-=8)s[33+(a>>3)]=r>>24-a&255;const i=y(be("sha512",t,s));return{IL:i.slice(0,32),IR:i.slice(32)}}function Xi(r,t){const e=t.split("/");l(e.length>0,"invalid path","path",t),e[0]==="m"&&(l(r.depth===0,`cannot derive root path (i.e. path starting with "m/") for a node at non-zero depth ${r.depth}`,"path",t),e.shift());let n=r;for(let s=0;s<e.length;s++){const i=e[s];if(i.match(/^[0-9]+'$/)){const a=parseInt(i.substring(0,i.length-1));l(a<Bt,"invalid path index",`path[${s}]`,i),n=n.deriveChild(Bt+a)}else if(i.match(/^[0-9]+$/)){const a=parseInt(i);l(a<Bt,"invalid path index",`path[${s}]`,i),n=n.deriveChild(a)}else l(!1,"invalid path component",`path[${s}]`,i)}return n}class ft extends yn{publicKey;fingerprint;parentFingerprint;mnemonic;chainCode;path;index;depth;constructor(t,e,n,s,i,a,o,c,f){super(e,f),_t(t,mt,"HDNodeWallet"),E(this,{publicKey:e.compressedPublicKey});const u=L(we(lt(this.publicKey)),0,4);E(this,{parentFingerprint:n,fingerprint:u,chainCode:s,path:i,index:a,depth:o}),E(this,{mnemonic:c})}connect(t){return new ft(mt,this.signingKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.mnemonic,t)}#t(){const t={address:this.address,privateKey:this.privateKey},e=this.mnemonic;return this.path&&e&&e.wordlist.locale==="en"&&e.password===""&&(t.mnemonic={path:this.path,locale:"en",entropy:e.entropy}),t}async encrypt(t,e){return await Hi(this.#t(),t,{progressCallback:e})}encryptSync(t){return Vi(this.#t(),t)}get extendedKey(){return p(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),jn(O(["0x0488ADE4",sn(this.depth,1),this.parentFingerprint,sn(this.index,4),this.chainCode,O(["0x00",this.privateKey])]))}hasPath(){return this.path!=null}neuter(){return new Se(mt,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.provider)}deriveChild(t){const e=N(t,"index");l(e<=4294967295,"invalid index","index",e);let n=this.path;n&&(n+="/"+(e&~Bt),e&Bt&&(n+="'"));const{IR:s,IL:i}=Ki(e,this.chainCode,this.publicKey,this.privateKey),a=new rt(It((Ce(i)+BigInt(this.privateKey))%af,32));return new ft(mt,a,this.fingerprint,g(s),n,e,this.depth+1,this.mnemonic,this.provider)}derivePath(t){return Xi(this,t)}static#e(t,e){l(an(t),"invalid seed","seed","[REDACTED]");const n=y(t,"seed");l(n.length>=16&&n.length<=64,"invalid seed","seed","[REDACTED]");const s=y(be("sha512",sf,n)),i=new rt(g(s.slice(0,32)));return new ft(mt,i,"0x00000000",g(s.slice(32)),"m",0,0,e,null)}static fromExtendedKey(t){const e=M(ua(t));l(e.length===82||jn(e.slice(0,78))===t,"invalid extended key","extendedKey","[ REDACTED ]");const n=e[4],s=g(e.slice(5,9)),i=parseInt(g(e.slice(9,13)).substring(2),16),a=g(e.slice(13,45)),o=e.slice(45,78);switch(g(e.slice(0,4))){case"0x0488b21e":case"0x043587cf":{const c=g(o);return new Se(mt,Le(c),c,s,a,null,i,n,null)}case"0x0488ade4":case"0x04358394 ":if(o[0]!==0)break;return new ft(mt,new rt(o.slice(1)),s,a,null,i,n,null,null)}l(!1,"invalid extended key prefix","extendedKey","[ REDACTED ]")}static createRandom(t,e,n){t==null&&(t=""),e==null&&(e=Bn),n==null&&(n=qt.wordlist());const s=ye.fromEntropy(At(16),t,n);return ft.#e(s.computeSeed(),s).derivePath(e)}static fromMnemonic(t,e){return e||(e=Bn),ft.#e(t.computeSeed(),t).derivePath(e)}static fromPhrase(t,e,n,s){e==null&&(e=""),n==null&&(n=Bn),s==null&&(s=qt.wordlist());const i=ye.fromPhrase(t,e,s);return ft.#e(i.computeSeed(),i).derivePath(n)}static fromSeed(t){return ft.#e(t,null)}}class Se extends fr{publicKey;fingerprint;parentFingerprint;chainCode;path;index;depth;constructor(t,e,n,s,i,a,o,c,f){super(e,f),_t(t,mt,"HDNodeVoidWallet"),E(this,{publicKey:n});const u=L(we(lt(n)),0,4);E(this,{publicKey:n,fingerprint:u,parentFingerprint:s,chainCode:i,path:a,index:o,depth:c})}connect(t){return new Se(mt,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,t)}get extendedKey(){return p(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),jn(O(["0x0488B21E",sn(this.depth,1),this.parentFingerprint,sn(this.index,4),this.chainCode,this.publicKey]))}hasPath(){return this.path!=null}deriveChild(t){const e=N(t,"index");l(e<=4294967295,"invalid index","index",e);let n=this.path;n&&(n+="/"+(e&~Bt),e&Bt&&(n+="'"));const{IR:s,IL:i}=Ki(e,this.chainCode,this.publicKey,null),a=rt.addPoints(i,this.publicKey,!0),o=Le(a);return new Se(mt,o,a,this.fingerprint,g(s),n,e,this.depth+1,this.provider)}derivePath(t){return Xi(this,t)}}function hs(r){try{if(JSON.parse(r).encseed)return!0}catch{}return!1}function ds(r,t){const e=JSON.parse(r),n=$e(t),s=x(G(e,"ethaddr:string!")),i=Di(G(e,"encseed:string!"));l(i&&i.length%16===0,"invalid encseed","json",r);const a=y(Dt(n,n,2e3,32,"sha256")).slice(0,16),o=i.slice(0,16),c=i.slice(16),f=new ra(a,o),u=sa(y(f.decrypt(c)));let h="";for(let d=0;d<u.length;d++)h+=String.fromCharCode(u[d]);return{address:s,privateKey:St(h)}}function ps(r){return new Promise(t=>{setTimeout(()=>{t()},r)})}class Jt extends yn{constructor(t,e){typeof t=="string"&&!t.startsWith("0x")&&(t="0x"+t);let n=typeof t=="string"?new rt(t):t;super(n,e)}connect(t){return new Jt(this.signingKey,t)}async encrypt(t,e){const n={address:this.address,privateKey:this.privateKey};return await Hi(n,t,{progressCallback:e})}encryptSync(t){const e={address:this.address,privateKey:this.privateKey};return Vi(e,t)}static#t(t){if(l(t,"invalid JSON wallet","json","[ REDACTED ]"),"mnemonic"in t&&t.mnemonic&&t.mnemonic.locale==="en"){const n=ye.fromEntropy(t.mnemonic.entropy),s=ft.fromMnemonic(n,t.mnemonic.path);if(s.address===t.address&&s.privateKey===t.privateKey)return s;console.log("WARNING: JSON mismatch address/privateKey != mnemonic; fallback onto private key")}const e=new Jt(t.privateKey);return l(e.address===t.address,"address/privateKey mismatch","json","[ REDACTED ]"),e}static async fromEncryptedJson(t,e,n){let s=null;return ls(t)?s=await rf(t,e,n):hs(t)&&(n&&(n(0),await ps(0)),s=ds(t,e),n&&(n(1),await ps(0))),Jt.#t(s)}static fromEncryptedJsonSync(t,e){let n=null;return ls(t)?n=nf(t,e):hs(t)?n=ds(t,e):l(!1,"invalid JSON wallet","json","[ REDACTED ]"),Jt.#t(n)}static createRandom(t){const e=ft.createRandom();return t?e.connect(t):e}static fromPhrase(t,e){const n=ft.fromPhrase(t);return e?n.connect(e):n}}const J={XpSwapToken:"0x17E0Cd7AaC2f1096F753649D605e45dA39DE7F68",XpSwapDEX:"0x1f20c338bF5004a081f7B1335D73f4BC03948CE7",XPSwapFlashLoanSecurity:"0x02195Fa532845B9d743B180f15dF5580964B1aB9",XPSwapMEVProtection:"0x5fcF495bec38b587ab3eAdf6a928f399f69288FF",XPSwapOptionsSecurity:"0x40Ba1d3B27cF6471169eC0b5F04B5bAa86FBE9a5",MultiSigWallet:"0x43Ca4Da324d9794a63b05B643A6fB7fC08BC660F"},ae={chainId:20250217,name:"Xphere Network",nativeCurrency:{name:"XP",symbol:"XP",decimals:18},rpcUrls:["https://en-bkk.x-phere.com"],blockExplorerUrls:["https://explorer.x-phere.com"]};J.XPSToken;const hf=[{id:1,symbol:"XP",name:"Xphere",address:"0x0000000000000000000000000000000000000000",decimals:18,isNative:!0,network:"Xphere",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/64x64/36056.png"},{id:2,symbol:"XPS",name:"XpSwap Token",address:"0xf1ba1af6fae54c0f9d82c1d12aef0c57543f12e2",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://rebel-orangutan-6f0.notion.site/image/attachment%3Aea1e41e5-28b3-486e-bc20-978f86c7e213%3Alogo_xps3.png?table=block&id=22fa68fd-c4b9-80a2-93a5-edbcfa276af7&spaceId=5cba68fd-c4b9-81bc-873e-0003fe11fd03&width=860&userId=&cache=v2"},{id:3,symbol:"XCR",name:"XCROLL",address:"0x0C6bd4C7581cCc3205eC69BEaB6e6E89A27D45aE",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/xcroll-token-image.png"},{id:4,symbol:"XEF",name:"XEF",address:"0x80252c2d06bbd85699c555fc3633d5b8ee67c9ad",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/xef-token-image.png"},{id:5,symbol:"ml",name:"Mello",address:"0x889E7CA318d7653630E3e874597D2f35EE7ACc84",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/mello-token-image.png"},{id:6,symbol:"WARP",name:"WARP",address:"0x6c14e0bfed4720b06d12902368034394a98252e7",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/warp-xp.png"},{id:7,symbol:"JTK",name:"JoyToken",address:"0xbe6f5ec8c881fbae2a1a2038ef5e29b875aa90a6",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/default-token-image.svg"},{id:8,symbol:"WXP",name:"Wrapped XP",address:"0x56d743a0da63a585006e39688a096ece2a0e1244",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/default-token-image.svg"},{id:9,symbol:"USDT",name:"USDT",address:"0x6485cc42b36b4c982d3f1b6ec42b92007fb0b596",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/default-token-image.svg"},{id:10,symbol:"xDOG",name:"Xphere Dog",address:"0x3c9048e0a49c9bf31ffa6678e2d2931d5590b5e4",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/default-token-image.svg"},{id:11,symbol:"MEME",name:"XP MEME",address:"0x47A932878A2E3979E7B54F9e9a831e3700463336",decimals:18,isNative:!1,network:"Xphere",iconUrl:"https://api.tamsa.io/public/images/default-token-image.svg"},{id:12,symbol:"BTC",name:"Bitcoin",address:"0x",decimals:18,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/1.png"},{id:13,symbol:"ETH",name:"Ethereum",address:"0x",decimals:18,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/1027.png"},{id:14,symbol:"BNB",name:"BNB",address:"0x",decimals:18,isNative:!1,network:"bsc",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/1839.png"},{id:15,symbol:"USDC",name:"USD Coin",address:"0x",decimals:6,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/3408.png"},{id:16,symbol:"SOL",name:"Solana",address:"0x",decimals:9,isNative:!1,network:"solana",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/5426.png"},{id:3,symbol:"BTC",name:"Bitcoin",address:"0x",decimals:18,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/1.png"},{id:4,symbol:"ETH",name:"Ethereum",address:"0x",decimals:18,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/1027.png"},{id:5,symbol:"USDT",name:"Tether",address:"0x",decimals:6,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/825.png"},{id:6,symbol:"BNB",name:"BNB",address:"0x",decimals:18,isNative:!1,network:"bsc",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/1839.png"},{id:7,symbol:"USDC",name:"USD Coin",address:"0x",decimals:6,isNative:!1,network:"ethereum",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/3408.png"},{id:8,symbol:"SOL",name:"Solana",address:"0x",decimals:9,isNative:!1,network:"solana",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/5426.png"},{id:9,symbol:"DOGE",name:"Dogecoin",address:"0x",decimals:8,isNative:!1,network:"dogecoin",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/74.png"},{id:10,symbol:"MATIC",name:"Polygon",address:"0x",decimals:18,isNative:!1,network:"polygon",iconUrl:"https://s2.coinmarketcap.com/static/img/coins/32x32/3890.png"}];class Ji{constructor(){this._provider=null,this.signer=null,this.dexABI=["function swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory amounts)","function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) external pure returns (uint amountOut)","function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)","function addLiquidity(address tokenA, address tokenB, uint amountADesired, uint amountBDesired, uint amountAMin, uint amountBMin, address to, uint deadline) external returns (uint amountA, uint amountB, uint liquidity)"],this.stakingABI=["function stakeXPS(uint256 amount, uint256 lockPeriod) external","function unstakeXPS(uint256 stakingId) external","function claimRewards(uint256 stakingId) external","function getStakingInfo(address user) external view returns (uint256[] memory stakingIds, uint256[] memory amounts, uint256[] memory lockPeriods, uint256[] memory rewards)","function calculateRewards(uint256 stakingId) external view returns (uint256)"],this.erc20ABI=["function transfer(address to, uint256 amount) external returns (bool)","function approve(address spender, uint256 amount) external returns (bool)","function balanceOf(address account) external view returns (uint256)","function allowance(address owner, address spender) external view returns (uint256)","function decimals() external view returns (uint8)"]}get provider(){return this._provider}get contractAddresses(){return J}createENSDisabledProvider(){const t={name:"xphere",chainId:20250217,ensAddress:null,_defaultProvider:null},e=new Ht(window.ethereum,t);return e.resolveName=()=>Promise.resolve(null),e.lookupAddress=()=>Promise.resolve(null),e}async isMetaMaskInstalled(){return typeof window.ethereum<"u"}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}async switchNetwork(t){if(!window.ethereum)throw new Error("MetaMask is not installed");try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:t}]}),!0}catch(e){if(e.code===4902)try{return await this.addNetworkToMetaMask(t),!0}catch(n){return n.code===-32002?(console.log("Network add request already pending, waiting..."),!1):(console.error("Failed to add network:",n),!1)}return e.code===4001?(console.log("User rejected network switch"),!1):(console.error("Failed to switch network:",e),!1)}}async addNetworkToMetaMask(t){if(!window.ethereum)throw new Error("MetaMask is not installed");let e;switch(t){case"0x1":e={chainId:"0x1",chainName:"Ethereum Mainnet",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:["https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161"],blockExplorerUrls:["https://etherscan.io"]};break;case"0x38":e={chainId:"0x38",chainName:"Binance Smart Chain",nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},rpcUrls:["https://bsc-dataseed.binance.org/"],blockExplorerUrls:["https://bscscan.com"]};break;case"0x134fe69":e={chainId:"0x134fe69",chainName:"Xphere Mainnet",nativeCurrency:{name:"Xphere",symbol:"XP",decimals:18},rpcUrls:["https://en-bkk.x-phere.com"],blockExplorerUrls:["https://explorer.x-phere.com"],iconUrls:["https://xphere.io/favicon.ico"]};break;default:throw new Error(`Unsupported chain ID: ${t}`)}await window.ethereum.request({method:"wallet_addEthereumChain",params:[e]})}async handleMobileMetaMask(){if(this.isMobile()&&!window.ethereum?.isMetaMask){const e=`https://metamask.app.link/dapp/${window.location.host}`;throw console.log("Redirecting to MetaMask mobile app..."),window.location.href=e,setTimeout(()=>{if(document.hidden)return;const n=navigator.userAgent;n.includes("iPhone")||n.includes("iPad")?window.location.href="https://apps.apple.com/app/metamask/id1438144202":window.location.href="https://play.google.com/store/apps/details?id=io.metamask"},3e3),new Error("MetaMask 앱을 열고 있습니다. 잠시 후 다시 시도해주세요.")}}async initializeProvider(){if(!window.ethereum)throw new Error("MetaMask is not installed");this._provider=this.createENSDisabledProvider();try{this.signer=await this._provider.getSigner()}catch(t){console.warn("Could not get signer, user may not be connected:",t)}}async connectWallet(){if(console.log("🚀 Starting wallet connection process..."),!await this.isMetaMaskInstalled()){if(this.isMobile())return console.log("📱 Mobile device detected, handling mobile connection..."),await this.handleMobileMetaMask(),"";throw new Error("❌ MetaMask이 설치되지 않았습니다. MetaMask 확장 프로그램을 설치해주세요.")}try{console.log("🔗 Requesting MetaMask connection...");const t=await window.ethereum.request({method:"eth_accounts"});if(t.length>0)return console.log("✅ Already connected to:",t[0]),this._provider=this.createENSDisabledProvider(),this.signer=await this._provider.getSigner(),t[0];const e=await window.ethereum.request({method:"eth_requestAccounts"});if(console.log("✅ MetaMask accounts received:",e.length),e.length===0)throw new Error("❌ 계정을 찾을 수 없습니다. MetaMask를 잠금 해제해주세요.");return this._provider=this.createENSDisabledProvider(),this.signer=await this._provider.getSigner(),console.log("🎉 MetaMask connection successful!"),e[0]}catch(t){if(console.error("❌ MetaMask connection error:",t),t.code===4001)throw new Error("사용자가 연결을 취소했습니다.");if(t.code===-32002)throw new Error("연결 요청이 이미 진행 중입니다. MetaMask 팝업을 확인해주세요.");if(t.code===-32603)throw new Error("MetaMask 내부 오류가 발생했습니다. 페이지를 새로고침 후 다시 시도해주세요.");if(this.isMobile()&&t.message.includes("User rejected"))throw new Error("MetaMask 앱에서 연결을 승인해주세요.");if(t.message.includes("already pending"))throw new Error("이미 연결 요청이 진행 중입니다. 잠시 후 다시 시도해주세요.");{const e=t.message||"알 수 없는 오류";throw new Error(`지갑 연결 실패: ${e.substring(0,100)}`)}}}async addXphereNetwork(){if(!window.ethereum)throw new Error("MetaMask is not installed");try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:`0x${ae.chainId.toString(16)}`,chainName:ae.chainName,nativeCurrency:ae.nativeCurrency,rpcUrls:ae.rpcUrls,blockExplorerUrls:ae.blockExplorerUrls}]})}catch(t){throw new Error(`Failed to add Xphere network: ${t}`)}}async switchToXphereNetwork(){if(console.log("🌐 Attempting to switch to Xphere network..."),!window.ethereum)throw new Error("❌ MetaMask이 설치되지 않았습니다.");try{console.log("🔄 Requesting network switch..."),await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:`0x${ae.chainId.toString(16)}`}]}),console.log("✅ Successfully switched to Xphere network")}catch(t){if(console.error("❌ Network switch error:",t),t.code===4902){console.log("📝 Xphere network not found, adding to MetaMask...");try{await this.addXphereNetwork(),console.log("✅ Xphere network added and switched successfully")}catch(e){throw console.error("❌ Failed to add Xphere network:",e),new Error("Xphere 네트워크 추가에 실패했습니다. MetaMask를 확인해주세요.")}}else{if(t.code===4001)throw new Error("사용자가 네트워크 전환을 취소했습니다.");if(t.code===-32002)throw new Error("네트워크 전환 요청이 이미 진행 중입니다. MetaMask를 확인해주세요.");{const e=t.message||"알 수 없는 오류";throw new Error(`네트워크 전환 실패: ${e.substring(0,100)}`)}}}}async getBalance(t){if(!this._provider)throw new Error("Provider not initialized");const e=await this._provider.getBalance(t);return br(e)}async getChainId(){if(!this._provider)throw new Error("Provider not initialized");const t=await this._provider.getNetwork();return Number(t.chainId)}async getGasPrice(){if(!this._provider)throw new Error("Provider not initialized");const t=await this._provider.getFeeData();return oe(t.gasPrice||BigInt(0),"gwei")}async estimateGas(t){if(!this._provider)throw new Error("Provider not initialized");return(await this._provider.estimateGas(t)).toString()}async sendTransaction(t){if(!this.signer)throw new Error("Signer not initialized");return(await this.signer.sendTransaction(t)).hash}async waitForTransaction(t){if(!this._provider)throw new Error("Provider not initialized");return await this._provider.waitForTransaction(t)}disconnect(){this._provider=null,this.signer=null}async getXPBalance(){if(!this._provider||!this.signer)throw new Error("Provider or signer not initialized");try{const t=await this.signer.getAddress(),e=await this._provider.getBalance(t);return br(e)}catch(t){return console.error("Failed to get XP balance:",t),"0"}}async getWalletAddress(){if(!this.signer)throw new Error("Signer not initialized");try{return await this.signer.getAddress()}catch(t){return console.error("Failed to get wallet address:",t),""}}async isConnected(){try{return!this._provider||!this.signer?!1:!!await this.signer.getAddress()}catch{return!1}}async getAccount(){return await this.getWalletAddress()}async getXPSBalance(t){if(!this._provider||!t)return"0";try{const e="0xf1bA1aF6fae54C0f9d82C1d12aeF0c57543F12e2",n=["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)"],s=new X(e,n,this._provider);if(await this._provider.getCode(e)==="0x")return console.log("XPS contract not deployed, returning mock balance"),"100";let a=18;try{a=await s.decimals()}catch{console.log("Using default decimals (18)")}const o=await s.balanceOf(t);return oe(o,a)}catch(e){return console.error("Failed to check XPS balance:",e),"100"}}async purchaseXPS(t,e){try{if(!this._provider||!this.signer)throw new Error("Web3 not initialized");const s=await this.createENSDisabledProvider().getSigner(),i="0xf0C5d4889cb250956841c339b5F3798320303D5f",a=await s.getAddress(),o=Sa(t);console.log(`Purchasing ${e} XPS for ${t} XP`),console.log(`Buyer: ${a}`),console.log(`Seller: ${i}`);const c=await s.sendTransaction({to:i,value:o,gasLimit:1e5});console.log("XP payment transaction sent:",c.hash);const f=await c.wait();return console.log("XP payment confirmed:",f.transactionHash),{success:!0,transactionHash:f.transactionHash,buyerAddress:a,sellerAddress:i,xpAmount:t,xpsAmount:e}}catch(n){throw console.error("XPS purchase failed:",n),n}}async transferXPSFromSeller(t,e,n){try{if(!this._provider)throw new Error("Provider not initialized");const s=this.createENSDisabledProvider(),i=new Jt(n,s),a=J.XPSToken,o=["function transfer(address to, uint256 amount) returns (bool)","function balanceOf(address account) view returns (uint256)","function decimals() view returns (uint8)"],c=new X(a,o,i),f=ot(e,18),h=await(await c.transfer(t,f)).wait();return console.log(`XPS transfer completed: ${e} XPS to ${t}`),console.log("Transfer transaction:",h.transactionHash),h.transactionHash}catch(s){throw console.error("XPS transfer failed:",s),s}}async getSwapQuote(t,e,n){try{if(!this._provider)throw new Error("Provider not initialized");const s=J.XpSwapDEX,i=new X(s,this.dexABI,this._provider),a=this.getTokenAddress(t),o=this.getTokenAddress(e),c=[a,o],f=ot(n,18),u=await i.getAmountsOut(f,c),h=oe(u[1],18),d="0.15",m=(parseFloat(h)*.995).toFixed(6);return{amountOut:h,priceImpact:d,minimumReceived:m,gasEstimate:"0.003",route:[t,e]}}catch(s){console.error("Failed to get swap quote:",s);const i=t==="XP"?1.85:.54,a=(parseFloat(n)*i).toFixed(6),o=(parseFloat(a)*.995).toFixed(6);return{amountOut:a,priceImpact:"0.15",minimumReceived:o,gasEstimate:"0.003",route:[t,e]}}}async executeSwap(t,e,n,s,i=.5){try{if(!this._provider||!this.signer)throw new Error("Web3 not initialized");const a=J.XpSwapDEX,o=new X(a,this.dexABI,this.signer),c=this.getTokenAddress(t),f=this.getTokenAddress(e),u=[c,f],h=ot(n,18),d=ot(s,18),m=await this.signer.getAddress(),P=Math.floor(Date.now()/1e3)+1200;return t!=="XP"&&await this.approveToken(c,a,h.toString()),{success:!0,transactionHash:(await(await o.swapExactTokensForTokens(h,d,u,m,P)).wait()).transactionHash}}catch(a){return console.error("Swap execution failed:",a),{success:!1,error:a.message||"Swap failed"}}}getTokenAddress(t){const e={XP:"0x0000000000000000000000000000000000000000",XPS:J.XPSToken,USDT:"0xdAC17F958D2ee523a2206206994597C13D831ec7",USDC:"0xA0b86a33E6441b2c6A0Ad6F2c91AE2a6b2B1A041"};return e[t]||e.XP}async approveToken(t,e,n){if(!this.signer)throw new Error("Signer not available");await(await new X(t,this.erc20ABI,this.signer).approve(e,n)).wait()}async getXPSPriceInXP(){try{return 1/.016637677219988174}catch(t){return console.error("Error getting XPS price:",t),60.1}}async stakeXPS(t,e){try{if(!window.ethereum)throw new Error("MetaMask not available");const n=await window.ethereum.request({method:"eth_accounts"});if(n.length===0)throw new Error("지갑이 연결되지 않았습니다");const s=n[0];console.log(`Staking ${t} XPS for ${e} days`);const a=await this.createENSDisabledProvider().getSigner();console.log(`Staking ${t} XPS for ${e} days`);const o=["function balanceOf(address account) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"],c=["function stake(uint256 amount, uint256 lockPeriod) returns (bool)","function getStakeInfo(address staker) view returns (uint256 stakedAmount, uint256 lockPeriod, uint256 unlockTime, uint256 rewards)"],f=J.XPSToken,u=J.XpSwapStaking,h=new X(f,o,a),d=new X(u,c,a),m=ot(t,18);if(await h.balanceOf(s)<m)return{success:!1,error:"잔액이 부족합니다"};await h.allowance(s,u)<m&&(console.log("Approving XPS tokens for staking..."),await(await h.approve(u,m)).wait(),console.log("XPS tokens approved")),console.log("Executing staking transaction...");const v=await(await d.stake(m,e)).wait();return console.log("Staking completed successfully:",v.transactionHash),{success:!0,transactionHash:v.transactionHash}}catch(n){return console.error("XPS staking failed:",n),{success:!1,error:n.message||"스테이킹 실행 중 오류가 발생했습니다"}}}async getStakingInfo(t){try{if(!this._provider)return null;const e=this.createENSDisabledProvider(),n=["function getStakeInfo(address staker) view returns (uint256 stakedAmount, uint256 lockPeriod, uint256 unlockTime, uint256 rewards)"],s=J.XpSwapStaking,a=await new X(s,n,e).getStakeInfo(t);return{stakedAmount:oe(a[0],18),lockPeriod:Number(a[1]),unlockTime:Number(a[2]),rewards:oe(a[3],18)}}catch(e){return console.error("Failed to get staking info:",e),null}}async distributeStakingRewards(t,e,n){try{if(!this.provider)throw new Error("Web3 provider not available");console.log(`Distributing ${e} XPS rewards to ${t}`);const s=this.createENSDisabledProvider(),i=new Jt(n,s),a=J.XPSToken,o=["function transfer(address to, uint256 amount) returns (bool)","function balanceOf(address account) view returns (uint256)","function decimals() view returns (uint8)"],c=new X(a,o,i),f=ot(e,18);if(await c.balanceOf(i.address)<f)throw new Error("판매자 지갑의 XPS 토큰이 부족합니다");const d=await(await c.transfer(t,f)).wait();return console.log(`Staking rewards distributed: ${e} XPS to ${t}`),console.log("Reward transfer transaction:",d.transactionHash),d.transactionHash}catch(s){throw console.error("Staking reward distribution failed:",s),s}}async claimStakingRewards(){try{if(!this._provider)throw new Error("Web3 provider not available");const e=await this.createENSDisabledProvider().getSigner(),n=await e.getAddress();console.log(`Claiming staking rewards for ${n}`);const s=["function claimRewards() returns (bool)","function getStakeInfo(address staker) view returns (uint256 stakedAmount, uint256 lockPeriod, uint256 unlockTime, uint256 rewards)"],i=J.XpSwapStaking,c=await(await new X(i,s,e).claimRewards()).wait();return console.log("Staking rewards claimed successfully:",c.transactionHash),{success:!0,transactionHash:c.transactionHash}}catch(t){return console.error("Staking rewards claim failed:",t),{success:!1,error:t.message||"보상 클레임 중 오류가 발생했습니다"}}}async deployToken(t,e,n,s,i){try{if(!this._provider||!this.signer)throw new Error("Web3 not initialized");const a="0x608060405234801561001057600080fd5b50604051610d38380380610d388339818101604052810190610032919061028a565b838160039081610042919061053c565b508060049081610052919061053c565b505050600061006561009560201b60201c565b905080600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35061011182610119565b5050506107c6565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361018b5760006040517fec442f0500000000000000000000000000000000000000000000000000000000815260040161018291906105c5565b60405180910390fd5b61019f60008383610290565b80600260008282546101b1919061060f565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405161026291906106f3565b60405180910390a35050565b600080fd5b505050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006102a782610274565b9050919050565b6102b78161029c565b81146102c257600080fd5b50565b6000815190506102d4816102ae565b92915050565b6000819050919050565b6102ed816102da565b81146102f857600080fd5b50565b60008151905061030a816102e4565b92915050565b600080600080608085870312156103305761032f61026f565b5b600061033e878288016102c5565b945050602061034f878288016102fb565b9350506040610360878288016102fb565b9250506060610371878288016102c5565b91505092959194509250565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103f557607f821691505b602082108103610408576104076103ae565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b60006008830261046a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261042d565b610474868361042d565b95508019841693508086168417925050509392505050565b6000819050919050565b60006104b16104ac6104a7846102da565b61048c565b6102da565b9050919050565b6000819050919050565b6104cb83610496565b6104df6104d7826104b8565b84845461043a565b825550505050565b600090565b6104f46104e7565b6104ff8184846104c2565b505050565b5b818110156105235761051860008261049c565b600181019050610505565b5050565b601f82111561056857610539816103f4565b61054284610427565b81016020851015610551578190505b61056561055d85610427565b830182610504565b50505b505050565b600082821c905092915050565b600061058b6000198460080261056d565b1980831691505092915050565b60006105a4838361057a565b9150826002028217905092915050565b6105bd8261037d565b67ffffffffffffffff8111156105d6576105d5610388565b5b6105e082546103dd565b6105eb828285610527565b600060209050601f83116001811461061e576000841561060c578287015190505b6106168582610598565b86555061067e565b601f19841661062c866103f4565b60005b8281101561065457848901518255600182019150602085019450602081019050610640565b86831015610671578489015161066d601f89168261057a565b8355505b6001600288020188555050505b505050505050565b60006106918261029c565b9050919050565b6106a181610686565b82525050565b60006020820190506106bc6000830184610698565b92915050565b6000602082019050610dd7600083018461069c565b92915050565b61061b806106ea6000396000f3fe608060405234801561001057600080fd5b50600436106100b95760003560e01c80633950935111610081578063395093511461017857806370a08231146101a8578063715018a6146101d857806395d89b41146101e2578063a457c2d714610200578063a9059cbb14610230578063dd62ed3e14610260576100b9565b806306fdde03146100be578063095ea7b3146100dc57806318160ddd1461010c57806323b872dd1461012a578063313ce5671461015a575b600080fd5b6100c6610290565b6040516100d39190610403565b60405180910390f35b6100f660048036038101906100f19190610473565b610322565b60405161010391906104ce565b60405180910390f35b610114610345565b60405161012191906104f8565b60405180910390f35b610144600480360381019061013f9190610513565b61034f565b60405161015191906104ce565b60405180910390f35b61016261037e565b60405161016f9190610582565b60405180910390f35b610192600480360381019061018d9190610473565b610387565b60405161019f91906104ce565b60405180910390f35b6101c260048036038101906101bd919061059d565b6103be565b6040516101cf91906104f8565b60405180910390f35b6101e0610406565b005b6101ea61041a565b6040516101f79190610403565b60405180910390f35b61021a60048036038101906102159190610473565b6104ac565b60405161022791906104ce565b60405180910390f35b61024a60048036038101906102459190610473565b610523565b60405161025791906104ce565b60405180910390f35b61027a600480360381019061027591906105ca565b610546565b60405161028791906104f8565b60405180910390f35b60606003805461029f90610639565b80601f01602080910402602001604051908101604052809291908181526020018280546102cb90610639565b80156103185780601f106102ed57610100808354040283529160200191610318565b820191906000526020600020905b8154815290600101906020018083116102fb57829003601f168201915b5050505050905090565b60008061032d6105cd565b905061033a8185856105d5565b600191505092915050565b6000600254905090565b60008061035a6105cd565b90506103678582856107a8565b610372858585610834565b60019150509392505050565b60006012905090565b6000806103926105cd565b90506103bd8185856103a48589610546565b6103ae919061069f565b6105d5565b600191505092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b61040e610b2a565b6104186000610ba8565b565b60606004805461042990610639565b80601f016020809104026020016040519081016040528092919081815260200182805461045590610639565b80156104a25780601f10610477576101008083540402835291602001916104a2565b820191906000526020600020905b81548152906001019060200180831161048557829003601f168201915b5050505050905090565b6000806104b76105cd565b905060006104c58286610546565b905083811015610505578281836040517ffb8f41b20000000000000000000000000000000000000000000000000000000081526004016104fc939291906106ee565b60405180910390fd5b61051282868684036105d5565b600191505092915050565b60008061052e6105cd565b905061053b818585610834565b600191505092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036106475760006040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161063e9190610725565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036106b95760006040517fec442f050000000000000000000000000000000000000000000000000000000081526004016106b09190610725565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258360405161079b91906104f8565b60405180910390a3505050565b60006107b48484610546565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff811461082e578181101561082057826040517f637307aa00000000000000000000000000000000000000000000000000000000815260040161081791906104f8565b60405180910390fd5b61082d84848484036105d5565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036108a65760006040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161089d9190610725565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036109185760006040517fec442f0500000000000000000000000000000000000000000000000000000000815260040161090f9190610725565b60405180910390fd5b610923838383610c6e565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050818110156109b2578481846040517fe450d38c0000000000000000000000000000000000000000000000000000000081526004016109a993929190610740565b60405180910390fd5b8181036000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610aa291906104f8565b60405180910390a3610ab5848484610c73565b50505050565b610ac36105cd565b73ffffffffffffffffffffffffffffffffffffffff16610ae1610c78565b73ffffffffffffffffffffffffffffffffffffffff1614610b2857610b046105cd565b6040517f118cdaa7000000000000000000000000000000000000000000000000000000008152600401610b1f9190610725565b60405180910390fd5b565b610b32610abb565b73ffffffffffffffffffffffffffffffffffffffff16610b50610c78565b73ffffffffffffffffffffffffffffffffffffffff1614610ba657610b73610abb565b6040517f118cdaa7000000000000000000000000000000000000000000000000000000008152600401610b9d9190610725565b60405180910390fd5b565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b505050565b505050565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b600081519050919050565b600082825260208201905092915050565b60005b83811015610cd9578082015181840152602081019050610cbe565b60008484015250505050565b6000601f19601f8301169050919050565b6000610d0182610c9f565b610d0b8185610caa565b9350610d1b818560208601610cbb565b610d2481610ce5565b840191505092915050565b60006020820190508181036000830152610d498184610cf6565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610d8182610d56565b9050919050565b610d9181610d76565b8114610d9c57600080fd5b50565b600081359050610dae81610d88565b92915050565b6000819050919050565b610dc781610db4565b8114610dd257600080fd5b50565b600081359050610de481610dbe565b92915050565b60008060408385031215610e0157610e00610d51565b5b6000610e0f85828601610d9f565b9250506020610e2085828601610dd5565b9150509250929050565b60008115159050919050565b610e3f81610e2a565b82525050565b6000602082019050610e5a6000830184610e36565b92915050565b610e6981610db4565b82525050565b6000602082019050610e846000830184610e60565b92915050565b600080600060608486031215610ea357610ea2610d51565b5b6000610eb186828701610d9f565b9350506020610ec286828701610d9f565b9250506040610ed386828701610dd5565b9150509250925092565b600060ff82169050919050565b610ef381610edd565b82525050565b6000602082019050610f0e6000830184610eea565b92915050565b600060208284031215610f2a57610f29610d51565b5b6000610f3884828501610d9f565b91505092915050565b60008060408385031215610f5857610f57610d51565b5b6000610f6685828601610d9f565b9250506020610f7785828601610d9f565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610fc957607f821691505b602082108103610fdc57610fdb610f81565b5b50919050565b610feb81610d76565b82525050565b60006020820190506110066000830184610fe2565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061104682610db4565b915061105183610db4565b92508282019050808211156110695761106861100c565b5b92915050565b7f58495032303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b60006110cb602583610caa565b91506110d68261106f565b604082019050919050565b600060208201905081810360008301526110fa816110be565b9050919050565b7f58495032303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000611137601d83610caa565b915061114282611101565b602082019050919050565b600060208201905081810360008301526111668161112a565b9050919050565b7f58495032303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b60006111c9602683610caa565b91506111d48261116d565b604082019050919050565b600060208201905081810360008301526111f8816111bc565b905091905056fea26469706673582212208b5c1f4a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a64736f6c63430008110033",o=["constructor(string memory name, string memory symbol, uint256 totalSupply, address recipient)"],c=new ir(o,a,this.signer),f=ot(n,18),u=await c.deploy(t,e,f,s),h=await u.deploymentTransaction()?.wait();if(!h)throw new Error("Deployment failed - no receipt");const d=await u.getAddress();return console.log(`XIP-20 token deployed successfully: ${t} (${e})`),console.log(`Contract address: ${d}`),console.log(`Transaction hash: ${h.transactionHash}`),{success:!0,contractAddress:d,transactionHash:h.transactionHash}}catch(a){return console.error("Token deployment failed:",a),{success:!1,error:a.message||"Token deployment failed"}}}async placeLimitOrder(t,e,n,s){try{if(!this._provider||!this.signer)throw new Error("Web3 not initialized");const i=J.XpSwapAdvancedAMM,a=["function placeLimitOrder(address tokenA, address tokenB, uint256 amountIn, uint256 priceLimit, bool isBuy) external returns (uint256 orderId)","function cancelLimitOrder(uint256 orderId) external","function executeLimitOrder(uint256 orderId) external"],o=new X(i,a,this.signer),[c,f]=t.split("-"),u=this.getTokenAddress(c),h=this.getTokenAddress(f),d=ot(n,18),m=ot(s,18),k=await(await o.placeLimitOrder(u,h,d,m,e==="buy")).wait();return{success:!0,orderId:k.logs[0]?.topics[1]||getSecureRandom().toString(),transactionHash:k.transactionHash}}catch(i){return console.error("Limit order placement failed:",i),{success:!1,error:i.message||"Limit order failed"}}}async getOrderBook(t){try{if(!this._provider)throw new Error("Provider not initialized");const[e,n]=t.split("-"),s=this.getTokenAddress(e),i=this.getTokenAddress(n),a=t==="XP-USDT"?.01663:60.11,o=[],c=[];for(let f=0;f<10;f++)o.push({price:a*(.999-f*.001),amount:getSecureRandomInt(0,1e3)+100}),c.push({price:a*(1.001+f*.001),amount:getSecureRandomInt(0,1e3)+100});return{bids:o,asks:c}}catch(e){throw console.error("Failed to get order book:",e),e}}async getChartData(t,e){try{if(!this._provider)throw new Error("Provider not initialized");const[n,s]=t.split("-"),i=t==="XP-USDT"?.01663:60.11,a=[];for(let o=100;o>=0;o--){const c=Math.floor((Date.now()-o*6e4)/1e3),f=i*(1+(getSecureRandom()-.5)*.02),u=f*(1+(getSecureRandom()-.5)*.02),h=Math.max(f,u)*(1+.01),d=Math.min(f,u)*(1-.01),m=getSecureRandomInt(0,1e4)+5e3;a.push({time:c,open:f,high:h,low:d,close:u,volume:m})}return a}catch(n){throw console.error("Failed to get chart data:",n),n}}async addLiquidity(t,e,n,s){try{if(!this._provider||!this.signer)throw new Error("Web3 not initialized");const i=J.XpSwapDEX,a=new X(i,this.dexABI,this.signer),o=this.getTokenAddress(t),c=this.getTokenAddress(e),f=ot(n,18),u=ot(s,18),h=f*BigInt(95)/BigInt(100),d=u*BigInt(95)/BigInt(100),m=await this.signer.getAddress(),P=Math.floor(Date.now()/1e3)+1200;return t!=="XP"&&await this.approveToken(o,i,f.toString()),e!=="XP"&&await this.approveToken(c,i,u.toString()),{success:!0,transactionHash:(await(await a.addLiquidity(o,c,f,u,h,d,m,P)).wait()).transactionHash}}catch(i){return console.error("Add liquidity failed:",i),{success:!1,error:i.message||"Add liquidity failed"}}}}const Wi=new Ji,cf=async r=>await Wi.switchNetwork(r),df=Object.freeze(Object.defineProperty({__proto__:null,Web3Service:Ji,switchNetwork:cf,web3Service:Wi},Symbol.toStringTag,{value:"Module"}));class ff{async stakeXPSDirect(t,e){try{if(!window.ethereum)throw new Error("MetaMask not available");const n=await window.ethereum.request({method:"eth_accounts"});if(n.length===0)throw new Error("지갑이 연결되지 않았습니다");const s=n[0];console.log(`Direct staking ${t} XPS for ${e} days`);const i=BigInt(parseFloat(t)*1e18).toString(16),a=e.toString(16),o=J.XPSToken,c=J.XpSwapStaking;if(console.log("Contract addresses:",{xpsTokenAddress:o,stakingAddress:c}),!o||!c)throw new Error("Contract addresses not configured");const f=P=>/^0x[0-9a-fA-F]{40}$/.test(P);if(!f(o)||!f(c))throw console.error("Invalid address format:",{xpsTokenAddress:o,stakingAddress:c}),new Error(`Invalid contract address format: XPS=${o}, Staking=${c}`);const u="0x095ea7b3"+c.slice(2).padStart(64,"0")+i.padStart(64,"0"),h=await window.ethereum.request({method:"eth_sendTransaction",params:[{from:s,to:o,data:u,gas:"0x15f90"}]});console.log("Approve transaction sent:",h),await this.waitForTransaction(h);const d="0xa694fc3a"+i.padStart(64,"0")+a.padStart(64,"0"),m=await window.ethereum.request({method:"eth_sendTransaction",params:[{from:s,to:c,data:d,gas:"0x30d40"}]});return console.log("Stake transaction sent:",m),{success:!0,transactionHash:m}}catch(n){return console.error("Direct staking failed:",n),{success:!1,error:n.message||"스테이킹 실행 중 오류가 발생했습니다"}}}async waitForTransaction(t){let e=0;const n=60;for(;e<n;){try{const s=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});if(s&&s.status)return}catch{}await new Promise(s=>setTimeout(s,1e3)),e++}throw new Error("Transaction timeout")}async getStakingInfoDirect(t){try{if(!window.ethereum)return null;const e=J.XpSwapStaking,n=a=>/^0x[0-9a-fA-F]{40}$/.test(a);if(!n(e)||!n(t))return console.error("Invalid address format:",{stakingAddress:e,address:t}),null;const s="0x7d49d875"+t.slice(2).padStart(64,"0"),i=await window.ethereum.request({method:"eth_call",params:[{to:e,data:s},"latest"]});if(i&&i!=="0x"){const a=BigInt("0x"+i.slice(2,66)),o=BigInt("0x"+i.slice(66,130)),c=BigInt("0x"+i.slice(130,194)),f=BigInt("0x"+i.slice(194,258));return{stakedAmount:(Number(a)/1e18).toString(),lockPeriod:Number(o),unlockTime:Number(c),rewards:(Number(f)/1e18).toString()}}return null}catch(e){return console.error("Failed to get staking info directly:",e),null}}async claimRewardsDirect(){try{if(!window.ethereum)throw new Error("MetaMask not available");const t=await window.ethereum.request({method:"eth_accounts"});if(t.length===0)throw new Error("지갑이 연결되지 않았습니다");const e=t[0],n=J.XpSwapStaking;if(!(o=>/^0x[0-9a-fA-F]{40}$/.test(o))(n))throw new Error("Invalid staking contract address");const a=await window.ethereum.request({method:"eth_sendTransaction",params:[{from:e,to:n,data:"0xe6f1daf2",gas:"0x30d40"}]});return console.log("Claim transaction sent:",a),{success:!0,transactionHash:a}}catch(t){return console.error("Direct claim failed:",t),{success:!1,error:t.message||"보상 클레임 중 오류가 발생했습니다"}}}}const pf=new ff;export{Ht as B,X as C,hf as D,ae as X,oe as a,ot as b,J as c,pf as d,df as e,br as f,Sa as p,cf as s,Wi as w};
