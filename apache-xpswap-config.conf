# XPSwap DEX Configuration - CORRECTED VERSION
# ì´ ì„¤ì •ì„ /etc/apache2/sites-available/storydot-kr-unified.conf ì— ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •

# API Proxy - MUST come before Alias (ì¤‘ìš”: Aliasë³´ë‹¤ ë¨¼ì € ì™€ì•¼ í•¨)
ProxyRequests Off
ProxyPreserveHost On
ProxyPass /xpswap/api http://localhost:5000/xpswap/api
ProxyPassReverse /xpswap/api http://localhost:5000/xpswap/api

# Static files - client/dist ì‚¬ìš© (dist/public ì•„ë‹˜!)
# ğŸ”¥ í•µì‹¬ ìˆ˜ì •: í”„ë¡œì íŠ¸ ë£¨íŠ¸ê°€ ì•„ë‹Œ client/distë¥¼ ê°€ë¦¬ì¼œì•¼ í•¨
Alias /xpswap /var/www/storage/xpswap/client/dist

<Directory /var/www/storage/xpswap/client/dist>
    Options -Indexes FollowSymLinks
    AllowOverride None
    Require all granted
    DirectoryIndex index.html
    
    # Cache Control for static assets
    <FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
        Header append Cache-Control "public, immutable"
    </FilesMatch>
    
    # No cache for HTML files to ensure updates
    <FilesMatch "\.html$">
        ExpiresActive On
        ExpiresDefault "access plus 0 seconds"
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
    
    RewriteEngine On
    RewriteBase /xpswap
    
    # Handle React Router - serve index.html for all routes except files
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/xpswap/api/
    RewriteRule ^.*$ /xpswap/index.html [L]
</Directory>

# Security Headers
<Directory /var/www/storage/xpswap/client/dist>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</Directory>